1
00:00:00,080 --> 00:00:02,000
frank dvorak teaches this javascript

2
00:00:02,000 --> 00:00:04,080
game development crash course you will

3
00:00:04,080 --> 00:00:06,480
learn how to create a 2d game using

4
00:00:06,480 --> 00:00:09,840
javascript html css and object oriented

5
00:00:09,840 --> 00:00:12,240
programming and frank provides a lot of

6
00:00:12,240 --> 00:00:14,480
free sprites and game art assets so you

7
00:00:14,480 --> 00:00:16,720
can follow along frank is a popular

8
00:00:16,720 --> 00:00:18,720
teacher who creates super creative

9
00:00:18,720 --> 00:00:20,400
courses

10
00:00:20,400 --> 00:00:22,160
what a strange planet it's completely

11
00:00:22,160 --> 00:00:24,240
covered in a thick layer of smoke

12
00:00:24,240 --> 00:00:26,160
initial scans indicate there are no

13
00:00:26,160 --> 00:00:27,920
organic life forms present but i

14
00:00:27,920 --> 00:00:30,080
register a lot of movement coders hope

15
00:00:30,080 --> 00:00:32,239
you like making games let's make a 2d

16
00:00:32,239 --> 00:00:34,320
steampunk game completely from scratch

17
00:00:34,320 --> 00:00:37,520
with html css and javascript no

18
00:00:37,520 --> 00:00:40,399
frameworks and no libraries i will give

19
00:00:40,399 --> 00:00:42,480
you a lot of premium art assets for

20
00:00:42,480 --> 00:00:45,280
characters environments and props and

21
00:00:45,280 --> 00:00:46,879
you can do whatever you want with them

22
00:00:46,879 --> 00:00:48,559
you can use them in your projects and

23
00:00:48,559 --> 00:00:50,399
you can modify them i will show you how

24
00:00:50,399 --> 00:00:52,320
to create gameplay variety by giving

25
00:00:52,320 --> 00:00:53,840
different enemy types different

26
00:00:53,840 --> 00:00:55,840
mechanics that the player can interact

27
00:00:55,840 --> 00:00:58,000
with or has to deal with for example if

28
00:00:58,000 --> 00:01:00,160
you destroy a hive well a bunch of small

29
00:01:00,160 --> 00:01:01,840
drones will come after you let me show

30
00:01:01,840 --> 00:01:03,359
you how to give your games beautiful

31
00:01:03,359 --> 00:01:05,360
visuals and how to apply many special

32
00:01:05,360 --> 00:01:07,360
features i came up with specifically for

33
00:01:07,360 --> 00:01:09,040
this class let's go

34
00:01:09,040 --> 00:01:10,640
these creatures have very similar

35
00:01:10,640 --> 00:01:13,040
physiology to the earth's seahorses body

36
00:01:13,040 --> 00:01:14,799
shape like this can cut easily through

37
00:01:14,799 --> 00:01:16,720
the thick atmosphere of this planet they

38
00:01:16,720 --> 00:01:19,119
can move very fast seahorse hive is

39
00:01:19,119 --> 00:01:21,040
being attacked by something this one has

40
00:01:21,040 --> 00:01:23,119
been damaged i wonder if we can hug this

41
00:01:23,119 --> 00:01:24,960
creature's central computer to control

42
00:01:24,960 --> 00:01:27,200
it for a while it is surprisingly easy

43
00:01:27,200 --> 00:01:29,280
to override its circuits seems like

44
00:01:29,280 --> 00:01:30,960
these machines are not used to our

45
00:01:30,960 --> 00:01:33,520
technology i'm getting a lot of new data

46
00:01:33,520 --> 00:01:35,360
ok explorers we are getting a stream of

47
00:01:35,360 --> 00:01:37,600
data about multiple different species we

48
00:01:37,600 --> 00:01:40,000
will convert their source code into html

49
00:01:40,000 --> 00:01:42,799
css and javascript let's analyze it line

50
00:01:42,799 --> 00:01:44,640
by line and see how it works we have a

51
00:01:44,640 --> 00:01:46,560
lot to learn i will answer all your

52
00:01:46,560 --> 00:01:48,159
questions as we discover more about

53
00:01:48,159 --> 00:01:50,560
their movement special abilities and how

54
00:01:50,560 --> 00:01:52,000
they interact with their planet's

55
00:01:52,000 --> 00:01:54,000
environment let's look under the hood of

56
00:01:54,000 --> 00:01:56,799
this alien ecosystem the atmosphere is

57
00:01:56,799 --> 00:01:58,560
thick enough to allow heavy silicon

58
00:01:58,560 --> 00:02:00,799
based lifeforms to float but smoke is

59
00:02:00,799 --> 00:02:02,719
blocking most of the sunlight many

60
00:02:02,719 --> 00:02:04,479
creatures developed artificial lights

61
00:02:04,479 --> 00:02:06,240
and glowing appendages to see through

62
00:02:06,240 --> 00:02:07,759
the heavy clouds

63
00:02:07,759 --> 00:02:09,920
seahorse sentinel has a basic attack

64
00:02:09,920 --> 00:02:12,080
that's powerful against weak enemies but

65
00:02:12,080 --> 00:02:13,680
if it absorbs energy from one of the

66
00:02:13,680 --> 00:02:15,599
overcharged creatures it gets additional

67
00:02:15,599 --> 00:02:17,760
firepower for a short period of time and

68
00:02:17,760 --> 00:02:20,319
it instantly replenishes its ammo ammo

69
00:02:20,319 --> 00:02:22,879
also automatically recharges over time

70
00:02:22,879 --> 00:02:24,720
it seems we just need to help it to get

71
00:02:24,720 --> 00:02:26,480
through these aggressive swarms in time

72
00:02:26,480 --> 00:02:28,560
so it can join its hive if this is your

73
00:02:28,560 --> 00:02:30,640
first time discovering javascript you

74
00:02:30,640 --> 00:02:32,480
should try some beginner classes first

75
00:02:32,480 --> 00:02:34,160
today's coding will be beginner friendly

76
00:02:34,160 --> 00:02:36,000
but i expect some basic knowledge of

77
00:02:36,000 --> 00:02:37,840
javascript when you get more comfortable

78
00:02:37,840 --> 00:02:40,080
with objects arrays and for loops come

79
00:02:40,080 --> 00:02:43,120
join me in this class

80
00:02:45,360 --> 00:02:47,599
so after a simple basic setup inside

81
00:02:47,599 --> 00:02:50,560
index.html and style css we move into

82
00:02:50,560 --> 00:02:53,360
script.js all javascript logic for this

83
00:02:53,360 --> 00:02:55,360
game will be written here inside this

84
00:02:55,360 --> 00:02:57,920
file i create an event listener for load

85
00:02:57,920 --> 00:03:00,319
event notice that we call it on built in

86
00:03:00,319 --> 00:03:02,080
javascript window object which

87
00:03:02,080 --> 00:03:04,319
represents the browser's window load

88
00:03:04,319 --> 00:03:06,239
event fires when the whole page has been

89
00:03:06,239 --> 00:03:08,640
loaded including all dependent resources

90
00:03:08,640 --> 00:03:11,040
such as style sheets and images we need

91
00:03:11,040 --> 00:03:12,879
to do this because we will use a lot of

92
00:03:12,879 --> 00:03:14,720
graphics in this project and they can

93
00:03:14,720 --> 00:03:16,640
take some time to load if you're trying

94
00:03:16,640 --> 00:03:18,480
to draw an image with the javascript

95
00:03:18,480 --> 00:03:20,159
remember that you always have to wait

96
00:03:20,159 --> 00:03:22,319
for that image to be fully loaded before

97
00:03:22,319 --> 00:03:24,400
you run the javascript code that depends

98
00:03:24,400 --> 00:03:26,480
on that image i usually like to do html

99
00:03:26,480 --> 00:03:28,159
kind of a setup like this custom

100
00:03:28,159 --> 00:03:30,159
variable i call for example canvas will

101
00:03:30,159 --> 00:03:32,560
store the reference to canvas element i

102
00:03:32,560 --> 00:03:34,480
point it towards that element using

103
00:03:34,480 --> 00:03:36,080
getelementbyid

104
00:03:36,080 --> 00:03:39,040
i give it an id of canvas1

105
00:03:39,040 --> 00:03:41,840
now i need so-called drawing context it

106
00:03:41,840 --> 00:03:44,080
is a built-in object that contains all

107
00:03:44,080 --> 00:03:46,239
methods and properties that allow us to

108
00:03:46,239 --> 00:03:49,280
draw and animate colors shapes and other

109
00:03:49,280 --> 00:03:52,000
graphics on html canvas to create it we

110
00:03:52,000 --> 00:03:53,519
need to call a special built-in

111
00:03:53,519 --> 00:03:55,920
getcontext method on a variable that

112
00:03:55,920 --> 00:03:58,480
holds a reference to canvas element so i

113
00:03:58,480 --> 00:04:02,000
say canvas dot get context and then i

114
00:04:02,000 --> 00:04:04,319
need to pass it identifier sometimes we

115
00:04:04,319 --> 00:04:07,040
call this argument a context type we can

116
00:04:07,040 --> 00:04:09,840
pass it 2d or webgl here webgl

117
00:04:09,840 --> 00:04:11,760
represents three-dimensional rendering

118
00:04:11,760 --> 00:04:14,560
context today we will work with 2d

119
00:04:14,560 --> 00:04:16,720
now i access width property on canvas

120
00:04:16,720 --> 00:04:20,239
from line 3 and i set it to 500 pixels

121
00:04:20,239 --> 00:04:22,320
height will be 500 as well

122
00:04:22,320 --> 00:04:24,639
as you can see 500 pixels is wider than

123
00:04:24,639 --> 00:04:26,720
my current browser size for that reason

124
00:04:26,720 --> 00:04:29,280
i also like to declare max with property

125
00:04:29,280 --> 00:04:32,400
and i set it to 100 percent that way the

126
00:04:32,400 --> 00:04:34,400
element will scale down until it's fully

127
00:04:34,400 --> 00:04:37,120
visible in the available browser area i

128
00:04:37,120 --> 00:04:38,880
also declare max height in case the

129
00:04:38,880 --> 00:04:40,720
restricting factor is the height of

130
00:04:40,720 --> 00:04:42,960
browser window doing this will make sure

131
00:04:42,960 --> 00:04:44,880
we can always see the entire canvas

132
00:04:44,880 --> 00:04:46,880
element even when the browser window is

133
00:04:46,880 --> 00:04:49,199
too small i will zoom out a bit to

134
00:04:49,199 --> 00:04:52,000
adjust my workplace for this tutorial

135
00:04:52,000 --> 00:04:54,400
i set canvas width to a larger value and

136
00:04:54,400 --> 00:04:56,320
keep my browser window small canvas

137
00:04:56,320 --> 00:04:58,080
element will scale down to make sure

138
00:04:58,080 --> 00:05:00,960
it's fully visible

139
00:05:04,400 --> 00:05:06,479
to build our game today we will use

140
00:05:06,479 --> 00:05:08,479
object oriented programming which means

141
00:05:08,479 --> 00:05:10,800
we will wrap variables and functions in

142
00:05:10,800 --> 00:05:13,600
objects javascript is a prototype-based

143
00:05:13,600 --> 00:05:15,440
object-oriented language which means it

144
00:05:15,440 --> 00:05:18,160
doesn't have classes it has prototypes

145
00:05:18,160 --> 00:05:20,479
but we can use modern javascript syntax

146
00:05:20,479 --> 00:05:22,720
that introduced classes as so-called

147
00:05:22,720 --> 00:05:25,039
syntactical sugar simplified clean

148
00:05:25,039 --> 00:05:27,520
syntax that mimics classes from other

149
00:05:27,520 --> 00:05:29,360
programming languages still under the

150
00:05:29,360 --> 00:05:30,720
hood it's just working with

151
00:05:30,720 --> 00:05:33,039
prototype-based inheritance one of the

152
00:05:33,039 --> 00:05:35,039
four main principles of object-oriented

153
00:05:35,039 --> 00:05:37,039
programming is encapsulation

154
00:05:37,039 --> 00:05:39,520
encapsulation is the bundling of data

155
00:05:39,520 --> 00:05:42,080
and the methods that act on that data in

156
00:05:42,080 --> 00:05:44,560
objects access to that data can be

157
00:05:44,560 --> 00:05:47,039
restricted from outside the bundle in

158
00:05:47,039 --> 00:05:49,520
this project i will encapsulate our data

159
00:05:49,520 --> 00:05:51,919
into multiple classes each class will

160
00:05:51,919 --> 00:05:53,919
have its special purpose the challenge

161
00:05:53,919 --> 00:05:55,759
for beginners will be to keep track of

162
00:05:55,759 --> 00:05:57,680
how these classes communicate with each

163
00:05:57,680 --> 00:05:59,680
other i will explain everything step by

164
00:05:59,680 --> 00:06:01,440
step as we write the code to help you

165
00:06:01,440 --> 00:06:03,280
understand we need to declare our

166
00:06:03,280 --> 00:06:05,360
classes in a specific order class

167
00:06:05,360 --> 00:06:07,680
declarations are hoisted in javascript

168
00:06:07,680 --> 00:06:10,479
but they stay uninitialized when hosted

169
00:06:10,479 --> 00:06:12,319
that means while javascript will be able

170
00:06:12,319 --> 00:06:14,479
to find the reference for a class name

171
00:06:14,479 --> 00:06:17,039
we create it cannot use the class before

172
00:06:17,039 --> 00:06:19,199
it is defined in the code this means

173
00:06:19,199 --> 00:06:21,199
that i need to declare input handler

174
00:06:21,199 --> 00:06:23,120
class first because i will need to use

175
00:06:23,120 --> 00:06:25,840
it inside player class and so on input

176
00:06:25,840 --> 00:06:27,360
handle class will keep track of

177
00:06:27,360 --> 00:06:29,680
specified user inputs for example arrow

178
00:06:29,680 --> 00:06:30,560
keys

179
00:06:30,560 --> 00:06:32,400
projectile class will handle player

180
00:06:32,400 --> 00:06:34,800
lasers particle class will deal with

181
00:06:34,800 --> 00:06:37,120
falling screws and bolts that come

182
00:06:37,120 --> 00:06:38,800
from damaged enemies

183
00:06:38,800 --> 00:06:40,319
player class will control the main

184
00:06:40,319 --> 00:06:42,240
character it will animate player sprite

185
00:06:42,240 --> 00:06:44,639
sheet and so on enemy class will be the

186
00:06:44,639 --> 00:06:46,639
main blueprint handling many different

187
00:06:46,639 --> 00:06:47,840
enemy types

188
00:06:47,840 --> 00:06:49,440
layer class will handle individual

189
00:06:49,440 --> 00:06:51,520
background layers in our parallax

190
00:06:51,520 --> 00:06:53,199
seamlessly scrolling multi-layered

191
00:06:53,199 --> 00:06:55,600
background and background class will

192
00:06:55,600 --> 00:06:58,240
pull all layer objects together to

193
00:06:58,240 --> 00:07:00,720
animate the entire game world

194
00:07:00,720 --> 00:07:03,520
ui class will draw score timer and other

195
00:07:03,520 --> 00:07:05,120
information that needs to be displayed

196
00:07:05,120 --> 00:07:06,319
for the user

197
00:07:06,319 --> 00:07:08,639
and the main game class will come last

198
00:07:08,639 --> 00:07:10,800
inside this game class all logic will

199
00:07:10,800 --> 00:07:12,800
come together this will be the brain of

200
00:07:12,800 --> 00:07:14,880
our project i hope this gives you a map

201
00:07:14,880 --> 00:07:16,720
of what we need to do to complete our

202
00:07:16,720 --> 00:07:19,120
game let's write javascript logic inside

203
00:07:19,120 --> 00:07:21,120
individual classes and connect them

204
00:07:21,120 --> 00:07:22,960
together i will explain everything step

205
00:07:22,960 --> 00:07:25,880
by step as we go along

206
00:07:25,880 --> 00:07:31,199
[Music]

207
00:07:31,199 --> 00:07:33,120
constructor is a special method on

208
00:07:33,120 --> 00:07:35,120
javascript class when i call this

209
00:07:35,120 --> 00:07:36,960
javascript class later using the new

210
00:07:36,960 --> 00:07:39,440
keyword constructor will create one new

211
00:07:39,440 --> 00:07:41,840
blank javascript object and it will

212
00:07:41,840 --> 00:07:44,160
assign its properties and values based

213
00:07:44,160 --> 00:07:46,479
on the blueprint inside player will need

214
00:07:46,479 --> 00:07:48,560
access to game weight and height and

215
00:07:48,560 --> 00:07:50,160
other properties that will be stored on

216
00:07:50,160 --> 00:07:52,080
the main game object so i will pass it

217
00:07:52,080 --> 00:07:54,400
the main game object as an argument like

218
00:07:54,400 --> 00:07:55,360
this

219
00:07:55,360 --> 00:07:57,840
i convert that game object into class

220
00:07:57,840 --> 00:08:00,800
property on player class like this

221
00:08:00,800 --> 00:08:02,960
i'm saying take this game object that

222
00:08:02,960 --> 00:08:05,039
was passed as an argument to the class

223
00:08:05,039 --> 00:08:07,440
constructor and turn it into class

224
00:08:07,440 --> 00:08:10,240
property called this dot game keep in

225
00:08:10,240 --> 00:08:12,400
mind that by doing this i'm not creating

226
00:08:12,400 --> 00:08:14,240
a copy of the main game object and

227
00:08:14,240 --> 00:08:16,160
placing it on player objects in

228
00:08:16,160 --> 00:08:18,400
javascript are so called reference data

229
00:08:18,400 --> 00:08:20,720
types which means that unlike primitive

230
00:08:20,720 --> 00:08:24,160
data types objects are dynamic in nature

231
00:08:24,160 --> 00:08:26,160
i'm just creating a reference that is

232
00:08:26,160 --> 00:08:28,400
pointing to the place in memory that

233
00:08:28,400 --> 00:08:30,960
stores the main game object so when the

234
00:08:30,960 --> 00:08:32,719
values and properties on the main game

235
00:08:32,719 --> 00:08:35,200
object get updated those changes will be

236
00:08:35,200 --> 00:08:37,120
immediately visible from this dot game

237
00:08:37,120 --> 00:08:40,399
reference inside this player class

238
00:08:40,399 --> 00:08:42,320
i made the size of player sprite sheet

239
00:08:42,320 --> 00:08:44,159
the same size as we will draw them in

240
00:08:44,159 --> 00:08:46,480
game it's a good practice i know that

241
00:08:46,480 --> 00:08:48,480
the width of a single frame in my sprite

242
00:08:48,480 --> 00:08:52,399
sheet is 120 pixels and height is 190.

243
00:08:52,399 --> 00:08:54,240
if you are a beginner it's best if you

244
00:08:54,240 --> 00:08:56,160
use the same sprites and images i'm

245
00:08:56,160 --> 00:08:58,560
using it will make the debugging easier

246
00:08:58,560 --> 00:09:00,640
in case you run into problems you can

247
00:09:00,640 --> 00:09:02,880
always check my code to find the problem

248
00:09:02,880 --> 00:09:04,640
all art assets i'm using are linked

249
00:09:04,640 --> 00:09:06,240
below you can download them from the

250
00:09:06,240 --> 00:09:08,640
project section starting horizontal x

251
00:09:08,640 --> 00:09:10,240
coordinate on the player will be 20

252
00:09:10,240 --> 00:09:13,839
pixels and vertical y position is 100

253
00:09:13,839 --> 00:09:15,680
player will also need an update method

254
00:09:15,680 --> 00:09:17,920
to move it around and draw a method that

255
00:09:17,920 --> 00:09:19,760
will draw graphics representing the

256
00:09:19,760 --> 00:09:22,480
player

257
00:09:22,480 --> 00:09:24,240
for now let's start by increasing

258
00:09:24,240 --> 00:09:26,080
vertical y position on the player by

259
00:09:26,080 --> 00:09:28,720
speed y i need to declare that property

260
00:09:28,720 --> 00:09:31,279
here it will be 0 at first so no

261
00:09:31,279 --> 00:09:33,200
vertical movement

262
00:09:33,200 --> 00:09:35,120
draw method will take context as an

263
00:09:35,120 --> 00:09:37,519
argument this will specify which canvas

264
00:09:37,519 --> 00:09:39,839
element we want to draw on in case our

265
00:09:39,839 --> 00:09:41,680
game has multiple layers with multiple

266
00:09:41,680 --> 00:09:43,600
canvas elements it's also a good

267
00:09:43,600 --> 00:09:45,680
practice to use context argument like

268
00:09:45,680 --> 00:09:47,760
this rather than pulling ctx variable

269
00:09:47,760 --> 00:09:49,920
from the outside directly into our

270
00:09:49,920 --> 00:09:50,959
objects

271
00:09:50,959 --> 00:09:52,959
at first i will just draw a simple black

272
00:09:52,959 --> 00:09:55,200
rectangle representing the player so

273
00:09:55,200 --> 00:09:57,600
built in canvas fill rectangle method

274
00:09:57,600 --> 00:09:59,760
and i want to draw the rectangle at

275
00:09:59,760 --> 00:10:02,320
player's current x and y position and it

276
00:10:02,320 --> 00:10:04,880
will have players with and height

277
00:10:04,880 --> 00:10:07,040
so we have our player object how do we

278
00:10:07,040 --> 00:10:09,120
include it inside game logic and draw it

279
00:10:09,120 --> 00:10:11,839
on canvas as i said the main game class

280
00:10:11,839 --> 00:10:14,079
from line 45 will be the brain of our

281
00:10:14,079 --> 00:10:16,240
entire project all the logic will

282
00:10:16,240 --> 00:10:19,040
somehow go through it again i will give

283
00:10:19,040 --> 00:10:21,360
it a constructor constructor will need

284
00:10:21,360 --> 00:10:23,680
width and height of canvas as arguments

285
00:10:23,680 --> 00:10:26,480
and inside we convert them into class

286
00:10:26,480 --> 00:10:28,640
properties this will make sure

287
00:10:28,640 --> 00:10:30,640
that the width and height of the game

288
00:10:30,640 --> 00:10:33,279
matches the size of canvas element

289
00:10:33,279 --> 00:10:35,120
constructor on javascript class is a

290
00:10:35,120 --> 00:10:37,200
special type of method that will run

291
00:10:37,200 --> 00:10:39,680
once when we instantiate the class using

292
00:10:39,680 --> 00:10:42,399
the new keyword it will create one new

293
00:10:42,399 --> 00:10:44,959
blank object and it will give it values

294
00:10:44,959 --> 00:10:47,360
and properties as defined inside the

295
00:10:47,360 --> 00:10:48,959
blueprint here

296
00:10:48,959 --> 00:10:51,440
i can take an advantage of the fact that

297
00:10:51,440 --> 00:10:54,240
all the code inside the constructor gets

298
00:10:54,240 --> 00:10:56,640
automatically executed like this and any

299
00:10:56,640 --> 00:10:58,720
code i put inside the constructor on

300
00:10:58,720 --> 00:11:01,600
game class will automatically run when i

301
00:11:01,600 --> 00:11:04,000
instantiate my game in a minute so when

302
00:11:04,000 --> 00:11:06,399
i instantiate game class i want it to

303
00:11:06,399 --> 00:11:08,079
automatically create an instance of

304
00:11:08,079 --> 00:11:10,880
player class and i want that instance to

305
00:11:10,880 --> 00:11:13,519
become class property on game class

306
00:11:13,519 --> 00:11:16,959
called this dot player so this.player is

307
00:11:16,959 --> 00:11:20,000
equal to new player like this the new

308
00:11:20,000 --> 00:11:21,519
keyword is a special command in

309
00:11:21,519 --> 00:11:24,000
javascript it will look for class with

310
00:11:24,000 --> 00:11:26,240
this name in this case player and it

311
00:11:26,240 --> 00:11:28,079
will run its constructor method to

312
00:11:28,079 --> 00:11:30,000
create one instance of it based on the

313
00:11:30,000 --> 00:11:32,240
blueprint inside so by calling new

314
00:11:32,240 --> 00:11:35,200
player online 49 javascript will find

315
00:11:35,200 --> 00:11:38,079
player class up here on line 17 and it

316
00:11:38,079 --> 00:11:39,760
will run all the code inside its

317
00:11:39,760 --> 00:11:42,320
constructor i can see that constructor

318
00:11:42,320 --> 00:11:44,560
method on player class needs game as an

319
00:11:44,560 --> 00:11:46,959
argument down here we are inside that

320
00:11:46,959 --> 00:11:49,760
game class so i pass it this keyword

321
00:11:49,760 --> 00:11:52,079
this keyword used inside this class

322
00:11:52,079 --> 00:11:55,360
refers to this entire game object

323
00:11:55,360 --> 00:11:57,200
our game will also need update and draw

324
00:11:57,200 --> 00:11:58,720
methods

325
00:11:58,720 --> 00:12:00,640
update method will take this.player

326
00:12:00,640 --> 00:12:02,959
property from line 49 which holds an

327
00:12:02,959 --> 00:12:05,279
instance of player object and it will

328
00:12:05,279 --> 00:12:07,600
call its update method we defined online

329
00:12:07,600 --> 00:12:08,880
26.

330
00:12:08,880 --> 00:12:10,720
inside draw method we will render the

331
00:12:10,720 --> 00:12:12,720
player on canvas by calling draw method

332
00:12:12,720 --> 00:12:15,760
from line 29. i can see that it expects

333
00:12:15,760 --> 00:12:17,839
context as an argument so i pass it

334
00:12:17,839 --> 00:12:20,639
context like this and that value will be

335
00:12:20,639 --> 00:12:22,160
passed along here

336
00:12:22,160 --> 00:12:24,000
now i create an instance of this new

337
00:12:24,000 --> 00:12:26,079
game class we just wrote and i save it

338
00:12:26,079 --> 00:12:28,720
in a variable i call for example game

339
00:12:28,720 --> 00:12:31,760
it's equal to new game like this again

340
00:12:31,760 --> 00:12:33,600
new keyword will look for class with

341
00:12:33,600 --> 00:12:36,880
that name it will find it on line 45 and

342
00:12:36,880 --> 00:12:38,800
it will run its constructor method to

343
00:12:38,800 --> 00:12:41,279
create one new blank javascript object

344
00:12:41,279 --> 00:12:43,440
and assign it values and properties

345
00:12:43,440 --> 00:12:45,680
based on the blueprint here

346
00:12:45,680 --> 00:12:47,920
on line 46 i can see that game class

347
00:12:47,920 --> 00:12:50,000
constructor expects width and height as

348
00:12:50,000 --> 00:12:52,079
arguments so i pass it canvas width from

349
00:12:52,079 --> 00:12:56,959
line 5 and canvas height from line 6.

350
00:12:57,760 --> 00:12:59,760
so the new keyword triggers a class

351
00:12:59,760 --> 00:13:01,680
constructor as the constructor gets

352
00:13:01,680 --> 00:13:04,399
executed we hit this line which will

353
00:13:04,399 --> 00:13:06,000
automatically create an instance of

354
00:13:06,000 --> 00:13:08,320
player class from line 17.

355
00:13:08,320 --> 00:13:10,399
so this is how by creating the main game

356
00:13:10,399 --> 00:13:12,480
object we also automatically create

357
00:13:12,480 --> 00:13:14,880
player object and now it sits as a

358
00:13:14,880 --> 00:13:18,000
property on the game class on line 49

359
00:13:18,000 --> 00:13:19,300
perfect

360
00:13:19,300 --> 00:13:23,920
[Music]

361
00:13:23,920 --> 00:13:25,839
we will also need animation loop that

362
00:13:25,839 --> 00:13:27,760
will run update and draw methods over

363
00:13:27,760 --> 00:13:30,240
and over 60 times per second updating

364
00:13:30,240 --> 00:13:32,639
positions and redrawing our game i

365
00:13:32,639 --> 00:13:34,240
create a custom function i call for

366
00:13:34,240 --> 00:13:36,560
example animate inside i take the

367
00:13:36,560 --> 00:13:39,200
instance of game class from line 59 and

368
00:13:39,200 --> 00:13:41,440
i call its associated update method we

369
00:13:41,440 --> 00:13:44,160
declared on line 51. i will also call

370
00:13:44,160 --> 00:13:47,120
draw method from line 54 like this i can

371
00:13:47,120 --> 00:13:49,440
see it expects context as an argument to

372
00:13:49,440 --> 00:13:51,600
specify which canvas element we are

373
00:13:51,600 --> 00:13:53,360
drawing on so

374
00:13:53,360 --> 00:13:56,079
i pass it ctx from line 4

375
00:13:56,079 --> 00:13:58,320
this means that this ctx variable will

376
00:13:58,320 --> 00:14:00,639
be passed here and it will get passed

377
00:14:00,639 --> 00:14:02,800
along to draw method on player object

378
00:14:02,800 --> 00:14:03,600
here

379
00:14:03,600 --> 00:14:05,360
now the player knows where we want to

380
00:14:05,360 --> 00:14:06,480
draw it

381
00:14:06,480 --> 00:14:08,560
after we called update and draw we want

382
00:14:08,560 --> 00:14:10,639
to trigger the next animation frame so i

383
00:14:10,639 --> 00:14:13,199
call built in request animation frame

384
00:14:13,199 --> 00:14:15,279
request animation frame method sits on

385
00:14:15,279 --> 00:14:17,440
the window object but we can also call

386
00:14:17,440 --> 00:14:19,120
it just like this

387
00:14:19,120 --> 00:14:20,880
it tells the browser that we wish to

388
00:14:20,880 --> 00:14:23,440
perform an animation and it requests

389
00:14:23,440 --> 00:14:25,279
that the browser calls a specified

390
00:14:25,279 --> 00:14:28,000
function to update an animation before

391
00:14:28,000 --> 00:14:29,680
the next repaint

392
00:14:29,680 --> 00:14:31,600
so we need to pass it one argument and

393
00:14:31,600 --> 00:14:33,440
it will be the method we want to call

394
00:14:33,440 --> 00:14:35,920
before the repaint before browser window

395
00:14:35,920 --> 00:14:38,720
gets updated and redrawn on screen

396
00:14:38,720 --> 00:14:40,800
i pass it animate the name of its parent

397
00:14:40,800 --> 00:14:43,040
function to create an endless animation

398
00:14:43,040 --> 00:14:45,600
loop request animation frame has two

399
00:14:45,600 --> 00:14:48,240
special features it adjusts the user's

400
00:14:48,240 --> 00:14:50,240
screen refresh rate for most of us it

401
00:14:50,240 --> 00:14:52,720
will be 60 frames per second it also

402
00:14:52,720 --> 00:14:55,040
auto generates a timestamp argument and

403
00:14:55,040 --> 00:14:56,959
passes that as an argument to its

404
00:14:56,959 --> 00:14:58,959
callback function a little bit later i

405
00:14:58,959 --> 00:15:00,720
will show you how to use this feature to

406
00:15:00,720 --> 00:15:02,959
create periodic events in our project

407
00:15:02,959 --> 00:15:06,959
events that repeat in a certain interval

408
00:15:07,519 --> 00:15:09,440
i get an error because i misspelled the

409
00:15:09,440 --> 00:15:11,839
word constructor here i'm using vs code

410
00:15:11,839 --> 00:15:14,000
editor it highlights syntax in different

411
00:15:14,000 --> 00:15:15,760
colors which makes it easier to notice

412
00:15:15,760 --> 00:15:18,160
typos like this we have our main game

413
00:15:18,160 --> 00:15:20,000
logic and we are drawing this black

414
00:15:20,000 --> 00:15:22,639
rectangle representing our player

415
00:15:22,639 --> 00:15:24,160
it looks static but it's actually

416
00:15:24,160 --> 00:15:26,160
animating we can test that by giving

417
00:15:26,160 --> 00:15:28,079
players some value here in speed y

418
00:15:28,079 --> 00:15:30,639
property

419
00:15:30,959 --> 00:15:33,040
the reason the rectangle gets longer now

420
00:15:33,040 --> 00:15:35,519
is because we can see old paint we can

421
00:15:35,519 --> 00:15:38,399
see old black rectangles that were drawn

422
00:15:38,399 --> 00:15:40,720
in the previous animation loops i can

423
00:15:40,720 --> 00:15:42,959
fix that by deleting all canvas drawings

424
00:15:42,959 --> 00:15:45,199
between each animation frame between

425
00:15:45,199 --> 00:15:47,199
every animation loop i call built in

426
00:15:47,199 --> 00:15:49,279
clear rectangle method and i want to

427
00:15:49,279 --> 00:15:51,920
clear canvas from coordinates 0 0 to

428
00:15:51,920 --> 00:15:54,480
canvas with canvas height like this now

429
00:15:54,480 --> 00:15:56,480
you can see that because player speed y

430
00:15:56,480 --> 00:15:58,959
property is set to plus 1 the player

431
00:15:58,959 --> 00:16:01,519
moves by 1 pixel per frame in positive

432
00:16:01,519 --> 00:16:05,120
direction on vertical y axis if speed y

433
00:16:05,120 --> 00:16:07,839
is -1 player will move upwards if speed

434
00:16:07,839 --> 00:16:10,240
y is 0 the player will not move at all

435
00:16:10,240 --> 00:16:12,000
it's all because for every animation

436
00:16:12,000 --> 00:16:14,720
frame we are adding speed y property to

437
00:16:14,720 --> 00:16:16,639
player's vertical y coordinate here on

438
00:16:16,639 --> 00:16:18,800
line 27 we know that everything is

439
00:16:18,800 --> 00:16:20,880
working well it's good to test your code

440
00:16:20,880 --> 00:16:22,480
as you go step by step to discover

441
00:16:22,480 --> 00:16:24,720
potential problems i want the player to

442
00:16:24,720 --> 00:16:26,560
be controlled by keyboard when i press

443
00:16:26,560 --> 00:16:30,079
up arrow we set speed y to -1 and player

444
00:16:30,079 --> 00:16:32,240
will move up when i press down arrow we

445
00:16:32,240 --> 00:16:34,320
set speed wire to plus 1 and player will

446
00:16:34,320 --> 00:16:37,000
move down

447
00:16:37,000 --> 00:16:42,399
[Music]

448
00:16:42,399 --> 00:16:44,480
we will handle all player input up here

449
00:16:44,480 --> 00:16:46,880
inside input handler class constructor

450
00:16:46,880 --> 00:16:49,120
will take a game as an argument same as

451
00:16:49,120 --> 00:16:51,880
we did with the player i converted into

452
00:16:51,880 --> 00:16:54,399
this.gameclass property as we said

453
00:16:54,399 --> 00:16:56,240
before when we create an instance of a

454
00:16:56,240 --> 00:16:58,240
class all the code inside class

455
00:16:58,240 --> 00:17:00,880
constructor gets executed we can take

456
00:17:00,880 --> 00:17:03,040
advantage of that and i can even apply

457
00:17:03,040 --> 00:17:05,360
event listeners from here i simply

458
00:17:05,360 --> 00:17:07,520
choose apply event listener like this we

459
00:17:07,520 --> 00:17:09,919
will listen for key down event callback

460
00:17:09,919 --> 00:17:12,000
function on event listener has a special

461
00:17:12,000 --> 00:17:14,319
auto generated argument that contains

462
00:17:14,319 --> 00:17:16,160
all kinds of additional details about

463
00:17:16,160 --> 00:17:18,880
the event that just happened if i want

464
00:17:18,880 --> 00:17:20,880
more details about the keydown event i

465
00:17:20,880 --> 00:17:22,880
just need to pick a variable name and i

466
00:17:22,880 --> 00:17:25,280
pass it as an argument to the callback

467
00:17:25,280 --> 00:17:27,520
usually we use letter e or the word

468
00:17:27,520 --> 00:17:30,320
event but you can also type abc whatever

469
00:17:30,320 --> 00:17:31,919
you put here will become a custom

470
00:17:31,919 --> 00:17:34,000
variable name containing a special

471
00:17:34,000 --> 00:17:36,320
object with additional information about

472
00:17:36,320 --> 00:17:38,799
the keydown event that just happened i

473
00:17:38,799 --> 00:17:41,360
will save it in a variable i call e and

474
00:17:41,360 --> 00:17:43,200
i will console log it if you choose

475
00:17:43,200 --> 00:17:44,960
console.log e you will get the full

476
00:17:44,960 --> 00:17:47,200
event object with many properties i've

477
00:17:47,200 --> 00:17:49,039
done this before so i know i want a

478
00:17:49,039 --> 00:17:51,520
specific property called key so i

479
00:17:51,520 --> 00:17:54,559
console e dot key this will contain a

480
00:17:54,559 --> 00:17:56,640
string with the name of the key that was

481
00:17:56,640 --> 00:17:58,640
pressed let me show you

482
00:17:58,640 --> 00:18:00,480
i need to create an instance of input

483
00:18:00,480 --> 00:18:02,640
handle class so as we did with the

484
00:18:02,640 --> 00:18:04,720
player i want my input class to be

485
00:18:04,720 --> 00:18:07,360
instantiated automatically as i create

486
00:18:07,360 --> 00:18:10,400
my main game class so here inside the

487
00:18:10,400 --> 00:18:12,080
game class constructor i create a

488
00:18:12,080 --> 00:18:14,480
property i call for example this dot

489
00:18:14,480 --> 00:18:17,760
input i set it the new input handler and

490
00:18:17,760 --> 00:18:20,000
i know its constructor expects game as

491
00:18:20,000 --> 00:18:22,559
an argument so same as we did with the

492
00:18:22,559 --> 00:18:25,280
player i pass it this referring to this

493
00:18:25,280 --> 00:18:27,840
entire game class so now as i create

494
00:18:27,840 --> 00:18:30,000
game object down here it automatically

495
00:18:30,000 --> 00:18:32,799
creates player object on line 54 and

496
00:18:32,799 --> 00:18:36,160
input object on line 55. as we call the

497
00:18:36,160 --> 00:18:39,200
new keyword on line 55 javascript will

498
00:18:39,200 --> 00:18:42,000
jump to line 9 and it will run input

499
00:18:42,000 --> 00:18:44,000
handler class constructor which will

500
00:18:44,000 --> 00:18:46,160
among other things apply this key down

501
00:18:46,160 --> 00:18:48,000
event listener that's console login the

502
00:18:48,000 --> 00:18:50,400
current key that is pressed i open

503
00:18:50,400 --> 00:18:52,400
browser console i click on canvas

504
00:18:52,400 --> 00:18:54,880
element so it starts registering events

505
00:18:54,880 --> 00:18:57,039
and now when i press keys on my keyboard

506
00:18:57,039 --> 00:18:58,799
you can see we are console logging the

507
00:18:58,799 --> 00:19:01,679
key property

508
00:19:02,799 --> 00:19:05,200
inside key down event listener i say if

509
00:19:05,200 --> 00:19:08,640
e.k is arrow up

510
00:19:08,640 --> 00:19:12,720
take keys array on the game object

511
00:19:13,360 --> 00:19:15,520
we will create that array in a second

512
00:19:15,520 --> 00:19:19,520
and push that key into the array

513
00:19:22,400 --> 00:19:24,640
i create that array here on line 59

514
00:19:24,640 --> 00:19:27,280
inside game class constructor its job

515
00:19:27,280 --> 00:19:29,280
will be to keep track of all keys that

516
00:19:29,280 --> 00:19:31,440
are currently active that are currently

517
00:19:31,440 --> 00:19:33,200
being pressed down

518
00:19:33,200 --> 00:19:35,520
i will console.log this.game.keys from

519
00:19:35,520 --> 00:19:37,919
here to check if arrow up key is being

520
00:19:37,919 --> 00:19:40,559
correctly added i get a console error

521
00:19:40,559 --> 00:19:42,240
that is saying that the variable name

522
00:19:42,240 --> 00:19:45,280
i'm calling keys from is undefined by

523
00:19:45,280 --> 00:19:46,880
the time this callback function is

524
00:19:46,880 --> 00:19:48,799
executed javascript forgot what

525
00:19:48,799 --> 00:19:51,120
this.game stands for which object it

526
00:19:51,120 --> 00:19:52,720
points towards

527
00:19:52,720 --> 00:19:54,880
we want javascript to remember that this

528
00:19:54,880 --> 00:19:57,840
code initially sits inside this object

529
00:19:57,840 --> 00:19:59,600
so that it can see and remember

530
00:19:59,600 --> 00:20:01,760
this.game property even when we call it

531
00:20:01,760 --> 00:20:03,760
later as we play our game

532
00:20:03,760 --> 00:20:05,200
if you are a beginner don't worry about

533
00:20:05,200 --> 00:20:06,960
fully understanding this yet all you

534
00:20:06,960 --> 00:20:08,880
need to know here is that if javascript

535
00:20:08,880 --> 00:20:11,520
forgets what this keyword stands for we

536
00:20:11,520 --> 00:20:13,280
need to bind that code to the

537
00:20:13,280 --> 00:20:15,520
surrounding codes context

538
00:20:15,520 --> 00:20:17,600
we can use built in javascript bind

539
00:20:17,600 --> 00:20:20,720
method or even simpler we can use es6

540
00:20:20,720 --> 00:20:23,600
arrow function syntax here

541
00:20:23,600 --> 00:20:25,440
a special feature of arrow function is

542
00:20:25,440 --> 00:20:27,600
that this keyword inside arrow function

543
00:20:27,600 --> 00:20:29,520
always represents the object in which

544
00:20:29,520 --> 00:20:31,760
the arrow function is defined arrow

545
00:20:31,760 --> 00:20:33,919
function will never forget that it was

546
00:20:33,919 --> 00:20:36,320
originally defined inside constructor on

547
00:20:36,320 --> 00:20:38,720
input handler class and it will always

548
00:20:38,720 --> 00:20:40,799
see this reference for this.game from

549
00:20:40,799 --> 00:20:43,039
line 10. therefore it will be able to

550
00:20:43,039 --> 00:20:45,679
access this.game.keys and push keys

551
00:20:45,679 --> 00:20:48,400
inside now everything is working when i

552
00:20:48,400 --> 00:20:50,640
press up arrow key it gets added into

553
00:20:50,640 --> 00:20:52,240
this.game.keys

554
00:20:52,240 --> 00:20:54,000
and if i press it multiple times it

555
00:20:54,000 --> 00:20:55,760
keeps adding more and more so i create

556
00:20:55,760 --> 00:20:58,880
another event listener

557
00:21:00,240 --> 00:21:02,559
this time for keyup event

558
00:21:02,559 --> 00:21:04,640
when we release the key i want to remove

559
00:21:04,640 --> 00:21:06,799
it from the array i do that by checking

560
00:21:06,799 --> 00:21:08,880
if the array contains that key so built

561
00:21:08,880 --> 00:21:11,679
in index of array method

562
00:21:11,679 --> 00:21:13,919
the indexof method returns the first

563
00:21:13,919 --> 00:21:16,159
index at which a given element can be

564
00:21:16,159 --> 00:21:19,600
found in the array or it returns -1 if

565
00:21:19,600 --> 00:21:22,120
the element is not present so if

566
00:21:22,120 --> 00:21:24,720
this.game.key's index off is more than

567
00:21:24,720 --> 00:21:27,520
-1 meaning if key's array contains the

568
00:21:27,520 --> 00:21:29,679
key that is currently being released in

569
00:21:29,679 --> 00:21:32,720
this key up event take this.game.keys

570
00:21:32,720 --> 00:21:34,880
array and remove that element from the

571
00:21:34,880 --> 00:21:37,600
array using splice method the splice

572
00:21:37,600 --> 00:21:39,840
method changes the contents of an array

573
00:21:39,840 --> 00:21:42,159
by removing or replacing existing

574
00:21:42,159 --> 00:21:43,520
elements

575
00:21:43,520 --> 00:21:45,280
splice method needs at least two

576
00:21:45,280 --> 00:21:47,440
arguments the first argument is the

577
00:21:47,440 --> 00:21:49,760
index at which we want to start changing

578
00:21:49,760 --> 00:21:51,919
the array so it will be the index of

579
00:21:51,919 --> 00:21:54,640
that key we want to remove like this

580
00:21:54,640 --> 00:21:57,280
and the second argument is delete count

581
00:21:57,280 --> 00:21:59,360
an integer indicating the number of

582
00:21:59,360 --> 00:22:01,919
elements in the array we want to remove

583
00:22:01,919 --> 00:22:04,240
from that starting index

584
00:22:04,240 --> 00:22:06,640
so i call splice i want to remove

585
00:22:06,640 --> 00:22:09,440
elements starting from this index and i

586
00:22:09,440 --> 00:22:11,840
want to remove only one element at that

587
00:22:11,840 --> 00:22:12,880
index

588
00:22:12,880 --> 00:22:14,799
i put the same counter lock inside key

589
00:22:14,799 --> 00:22:17,200
up event you can see that it works well

590
00:22:17,200 --> 00:22:19,760
when i press up arrow it gets added when

591
00:22:19,760 --> 00:22:22,080
i release it it gets removed added

592
00:22:22,080 --> 00:22:24,880
removed nice the problem is when i hold

593
00:22:24,880 --> 00:22:27,280
up arrow key down for too long key down

594
00:22:27,280 --> 00:22:29,360
event will start firing over and over

595
00:22:29,360 --> 00:22:31,440
but key up event doesn't fire so we are

596
00:22:31,440 --> 00:22:33,200
not removing those keys we are adding

597
00:22:33,200 --> 00:22:35,280
multiple keys we are adding the same key

598
00:22:35,280 --> 00:22:37,200
over and over increasing the size of the

599
00:22:37,200 --> 00:22:39,760
array this can also be fixed easily i

600
00:22:39,760 --> 00:22:42,320
only want to add that key into this.keys

601
00:22:42,320 --> 00:22:44,640
array if it's not already present in

602
00:22:44,640 --> 00:22:47,600
there so additional condition here

603
00:22:47,600 --> 00:22:50,320
if this.game.keys

604
00:22:50,320 --> 00:22:53,280
index off the key that was just pressed

605
00:22:53,280 --> 00:22:56,080
is -1

606
00:22:56,080 --> 00:22:58,159
now when i press and hold the key gets

607
00:22:58,159 --> 00:23:00,159
added only once when i release the

608
00:23:00,159 --> 00:23:03,039
button the key gets removed perfect on

609
00:23:03,039 --> 00:23:05,760
keydown event i check if key that was

610
00:23:05,760 --> 00:23:08,320
pressed is arrow up and at the same time

611
00:23:08,320 --> 00:23:10,640
i check if arrow up is not yet in the

612
00:23:10,640 --> 00:23:13,440
array only then i push arrow up into

613
00:23:13,440 --> 00:23:15,360
this dot keys array

614
00:23:15,360 --> 00:23:17,679
on key up event i check if the key that

615
00:23:17,679 --> 00:23:20,159
we are releasing is present in the array

616
00:23:20,159 --> 00:23:23,120
if it is i remove it using splice method

617
00:23:23,120 --> 00:23:24,960
we have the main logic now and adding

618
00:23:24,960 --> 00:23:27,200
more keys is easy just be careful about

619
00:23:27,200 --> 00:23:28,720
brackets here it's easy to miss

620
00:23:28,720 --> 00:23:30,559
something and get an error

621
00:23:30,559 --> 00:23:32,400
i wrap this part in another set of

622
00:23:32,400 --> 00:23:34,400
brackets and i check if key that is

623
00:23:34,400 --> 00:23:37,440
pressed is arrow up or arrow down like

624
00:23:37,440 --> 00:23:39,679
this

625
00:23:43,280 --> 00:23:45,360
now keys array on the main object can

626
00:23:45,360 --> 00:23:48,159
contain nothing and can be empty or it

627
00:23:48,159 --> 00:23:51,200
can contain up arrow key or arrow down

628
00:23:51,200 --> 00:23:53,440
key and it can even contain multiple

629
00:23:53,440 --> 00:23:55,520
keys at the same time in our case both

630
00:23:55,520 --> 00:23:58,480
arrow up and arrow down so now keys

631
00:23:58,480 --> 00:24:00,320
property on the main game object is an

632
00:24:00,320 --> 00:24:02,799
array that always keeps track of presses

633
00:24:02,799 --> 00:24:06,960
and releases of up and down arrow keys

634
00:24:06,960 --> 00:24:08,720
i store this array on the main game

635
00:24:08,720 --> 00:24:11,760
object on line 67 so the information of

636
00:24:11,760 --> 00:24:13,440
what keys are currently pressed is

637
00:24:13,440 --> 00:24:15,840
available all over our code base it's

638
00:24:15,840 --> 00:24:18,159
also available inside our player class

639
00:24:18,159 --> 00:24:19,679
because player has this dot game

640
00:24:19,679 --> 00:24:22,400
property here on line 35 pointing

641
00:24:22,400 --> 00:24:24,480
towards the main game object

642
00:24:24,480 --> 00:24:26,960
i can simply check if this.game.keys

643
00:24:26,960 --> 00:24:29,520
includes a specific key and i can change

644
00:24:29,520 --> 00:24:32,840
player behavior from here i check if

645
00:24:32,840 --> 00:24:35,440
this.game.keys includes arrow up notice

646
00:24:35,440 --> 00:24:37,600
that before i use index of method to

647
00:24:37,600 --> 00:24:39,279
check if element can be found in the

648
00:24:39,279 --> 00:24:41,919
array i can also alternatively use built

649
00:24:41,919 --> 00:24:44,159
in javascript includes method to do the

650
00:24:44,159 --> 00:24:45,360
same thing

651
00:24:45,360 --> 00:24:47,440
the includes method determines whether

652
00:24:47,440 --> 00:24:49,760
an array includes a certain value among

653
00:24:49,760 --> 00:24:52,320
its entries returning true or false as

654
00:24:52,320 --> 00:24:53,600
appropriate

655
00:24:53,600 --> 00:24:55,919
if this line returns true we want player

656
00:24:55,919 --> 00:24:58,320
to move up so we set speed y from line

657
00:24:58,320 --> 00:25:01,840
40 to -1 else if keys array includes

658
00:25:01,840 --> 00:25:06,400
arrow down we set speed y to plus 1.

659
00:25:06,400 --> 00:25:09,039
i save changes and click canvas and now

660
00:25:09,039 --> 00:25:10,799
i can move player up and down by

661
00:25:10,799 --> 00:25:13,279
pressing up and down arrow keys the only

662
00:25:13,279 --> 00:25:15,360
problem is that player will never stop

663
00:25:15,360 --> 00:25:17,520
moving we need to add one more small

664
00:25:17,520 --> 00:25:20,960
condition so else meaning this.game.keys

665
00:25:20,960 --> 00:25:23,440
array doesn't include arrow up or arrow

666
00:25:23,440 --> 00:25:26,480
down we set speed y to zero

667
00:25:26,480 --> 00:25:28,320
instead of hard coding minus one and

668
00:25:28,320 --> 00:25:30,080
plus one here maybe player speed is

669
00:25:30,080 --> 00:25:32,240
dynamic and player can speed up during a

670
00:25:32,240 --> 00:25:34,480
power up for that purpose it's better to

671
00:25:34,480 --> 00:25:37,200
save max speed in a variable like this

672
00:25:37,200 --> 00:25:39,039
so we have current player speed on line

673
00:25:39,039 --> 00:25:42,799
40 and maximum player speed on line 41.

674
00:25:42,799 --> 00:25:45,360
let's try 2 pixels per frame and i

675
00:25:45,360 --> 00:25:47,600
replace hard-coded values with variables

676
00:25:47,600 --> 00:25:50,159
on lines 44 and 45.

677
00:25:50,159 --> 00:25:52,880
if we press arrow up speed y is minus

678
00:25:52,880 --> 00:25:55,760
max speed if we press arrow down speed y

679
00:25:55,760 --> 00:25:58,559
is plus max speed like this now we can

680
00:25:58,559 --> 00:26:00,320
change player movement speed if we need

681
00:26:00,320 --> 00:26:02,799
to by changing max speed value on line

682
00:26:02,799 --> 00:26:05,120
41 and this is one of the techniques i

683
00:26:05,120 --> 00:26:07,120
like to use to handle keyboard inputs in

684
00:26:07,120 --> 00:26:09,120
my games if you have any questions or

685
00:26:09,120 --> 00:26:10,960
any suggestions how to improve this code

686
00:26:10,960 --> 00:26:14,480
let me know by leaving a comment

687
00:26:16,730 --> 00:26:23,200
[Music]

688
00:26:23,200 --> 00:26:24,880
player will be shooting lasers at

689
00:26:24,880 --> 00:26:27,120
enemies we will create them by using a

690
00:26:27,120 --> 00:26:29,919
class i call projectile constructor will

691
00:26:29,919 --> 00:26:31,840
need three arguments the main game

692
00:26:31,840 --> 00:26:34,000
object so that this class has access to

693
00:26:34,000 --> 00:26:36,400
game properties when it needs them and

694
00:26:36,400 --> 00:26:38,799
starting x and y coordinates those need

695
00:26:38,799 --> 00:26:40,880
to be dynamic passed as arguments from

696
00:26:40,880 --> 00:26:42,480
here because starting coordinates of

697
00:26:42,480 --> 00:26:44,960
each projectile will depend on player's

698
00:26:44,960 --> 00:26:47,600
current position as usual i convert the

699
00:26:47,600 --> 00:26:50,159
arguments past to class constructor into

700
00:26:50,159 --> 00:26:51,760
class properties

701
00:26:51,760 --> 00:26:55,120
width will be 10 pixels

702
00:26:55,760 --> 00:26:59,120
height will be 3 pixels

703
00:27:00,320 --> 00:27:04,159
speed will be 3 pixels per frame

704
00:27:04,400 --> 00:27:05,919
update method will also increase

705
00:27:05,919 --> 00:27:08,640
horizontal x coordinate from line 30 by

706
00:27:08,640 --> 00:27:11,279
speed from line 34.

707
00:27:11,279 --> 00:27:13,120
i will also need marked for deletion

708
00:27:13,120 --> 00:27:14,960
property which will be initially set to

709
00:27:14,960 --> 00:27:16,640
false

710
00:27:16,640 --> 00:27:19,279
and if horizontal x coordinate of this

711
00:27:19,279 --> 00:27:21,279
projectile object is more than width of

712
00:27:21,279 --> 00:27:23,679
the game meaning it has moved across the

713
00:27:23,679 --> 00:27:26,960
game area this object can be deleted

714
00:27:26,960 --> 00:27:29,279
i will actually set it to 80 of the game

715
00:27:29,279 --> 00:27:31,279
area so projectiles will be coming from

716
00:27:31,279 --> 00:27:33,919
player here to somewhere around here

717
00:27:33,919 --> 00:27:35,679
because i don't want enemies to be hit

718
00:27:35,679 --> 00:27:37,760
and destroyed off screen let's say that

719
00:27:37,760 --> 00:27:40,400
the lasers have limited range so if

720
00:27:40,400 --> 00:27:42,799
horizontal coordinate of the projectile

721
00:27:42,799 --> 00:27:45,360
is more than 80 of width of the main

722
00:27:45,360 --> 00:27:47,440
game area said they're marked for

723
00:27:47,440 --> 00:27:50,400
deletion property from line 35 to true

724
00:27:50,400 --> 00:27:52,400
this will flag that projectile as ready

725
00:27:52,400 --> 00:27:54,640
to be deleted and removed from the game

726
00:27:54,640 --> 00:27:56,720
we will remove them in a moment before

727
00:27:56,720 --> 00:27:58,399
we do that we will also have a simple

728
00:27:58,399 --> 00:28:00,559
draw method that will take context as an

729
00:28:00,559 --> 00:28:02,559
argument and i call built in fill

730
00:28:02,559 --> 00:28:04,640
rectangle method that will represent the

731
00:28:04,640 --> 00:28:06,880
projectile i want to draw that rectangle

732
00:28:06,880 --> 00:28:09,440
at coordinates this dot x this dot y and

733
00:28:09,440 --> 00:28:11,520
i pass it this dot with this dot height

734
00:28:11,520 --> 00:28:14,799
from lines 32 and 33 we will use images

735
00:28:14,799 --> 00:28:16,559
and animations for everything soon but

736
00:28:16,559 --> 00:28:18,880
first let's set fill style to yellow and

737
00:28:18,880 --> 00:28:22,960
draw yellow rectangles for our lasers

738
00:28:24,799 --> 00:28:26,799
i will also have to define fill style

739
00:28:26,799 --> 00:28:28,640
here on the player a device that yellow

740
00:28:28,640 --> 00:28:30,960
color will apply on it as well

741
00:28:30,960 --> 00:28:35,279
i can set it to green or black like this

742
00:28:35,279 --> 00:28:37,440
so we have our projectile class ready

743
00:28:37,440 --> 00:28:39,919
how do we add them into our game

744
00:28:39,919 --> 00:28:41,679
one way to do it is by creating a

745
00:28:41,679 --> 00:28:44,080
special custom asset on player class

746
00:28:44,080 --> 00:28:46,000
player will have two different attack

747
00:28:46,000 --> 00:28:48,480
modes so i will call the basic one shoot

748
00:28:48,480 --> 00:28:50,720
top in this mode the lasers will be

749
00:28:50,720 --> 00:28:52,320
coming out from the mouth of our

750
00:28:52,320 --> 00:28:54,880
mechanical seahorse when shoot top

751
00:28:54,880 --> 00:28:57,120
method is triggered i take this dot

752
00:28:57,120 --> 00:28:58,880
projectiles array i will create in a

753
00:28:58,880 --> 00:29:01,120
minute and i will push new projectile

754
00:29:01,120 --> 00:29:03,440
inside using the class we just defined

755
00:29:03,440 --> 00:29:05,200
on line 27.

756
00:29:05,200 --> 00:29:07,360
i created this dot projectiles array on

757
00:29:07,360 --> 00:29:09,279
player class this will hold all

758
00:29:09,279 --> 00:29:12,240
currently active projectile objects up

759
00:29:12,240 --> 00:29:14,320
here i can see that class constructor

760
00:29:14,320 --> 00:29:17,200
expects game x and y as arguments so i

761
00:29:17,200 --> 00:29:20,640
pass it this.game from line 51 and the

762
00:29:20,640 --> 00:29:23,039
current player coordinates so this.x

763
00:29:23,039 --> 00:29:28,399
from 954 and dot y from line 55

764
00:29:28,399 --> 00:29:30,640
i want player to shoot when we press a

765
00:29:30,640 --> 00:29:33,039
key so i go up to input handler class

766
00:29:33,039 --> 00:29:35,279
and here i will make it very simple

767
00:29:35,279 --> 00:29:38,080
i go inside key down event and i say

768
00:29:38,080 --> 00:29:41,279
else if key is space bar so just space

769
00:29:41,279 --> 00:29:42,799
like this

770
00:29:42,799 --> 00:29:44,960
you can also use enter or any other key

771
00:29:44,960 --> 00:29:47,840
if you want when we press space bar use

772
00:29:47,840 --> 00:29:50,480
distort game reference from line 10 and

773
00:29:50,480 --> 00:29:53,360
navigate to its player property and from

774
00:29:53,360 --> 00:29:55,679
there call shoot top method we just

775
00:29:55,679 --> 00:29:56,960
defined

776
00:29:56,960 --> 00:29:58,960
since i'm holding all projectiles here

777
00:29:58,960 --> 00:30:01,440
on line 60 on player class i will handle

778
00:30:01,440 --> 00:30:04,720
projectiles here inside update method

779
00:30:04,720 --> 00:30:06,880
i take this dot projectiles array and

780
00:30:06,880 --> 00:30:08,880
for each element in that array i call

781
00:30:08,880 --> 00:30:13,279
update method we defined on line 39

782
00:30:16,320 --> 00:30:19,600
inside that method i have this check

783
00:30:19,600 --> 00:30:21,360
if the projectile moves across the

784
00:30:21,360 --> 00:30:23,279
screen we set its marked for deletion

785
00:30:23,279 --> 00:30:25,600
property to true i want to remove those

786
00:30:25,600 --> 00:30:27,760
elements from projectiles array i will

787
00:30:27,760 --> 00:30:29,919
do it using javascript filter method

788
00:30:29,919 --> 00:30:32,159
like this the filter method creates a

789
00:30:32,159 --> 00:30:34,399
new array with all elements that pass

790
00:30:34,399 --> 00:30:36,399
the test implemented by the provided

791
00:30:36,399 --> 00:30:38,720
function so here i'm taking projectiles

792
00:30:38,720 --> 00:30:42,080
array i call filter on it and the test

793
00:30:42,080 --> 00:30:43,840
is that i want all elements to have

794
00:30:43,840 --> 00:30:45,679
marked for deletion properties set to

795
00:30:45,679 --> 00:30:46,559
false

796
00:30:46,559 --> 00:30:49,760
so exclamation mark here

797
00:30:49,760 --> 00:30:51,679
this will filter out and remove all

798
00:30:51,679 --> 00:30:53,200
elements with marked for deletion

799
00:30:53,200 --> 00:30:55,679
properties set to true and since we just

800
00:30:55,679 --> 00:30:58,000
said that filter creates a new array we

801
00:30:58,000 --> 00:31:00,399
want to override the original array with

802
00:31:00,399 --> 00:31:03,440
the new one that was filtered here

803
00:31:03,440 --> 00:31:05,279
with this line of code in place every

804
00:31:05,279 --> 00:31:07,279
time we set marked for deletion property

805
00:31:07,279 --> 00:31:09,760
to true on any projectile object it will

806
00:31:09,760 --> 00:31:12,320
get removed from projectiles array i

807
00:31:12,320 --> 00:31:14,240
will check if it works by console log in

808
00:31:14,240 --> 00:31:16,480
this dot projectiles from inside shoot

809
00:31:16,480 --> 00:31:19,039
top method i will also call for each on

810
00:31:19,039 --> 00:31:21,360
all projectiles from inside draw method

811
00:31:21,360 --> 00:31:23,679
and i trigger draw method from line 43

812
00:31:23,679 --> 00:31:25,919
on each one i remember that i need to

813
00:31:25,919 --> 00:31:28,080
pass it context so i pass it along the

814
00:31:28,080 --> 00:31:31,039
value from here like this i save changes

815
00:31:31,039 --> 00:31:33,440
and run my code and i can see we have an

816
00:31:33,440 --> 00:31:35,440
error on line 45

817
00:31:35,440 --> 00:31:38,799
i go up to line 45 and i forgot to call

818
00:31:38,799 --> 00:31:40,720
fill rectangle from context so

819
00:31:40,720 --> 00:31:42,880
javascript doesn't know what to do with

820
00:31:42,880 --> 00:31:45,200
it i fix it like this

821
00:31:45,200 --> 00:31:47,279
now i click on canvas and i can move up

822
00:31:47,279 --> 00:31:49,440
and down using keyboard arrow keys and i

823
00:31:49,440 --> 00:31:52,080
can shoot using spacebar in browser

824
00:31:52,080 --> 00:31:53,760
console i can see that projectile

825
00:31:53,760 --> 00:31:55,679
objects are being correctly added and

826
00:31:55,679 --> 00:32:00,480
removed from projectiles array perfect

827
00:32:00,480 --> 00:32:02,399
let's remove these two console logs to

828
00:32:02,399 --> 00:32:05,120
clean up our code

829
00:32:05,120 --> 00:32:06,799
now the console is cleaner and it's

830
00:32:06,799 --> 00:32:09,039
easier to see how projectile array adds

831
00:32:09,039 --> 00:32:12,399
and removes objects nice

832
00:32:12,399 --> 00:32:14,559
right now we can shoot without limits i

833
00:32:14,559 --> 00:32:16,399
want the player to have limited ammo

834
00:32:16,399 --> 00:32:19,039
that slowly recharges over time it will

835
00:32:19,039 --> 00:32:21,120
also get completely refilled when we

836
00:32:21,120 --> 00:32:25,039
collect a special power up fish

837
00:32:25,039 --> 00:32:27,760
down here i say if this.game.amo which

838
00:32:27,760 --> 00:32:30,000
we will create in a minute

839
00:32:30,000 --> 00:32:32,320
is more than zero

840
00:32:32,320 --> 00:32:36,960
only then create new projectile object

841
00:32:38,720 --> 00:32:41,919
i go down here to line 104 and i create

842
00:32:41,919 --> 00:32:44,640
this new ammo property initially we will

843
00:32:44,640 --> 00:32:48,799
start with 20 ammo for example

844
00:32:50,399 --> 00:32:52,799
every time we create a new projectile we

845
00:32:52,799 --> 00:32:55,039
decrease that value by 1.

846
00:32:55,039 --> 00:32:57,360
now i can do it 20 times and then it

847
00:32:57,360 --> 00:32:59,919
stops even if i keep pressing spacebar

848
00:32:59,919 --> 00:33:02,960
we run out of ammo here on line 80 i can

849
00:33:02,960 --> 00:33:05,440
change which coordinates the projectiles

850
00:33:05,440 --> 00:33:07,679
start from in relation to the current

851
00:33:07,679 --> 00:33:09,360
player position

852
00:33:09,360 --> 00:33:10,960
we will match it even better when we

853
00:33:10,960 --> 00:33:12,960
apply player sprite sheet a bit later to

854
00:33:12,960 --> 00:33:15,120
make sure it comes out from the mouth of

855
00:33:15,120 --> 00:33:17,519
our steampunk seahorse we will get back

856
00:33:17,519 --> 00:33:19,840
to this i can offset it here or i can

857
00:33:19,840 --> 00:33:22,000
also do it inside projectile class

858
00:33:22,000 --> 00:33:23,450
itself

859
00:33:23,450 --> 00:33:29,279
[Music]

860
00:33:29,279 --> 00:33:31,200
when we use all 20 projectiles we

861
00:33:31,200 --> 00:33:33,600
completely run out of ammo i want it to

862
00:33:33,600 --> 00:33:36,159
slowly recharge over time to do that i

863
00:33:36,159 --> 00:33:38,480
want to run a periodic event in our code

864
00:33:38,480 --> 00:33:40,720
base and i want to be able to measure

865
00:33:40,720 --> 00:33:43,600
time in milliseconds and say for example

866
00:33:43,600 --> 00:33:46,559
every 500 milliseconds every half second

867
00:33:46,559 --> 00:33:49,039
automatically recharge one ammo to do

868
00:33:49,039 --> 00:33:50,799
that is easy if you know this technique

869
00:33:50,799 --> 00:33:53,360
with timestamps and delta time let me

870
00:33:53,360 --> 00:33:55,519
quickly explain how it works here on

871
00:33:55,519 --> 00:33:58,320
line 116 i create a variable i call for

872
00:33:58,320 --> 00:34:00,960
example last time its job will be to

873
00:34:00,960 --> 00:34:03,200
store a value of timestamp from the

874
00:34:03,200 --> 00:34:05,440
previous animation loop so that we can

875
00:34:05,440 --> 00:34:06,880
compare it against the value of

876
00:34:06,880 --> 00:34:09,359
timestamp from this animation loop

877
00:34:09,359 --> 00:34:11,359
this difference will give us delta time

878
00:34:11,359 --> 00:34:13,200
the difference in milliseconds between

879
00:34:13,200 --> 00:34:15,280
the timestamp from this loop and the

880
00:34:15,280 --> 00:34:17,760
timestamp from the previous loop like

881
00:34:17,760 --> 00:34:18,720
this

882
00:34:18,720 --> 00:34:20,320
where does this timestamp value come

883
00:34:20,320 --> 00:34:22,800
from request animationframe method has a

884
00:34:22,800 --> 00:34:25,119
special feature it automatically passes

885
00:34:25,119 --> 00:34:27,440
a timestamp as an argument to the

886
00:34:27,440 --> 00:34:30,240
function it calls in our case animate i

887
00:34:30,240 --> 00:34:31,839
can use it simply by giving it a

888
00:34:31,839 --> 00:34:33,919
variable name here you can call it

889
00:34:33,919 --> 00:34:35,599
whatever you want as long as you keep

890
00:34:35,599 --> 00:34:37,760
referring to that value using the same

891
00:34:37,760 --> 00:34:40,480
variable name i will call it timestamp

892
00:34:40,480 --> 00:34:42,720
spelled like this and i will use it to

893
00:34:42,720 --> 00:34:46,320
calculate delta time here on line 119

894
00:34:46,320 --> 00:34:48,480
after we used last time to calculate

895
00:34:48,480 --> 00:34:50,879
delta time for this animation loop we

896
00:34:50,879 --> 00:34:53,679
reassign last time to the timestamp from

897
00:34:53,679 --> 00:34:55,599
the current loop so that it can be used

898
00:34:55,599 --> 00:34:58,480
to calculate delta time in the next loop

899
00:34:58,480 --> 00:35:00,480
so request animation frame auto

900
00:35:00,480 --> 00:35:02,480
generates a timestamp value

901
00:35:02,480 --> 00:35:04,720
which is a number in milliseconds since

902
00:35:04,720 --> 00:35:07,280
this loop started we access it here in

903
00:35:07,280 --> 00:35:09,760
animate assign it a variable name for

904
00:35:09,760 --> 00:35:12,400
example timestamp like this we calculate

905
00:35:12,400 --> 00:35:14,000
the delta time which is the difference

906
00:35:14,000 --> 00:35:16,160
in milliseconds between the timestamp

907
00:35:16,160 --> 00:35:18,240
from this animation loop and the

908
00:35:18,240 --> 00:35:20,160
timestamp from the previous animation

909
00:35:20,160 --> 00:35:22,800
loop and then we set last time to

910
00:35:22,800 --> 00:35:25,040
timestamp from this loop so that it can

911
00:35:25,040 --> 00:35:27,280
be used to calculate delta time in the

912
00:35:27,280 --> 00:35:29,359
next loop don't worry if this is a bit

913
00:35:29,359 --> 00:35:31,359
complicated to understand at first it's

914
00:35:31,359 --> 00:35:32,880
a very common technique and it will

915
00:35:32,880 --> 00:35:34,720
become more intuitive as you use it in

916
00:35:34,720 --> 00:35:37,680
multiple projects

917
00:35:38,720 --> 00:35:40,640
i can control delta time to check if

918
00:35:40,640 --> 00:35:42,880
it's working my delta time is around

919
00:35:42,880 --> 00:35:46,079
16.6 milliseconds thousand milliseconds

920
00:35:46,079 --> 00:35:49,599
one second divided by 16.6 is around 60

921
00:35:49,599 --> 00:35:51,839
so i can see that my game is animating

922
00:35:51,839 --> 00:35:54,400
at 60 frames per second let me know if

923
00:35:54,400 --> 00:35:56,560
you get the same value or something else

924
00:35:56,560 --> 00:35:58,720
if you had an old computer delta time

925
00:35:58,720 --> 00:36:00,400
value might be higher because it takes

926
00:36:00,400 --> 00:36:02,079
your computer more milliseconds to

927
00:36:02,079 --> 00:36:04,320
render animation frame if you have high

928
00:36:04,320 --> 00:36:06,880
refresh gaming screen delta time value

929
00:36:06,880 --> 00:36:08,880
could be lower for you i wonder if we

930
00:36:08,880 --> 00:36:11,040
have any coders here who use that type

931
00:36:11,040 --> 00:36:13,040
of screen remember to remove your

932
00:36:13,040 --> 00:36:14,720
console locks when you don't need them

933
00:36:14,720 --> 00:36:16,800
especially this one that runs 60 times

934
00:36:16,800 --> 00:36:18,320
per second it could affect the

935
00:36:18,320 --> 00:36:20,079
performance of our game if i just leave

936
00:36:20,079 --> 00:36:23,280
it here so we calculated delta time we

937
00:36:23,280 --> 00:36:25,119
know how many milliseconds it takes for

938
00:36:25,119 --> 00:36:28,000
a computer to render one animation frame

939
00:36:28,000 --> 00:36:30,640
to run one animation loop i will pass it

940
00:36:30,640 --> 00:36:32,720
to update method here and we can use

941
00:36:32,720 --> 00:36:34,960
that value to run periodic events in our

942
00:36:34,960 --> 00:36:37,200
game or to measure game time the

943
00:36:37,200 --> 00:36:38,800
advantage of this technique is that it

944
00:36:38,800 --> 00:36:40,640
doesn't matter if you have strong super

945
00:36:40,640 --> 00:36:43,440
computer or a very old slow one delta

946
00:36:43,440 --> 00:36:45,200
time measures actual milliseconds in

947
00:36:45,200 --> 00:36:47,280
real time so periodic events will happen

948
00:36:47,280 --> 00:36:49,119
roughly at the same time on slow and

949
00:36:49,119 --> 00:36:51,119
fast machines regardless of their

950
00:36:51,119 --> 00:36:54,240
ability to animate our game slow or fast

951
00:36:54,240 --> 00:36:56,320
to trigger periodic events in our game i

952
00:36:56,320 --> 00:36:58,880
need two helper variables one will be

953
00:36:58,880 --> 00:37:01,040
timer that will go between zero and some

954
00:37:01,040 --> 00:37:03,280
kind of predefined limit each time it

955
00:37:03,280 --> 00:37:05,040
reaches that limit it will trigger some

956
00:37:05,040 --> 00:37:07,200
kind of event and it will reset back to

957
00:37:07,200 --> 00:37:11,119
0 to count again for the next loop

958
00:37:11,280 --> 00:37:13,040
the second helper variable will be that

959
00:37:13,040 --> 00:37:15,280
limit that interval value that timer

960
00:37:15,280 --> 00:37:17,440
needs to reach so i want to replenish

961
00:37:17,440 --> 00:37:19,760
some ammo every half second 500

962
00:37:19,760 --> 00:37:22,160
milliseconds i will also introduce some

963
00:37:22,160 --> 00:37:23,760
hard limit i want the ammo to

964
00:37:23,760 --> 00:37:26,480
automatically replenish only up to this

965
00:37:26,480 --> 00:37:29,040
value not endlessly so starting ammo

966
00:37:29,040 --> 00:37:31,920
will be 20 maximum ammo will be 50 for

967
00:37:31,920 --> 00:37:33,200
example

968
00:37:33,200 --> 00:37:35,040
inside update method on game class i

969
00:37:35,040 --> 00:37:37,440
will use ammo timer and ammo interval

970
00:37:37,440 --> 00:37:39,760
helper variables and also delta time to

971
00:37:39,760 --> 00:37:41,440
trigger this periodic event that

972
00:37:41,440 --> 00:37:44,400
replenishes ammo every 500 milliseconds

973
00:37:44,400 --> 00:37:47,680
i say if ammo timer from line 107 is

974
00:37:47,680 --> 00:37:49,920
more than ammo interval so 500

975
00:37:49,920 --> 00:37:51,119
milliseconds

976
00:37:51,119 --> 00:37:53,440
inside i will also check if ammo is less

977
00:37:53,440 --> 00:37:57,040
than max ammo like this

978
00:37:59,760 --> 00:38:02,480
only then i will increase ammo by 1.

979
00:38:02,480 --> 00:38:05,040
then i reset ammo timer back to 0 so

980
00:38:05,040 --> 00:38:08,079
that it can count again

981
00:38:08,079 --> 00:38:10,640
else keep increasing ammo timer by delta

982
00:38:10,640 --> 00:38:12,880
time

983
00:38:13,920 --> 00:38:16,880
i am calculating delta time on line 128

984
00:38:16,880 --> 00:38:19,119
and i'm passing it to update method on

985
00:38:19,119 --> 00:38:22,560
game class online 131 i make sure update

986
00:38:22,560 --> 00:38:24,640
method expects that value here on line

987
00:38:24,640 --> 00:38:27,680
110 and that delta time value will get

988
00:38:27,680 --> 00:38:31,400
passed along here

989
00:38:35,359 --> 00:38:37,359
our ammo is already recharging but it's

990
00:38:37,359 --> 00:38:39,760
not easy to check and see i can console

991
00:38:39,760 --> 00:38:41,680
these values but it would be nice to

992
00:38:41,680 --> 00:38:43,680
have some visual representation of our

993
00:38:43,680 --> 00:38:45,920
available projectiles as part of our

994
00:38:45,920 --> 00:38:47,280
game screen

995
00:38:47,280 --> 00:38:49,359
i have user interface class here online

996
00:38:49,359 --> 00:38:52,000
95. i will use it to draw messages and

997
00:38:52,000 --> 00:38:53,839
game statuses that player needs to be

998
00:38:53,839 --> 00:38:55,760
aware of

999
00:38:55,760 --> 00:38:57,440
this class will be very simple a

1000
00:38:57,440 --> 00:38:59,040
constructor will take a game as an

1001
00:38:59,040 --> 00:39:00,960
argument so we convert it to a class

1002
00:39:00,960 --> 00:39:03,599
property as usual we will define font

1003
00:39:03,599 --> 00:39:05,599
size

1004
00:39:05,599 --> 00:39:07,920
and font family we will need it later to

1005
00:39:07,920 --> 00:39:11,680
draw some score and game timers

1006
00:39:12,400 --> 00:39:14,800
i will also define color and i set it to

1007
00:39:14,800 --> 00:39:16,480
white for example

1008
00:39:16,480 --> 00:39:18,560
it doesn't need update method it just

1009
00:39:18,560 --> 00:39:20,720
needs a draw method

1010
00:39:20,720 --> 00:39:22,800
it will expect context as an argument

1011
00:39:22,800 --> 00:39:24,720
and here i will draw a small bar for

1012
00:39:24,720 --> 00:39:27,200
each available projectile i create for

1013
00:39:27,200 --> 00:39:29,680
loop it will run as many times depending

1014
00:39:29,680 --> 00:39:33,680
on the amount of ammo we currently have

1015
00:39:35,520 --> 00:39:39,680
i will set fill style to this.color

1016
00:39:40,960 --> 00:39:42,880
this should actually be outside the for

1017
00:39:42,880 --> 00:39:44,240
loop like this

1018
00:39:44,240 --> 00:39:46,000
for each available projectile i will

1019
00:39:46,000 --> 00:39:48,000
draw a small rectangle

1020
00:39:48,000 --> 00:39:49,839
so fill a rectangle method add

1021
00:39:49,839 --> 00:39:53,200
coordinates 2050 width 3 pixels and

1022
00:39:53,200 --> 00:39:55,280
height 20 pixels

1023
00:39:55,280 --> 00:39:56,960
let's draw what we have so far and then

1024
00:39:56,960 --> 00:39:58,800
we can finish it once we can see what we

1025
00:39:58,800 --> 00:39:59,839
are doing

1026
00:39:59,839 --> 00:40:01,680
same as we did with player and input

1027
00:40:01,680 --> 00:40:03,920
handler classes i create an instance of

1028
00:40:03,920 --> 00:40:07,040
user interface class here on line 116

1029
00:40:07,040 --> 00:40:09,599
inside game class constructor

1030
00:40:09,599 --> 00:40:12,160
it expects game as an argument so i pass

1031
00:40:12,160 --> 00:40:14,079
it this keyword

1032
00:40:14,079 --> 00:40:16,560
now i use this dot ui property and i

1033
00:40:16,560 --> 00:40:18,400
call its associated draw method we

1034
00:40:18,400 --> 00:40:21,280
defined on line 102 and i pass it

1035
00:40:21,280 --> 00:40:24,000
context

1036
00:40:24,000 --> 00:40:26,480
nice right now we are drawing all 20

1037
00:40:26,480 --> 00:40:28,400
available projectiles on top of each

1038
00:40:28,400 --> 00:40:30,720
other here to make them align next to

1039
00:40:30,720 --> 00:40:32,640
each other i just multiply them by the

1040
00:40:32,640 --> 00:40:35,440
index from the for loop like this

1041
00:40:35,440 --> 00:40:37,920
20 pixels spacing is too much how about

1042
00:40:37,920 --> 00:40:41,440
a spacing of 5 pixels

1043
00:40:43,280 --> 00:40:47,440
plus 20 pixels left margin like this

1044
00:40:47,440 --> 00:40:49,520
that's better now we can see how our

1045
00:40:49,520 --> 00:40:53,400
ammo is slowly recharging

1046
00:40:53,520 --> 00:40:57,680
i can change the color here on line 100

1047
00:40:58,079 --> 00:41:00,400
i can test it and it's working really

1048
00:41:00,400 --> 00:41:02,640
well

1049
00:41:04,480 --> 00:41:06,720
it will keep recharging until it reaches

1050
00:41:06,720 --> 00:41:09,440
max ammo value of 50 and then it should

1051
00:41:09,440 --> 00:41:11,839
stop

1052
00:41:12,720 --> 00:41:14,000
yes

1053
00:41:14,000 --> 00:41:15,920
we will apply better visuals to our game

1054
00:41:15,920 --> 00:41:17,359
in a moment i just want to have a

1055
00:41:17,359 --> 00:41:21,210
complete functional game skeleton first

1056
00:41:21,210 --> 00:41:25,680
[Music]

1057
00:41:25,680 --> 00:41:27,200
we are missing one last important

1058
00:41:27,200 --> 00:41:29,760
element in our main game loop enemies

1059
00:41:29,760 --> 00:41:31,920
and some enemies will also work as power

1060
00:41:31,920 --> 00:41:34,319
ups in this game we will have multiple

1061
00:41:34,319 --> 00:41:36,000
enemy types in our game with different

1062
00:41:36,000 --> 00:41:38,319
visuals and behaviors let's take it step

1063
00:41:38,319 --> 00:41:40,160
by step to make sure we understand how

1064
00:41:40,160 --> 00:41:42,000
everything works and how the player

1065
00:41:42,000 --> 00:41:44,160
projectiles enemies and power-ups

1066
00:41:44,160 --> 00:41:46,480
interact with each other enemy class

1067
00:41:46,480 --> 00:41:48,640
will just contain the main blueprint the

1068
00:41:48,640 --> 00:41:50,640
properties and methods shared between

1069
00:41:50,640 --> 00:41:53,280
all enemy types we will then extend this

1070
00:41:53,280 --> 00:41:55,839
class into multiple small subclasses

1071
00:41:55,839 --> 00:41:57,599
each enemy type will have a separate

1072
00:41:57,599 --> 00:42:00,000
child class that inherits from this main

1073
00:42:00,000 --> 00:42:02,480
enemy parent class all enemies will need

1074
00:42:02,480 --> 00:42:04,720
access to the main game object so i do

1075
00:42:04,720 --> 00:42:07,440
this as usual all enemies will also have

1076
00:42:07,440 --> 00:42:08,960
the same starting horizontal

1077
00:42:08,960 --> 00:42:10,319
x-coordinate

1078
00:42:10,319 --> 00:42:12,640
they will go from right to left starting

1079
00:42:12,640 --> 00:42:14,800
just behind the right edge of game area

1080
00:42:14,800 --> 00:42:17,520
so this.game.width horizontal speed of

1081
00:42:17,520 --> 00:42:19,040
each enemy will be a random number

1082
00:42:19,040 --> 00:42:21,040
between -0.5

1083
00:42:21,040 --> 00:42:23,359
and -2 pixels because i want them to

1084
00:42:23,359 --> 00:42:25,440
move in minus direction to the left on

1085
00:42:25,440 --> 00:42:27,599
horizontal x-axis

1086
00:42:27,599 --> 00:42:29,920
marked for deletion will be set to false

1087
00:42:29,920 --> 00:42:32,480
initially

1088
00:42:34,079 --> 00:42:36,079
update method will adjust horizontal x

1089
00:42:36,079 --> 00:42:37,920
coordinate by the amount of speed x

1090
00:42:37,920 --> 00:42:40,480
value for each animation frame moving

1091
00:42:40,480 --> 00:42:42,720
enemies from right to left

1092
00:42:42,720 --> 00:42:44,640
i check if enemy moved completely off

1093
00:42:44,640 --> 00:42:46,800
screen all the way behind the left edge

1094
00:42:46,800 --> 00:42:49,520
of game area so if x coordinate of the

1095
00:42:49,520 --> 00:42:52,640
enemy plus its width is less than 0 we

1096
00:42:52,640 --> 00:42:54,319
will set its marked for deletion

1097
00:42:54,319 --> 00:42:56,880
property to true

1098
00:42:56,880 --> 00:42:58,720
draw method will take context as an

1099
00:42:58,720 --> 00:43:01,119
argument at first i will just draw red

1100
00:43:01,119 --> 00:43:03,280
rectangles representing enemies so fill

1101
00:43:03,280 --> 00:43:05,119
style right

1102
00:43:05,119 --> 00:43:07,599
and fill rectangle at enemies x and y

1103
00:43:07,599 --> 00:43:09,599
coordinates

1104
00:43:09,599 --> 00:43:13,680
and its width and height like this

1105
00:43:13,680 --> 00:43:15,680
we will have multiple enemy types let's

1106
00:43:15,680 --> 00:43:17,280
start with the basic simple anime

1107
00:43:17,280 --> 00:43:19,520
angular fish i call that class for

1108
00:43:19,520 --> 00:43:22,480
example angular 1 and it extends enemy

1109
00:43:22,480 --> 00:43:25,599
class from line 86 in this scenario we

1110
00:43:25,599 --> 00:43:27,760
have a parent anime class also called a

1111
00:43:27,760 --> 00:43:30,079
super class and we have child angular

1112
00:43:30,079 --> 00:43:32,960
class also called a sub class

1113
00:43:32,960 --> 00:43:34,560
this is a good example of the second

1114
00:43:34,560 --> 00:43:36,720
principle of object oriented programming

1115
00:43:36,720 --> 00:43:39,599
called inheritance angler is a child of

1116
00:43:39,599 --> 00:43:42,160
parent enemy class and it has access to

1117
00:43:42,160 --> 00:43:44,480
its methods such as this update and draw

1118
00:43:44,480 --> 00:43:46,400
as well as these properties

1119
00:43:46,400 --> 00:43:48,480
if i call a property or a method on

1120
00:43:48,480 --> 00:43:50,720
angle class and javascript can't find it

1121
00:43:50,720 --> 00:43:52,880
on angular it will automatically travel

1122
00:43:52,880 --> 00:43:54,640
to the parent enemy class and it will

1123
00:43:54,640 --> 00:43:57,280
look for it there inheritance is used to

1124
00:43:57,280 --> 00:43:59,200
reduce code repetition instead of

1125
00:43:59,200 --> 00:44:00,960
re-declaring the same methods and

1126
00:44:00,960 --> 00:44:02,880
properties on each class i can just

1127
00:44:02,880 --> 00:44:05,440
declare them once on parent class and

1128
00:44:05,440 --> 00:44:07,440
all child classes will inherit them

1129
00:44:07,440 --> 00:44:08,800
automatically

1130
00:44:08,800 --> 00:44:10,720
we can also do other things here using a

1131
00:44:10,720 --> 00:44:12,880
special super keyword i will show you as

1132
00:44:12,880 --> 00:44:15,040
we write the code angle class will have

1133
00:44:15,040 --> 00:44:16,800
its own constructor because some

1134
00:44:16,800 --> 00:44:18,800
properties will be specific only to

1135
00:44:18,800 --> 00:44:21,200
angular fish enemies in our game if i

1136
00:44:21,200 --> 00:44:22,960
don't declare constructor on angular

1137
00:44:22,960 --> 00:44:24,960
class at all it will automatically use

1138
00:44:24,960 --> 00:44:26,880
constructor from anime class from line

1139
00:44:26,880 --> 00:44:28,400
87.

1140
00:44:28,400 --> 00:44:30,480
in this case i want the code from parent

1141
00:44:30,480 --> 00:44:33,359
class constructor online 87 to run and i

1142
00:44:33,359 --> 00:44:35,280
want to add some additional properties

1143
00:44:35,280 --> 00:44:37,920
here if i just declare constructor on

1144
00:44:37,920 --> 00:44:40,000
angular it will completely override

1145
00:44:40,000 --> 00:44:41,839
parent class constructor and this code

1146
00:44:41,839 --> 00:44:43,520
would be ignored

1147
00:44:43,520 --> 00:44:45,520
so i have to use a special syntax to

1148
00:44:45,520 --> 00:44:48,240
kind of merge them i want first this

1149
00:44:48,240 --> 00:44:50,960
code to run and i want to add a little

1150
00:44:50,960 --> 00:44:52,640
bit of it here

1151
00:44:52,640 --> 00:44:55,359
i do it by calling super which refers to

1152
00:44:55,359 --> 00:44:58,240
super class parent class constructor

1153
00:44:58,240 --> 00:45:00,000
this line of code will make sure that

1154
00:45:00,000 --> 00:45:01,760
the constructor on the parent gets

1155
00:45:01,760 --> 00:45:04,000
executed now i can add some more

1156
00:45:04,000 --> 00:45:05,920
properties that will be specific only

1157
00:45:05,920 --> 00:45:08,160
for angular remember that if you want to

1158
00:45:08,160 --> 00:45:10,000
combine constructors like this you have

1159
00:45:10,000 --> 00:45:12,319
to call super first before you use this

1160
00:45:12,319 --> 00:45:14,400
keyword doing it the other way around

1161
00:45:14,400 --> 00:45:16,640
will give you an error

1162
00:45:16,640 --> 00:45:18,560
i have specific sprite sheets ready for

1163
00:45:18,560 --> 00:45:20,640
our project so i know that width of a

1164
00:45:20,640 --> 00:45:22,720
single frame in our angular sprite sheet

1165
00:45:22,720 --> 00:45:27,760
is 228 pixels and height is 169 pixels i

1166
00:45:27,760 --> 00:45:29,680
want vertical y position to start from

1167
00:45:29,680 --> 00:45:32,400
here and go 90 from the top because we

1168
00:45:32,400 --> 00:45:34,000
will have some ground graphics in our

1169
00:45:34,000 --> 00:45:36,400
game environment layer these are flying

1170
00:45:36,400 --> 00:45:38,240
fish machines they need to be above

1171
00:45:38,240 --> 00:45:41,040
ground rectangles and images on canvas

1172
00:45:41,040 --> 00:45:43,119
are drawn from the top left corner so i

1173
00:45:43,119 --> 00:45:45,440
want the starting vertical position on

1174
00:45:45,440 --> 00:45:49,359
each enemy to be between 0 here and 90

1175
00:45:49,359 --> 00:45:51,599
of game height here but i need to offset

1176
00:45:51,599 --> 00:45:53,680
it by the actual height of the enemy

1177
00:45:53,680 --> 00:45:55,520
otherwise they will be drawn too low

1178
00:45:55,520 --> 00:45:56,800
down here

1179
00:45:56,800 --> 00:45:58,880
that's why i define x coordinate on the

1180
00:45:58,880 --> 00:46:01,440
parent enemy class on line 89 but i had

1181
00:46:01,440 --> 00:46:03,680
to wait declaring vertical y coordinate

1182
00:46:03,680 --> 00:46:05,440
until i had height of that specific

1183
00:46:05,440 --> 00:46:07,440
enemy type it will all work together

1184
00:46:07,440 --> 00:46:09,040
well now you'll see

1185
00:46:09,040 --> 00:46:11,040
inside update method on the main game

1186
00:46:11,040 --> 00:46:13,200
class i will cycle through all enemies

1187
00:46:13,200 --> 00:46:15,599
and for each enemy object inside enemies

1188
00:46:15,599 --> 00:46:19,520
array i will call their update method

1189
00:46:19,520 --> 00:46:22,160
i also need to define this.enemies array

1190
00:46:22,160 --> 00:46:24,800
here it will hold all currently active

1191
00:46:24,800 --> 00:46:27,520
anime objects

1192
00:46:27,520 --> 00:46:29,920
i will again use filter method to filter

1193
00:46:29,920 --> 00:46:32,240
out all anime objects that have marked

1194
00:46:32,240 --> 00:46:34,560
for deletion properties set to true the

1195
00:46:34,560 --> 00:46:38,400
same thing we did with projectiles

1196
00:46:39,040 --> 00:46:40,960
and i will cycle through all enemy

1197
00:46:40,960 --> 00:46:43,920
objects here call their draw method and

1198
00:46:43,920 --> 00:46:45,599
pass it context

1199
00:46:45,599 --> 00:46:48,400
so we have anime class we are updating

1200
00:46:48,400 --> 00:46:51,200
drawing and removing old ones we need to

1201
00:46:51,200 --> 00:46:53,119
figure out how to add new enemies into

1202
00:46:53,119 --> 00:46:54,720
our game

1203
00:46:54,720 --> 00:46:56,480
i will have a special method on the game

1204
00:46:56,480 --> 00:46:59,119
class called add anime every time this

1205
00:46:59,119 --> 00:47:01,520
method is called it will push one new

1206
00:47:01,520 --> 00:47:03,839
anime object inside this dot enemies

1207
00:47:03,839 --> 00:47:05,920
array notice that i'm not calling the

1208
00:47:05,920 --> 00:47:08,240
parent anime class i'm calling the child

1209
00:47:08,240 --> 00:47:11,359
angular 1 class here

1210
00:47:11,359 --> 00:47:14,079
on line 103 i can see it expects game as

1211
00:47:14,079 --> 00:47:16,160
an argument so

1212
00:47:16,160 --> 00:47:18,319
i pass it this keyword because we are

1213
00:47:18,319 --> 00:47:21,760
inside that game class

1214
00:47:23,280 --> 00:47:25,520
now i want to call add enemy in a

1215
00:47:25,520 --> 00:47:27,599
specific interval we will use the same

1216
00:47:27,599 --> 00:47:29,280
technique we used to periodically

1217
00:47:29,280 --> 00:47:31,520
recharge ammo and it will be much easier

1218
00:47:31,520 --> 00:47:33,440
because we are already calculating delta

1219
00:47:33,440 --> 00:47:34,400
time

1220
00:47:34,400 --> 00:47:36,720
i will need two helper variables enemy

1221
00:47:36,720 --> 00:47:38,960
timer that will count between zero and

1222
00:47:38,960 --> 00:47:41,359
enemy interval i want to add new enemy

1223
00:47:41,359 --> 00:47:43,599
into our game every one second every

1224
00:47:43,599 --> 00:47:46,800
thousand milliseconds

1225
00:47:47,359 --> 00:47:48,880
same as we did with recharging

1226
00:47:48,880 --> 00:47:51,520
projectiles i say if this.enemy timer

1227
00:47:51,520 --> 00:47:53,920
which starts from 0 is more than anime

1228
00:47:53,920 --> 00:47:56,240
interval

1229
00:47:56,240 --> 00:47:57,920
let's go up here and also declare

1230
00:47:57,920 --> 00:48:00,079
gameover property and initially set it

1231
00:48:00,079 --> 00:48:02,640
to false

1232
00:48:03,760 --> 00:48:06,560
back here on 962 i say

1233
00:48:06,560 --> 00:48:09,040
and at the same time this dot game over

1234
00:48:09,040 --> 00:48:10,880
is false because i don't want to be

1235
00:48:10,880 --> 00:48:13,280
adding new enemies when the game ended

1236
00:48:13,280 --> 00:48:16,079
and we call at enemy method from here we

1237
00:48:16,079 --> 00:48:18,160
will also reset enemy timer back to zero

1238
00:48:18,160 --> 00:48:20,960
so that it can count again else meaning

1239
00:48:20,960 --> 00:48:23,040
enemy timer is less than enemy interval

1240
00:48:23,040 --> 00:48:24,960
we will keep increasing enemy timer by

1241
00:48:24,960 --> 00:48:27,359
delta time which is already being passed

1242
00:48:27,359 --> 00:48:30,559
to update method here

1243
00:48:31,040 --> 00:48:33,599
nice we are adding big red enemies to

1244
00:48:33,599 --> 00:48:37,119
our game i go up to 105 and i make the

1245
00:48:37,119 --> 00:48:39,839
width and also height smaller just for

1246
00:48:39,839 --> 00:48:42,720
now before we start animating sprites i

1247
00:48:42,720 --> 00:48:44,559
will make the entire game wider when we

1248
00:48:44,559 --> 00:48:46,960
get to later stages for now we are just

1249
00:48:46,960 --> 00:48:49,200
building the main logic loop we have

1250
00:48:49,200 --> 00:48:50,720
player that can move and shoot

1251
00:48:50,720 --> 00:48:53,359
projectiles we have recharging ammo and

1252
00:48:53,359 --> 00:48:55,680
there are swarms of enemies coming at us

1253
00:48:55,680 --> 00:48:58,319
nice work if you are following along

1254
00:48:58,319 --> 00:49:00,559
as usual i want to check if enemies are

1255
00:49:00,559 --> 00:49:02,640
being correctly added and removed from

1256
00:49:02,640 --> 00:49:05,359
the array so i consoled this.enemies

1257
00:49:05,359 --> 00:49:07,520
array here i want to make sure that

1258
00:49:07,520 --> 00:49:10,800
filter method on line 161 does its job

1259
00:49:10,800 --> 00:49:12,480
and we don't have endlessly growing

1260
00:49:12,480 --> 00:49:13,359
array

1261
00:49:13,359 --> 00:49:15,520
it works well enemies that moved off

1262
00:49:15,520 --> 00:49:17,440
screen to the left are being removed

1263
00:49:17,440 --> 00:49:20,000
perfect

1264
00:49:24,880 --> 00:49:27,280
it's time to add some interactions i

1265
00:49:27,280 --> 00:49:29,200
need to check if enemies collide with

1266
00:49:29,200 --> 00:49:31,359
player and also if projectiles collide

1267
00:49:31,359 --> 00:49:33,440
with enemies to save ourselves code

1268
00:49:33,440 --> 00:49:35,200
repetition i will create a reusable

1269
00:49:35,200 --> 00:49:37,520
collision detection method on the main

1270
00:49:37,520 --> 00:49:39,920
game object i call for example check

1271
00:49:39,920 --> 00:49:42,160
collisions this method will take two

1272
00:49:42,160 --> 00:49:45,040
arguments two objects i will call them

1273
00:49:45,040 --> 00:49:47,920
rectangle one and rectangle two and it

1274
00:49:47,920 --> 00:49:50,480
will return true if they collide and

1275
00:49:50,480 --> 00:49:52,480
false if they don't

1276
00:49:52,480 --> 00:49:54,480
it will be a reusable function so we can

1277
00:49:54,480 --> 00:49:56,559
use it later and pass it player and

1278
00:49:56,559 --> 00:49:59,200
enemy as rectangle 1 and 2 and we can

1279
00:49:59,200 --> 00:50:01,680
also pass it anime and projectile to

1280
00:50:01,680 --> 00:50:03,599
check if they collide let me show you

1281
00:50:03,599 --> 00:50:06,000
exactly how to do that right now when

1282
00:50:06,000 --> 00:50:08,000
checking if two rectangles collide we

1283
00:50:08,000 --> 00:50:10,640
compare their x y width and height in a

1284
00:50:10,640 --> 00:50:13,040
specific way so all objects we are

1285
00:50:13,040 --> 00:50:15,280
comparing need to have x y width and

1286
00:50:15,280 --> 00:50:17,760
height properties for this to work

1287
00:50:17,760 --> 00:50:20,000
i will return a statement in brackets

1288
00:50:20,000 --> 00:50:21,839
like this so if the code in brackets

1289
00:50:21,839 --> 00:50:23,680
evaluates true or false it will

1290
00:50:23,680 --> 00:50:25,920
immediately be returned by this function

1291
00:50:25,920 --> 00:50:28,079
quick and easy to check if two

1292
00:50:28,079 --> 00:50:30,559
rectangles collide we need to run four

1293
00:50:30,559 --> 00:50:31,520
checks

1294
00:50:31,520 --> 00:50:33,359
we need to check if a horizontal x

1295
00:50:33,359 --> 00:50:35,599
position of rectangle one is less than

1296
00:50:35,599 --> 00:50:37,760
horizontal position of rectangle two

1297
00:50:37,760 --> 00:50:41,839
plus its width if this side is to the

1298
00:50:41,839 --> 00:50:43,520
left of this side

1299
00:50:43,520 --> 00:50:46,240
i will comment out line 196 just for a

1300
00:50:46,240 --> 00:50:48,400
moment so the movement doesn't distract

1301
00:50:48,400 --> 00:50:50,400
us

1302
00:50:50,400 --> 00:50:52,160
at the same time we need to check if

1303
00:50:52,160 --> 00:50:54,480
horizontal position of rectangle 1 plus

1304
00:50:54,480 --> 00:50:56,720
the width of rectangle 1 is more than

1305
00:50:56,720 --> 00:50:59,200
horizontal position of rectangle 2 if

1306
00:50:59,200 --> 00:51:02,079
this side is to the right of this side

1307
00:51:02,079 --> 00:51:04,160
if both of these statements are true we

1308
00:51:04,160 --> 00:51:05,839
know they're in the same space on

1309
00:51:05,839 --> 00:51:08,079
horizontal x-axis but it still doesn't

1310
00:51:08,079 --> 00:51:10,240
mean they collide they can be far away

1311
00:51:10,240 --> 00:51:12,559
vertically because of that we need two

1312
00:51:12,559 --> 00:51:14,800
more checks we need to check if vertical

1313
00:51:14,800 --> 00:51:16,960
position of rectangle one is less than

1314
00:51:16,960 --> 00:51:19,359
vertical position of rectangle two plus

1315
00:51:19,359 --> 00:51:22,079
the height of rectangle two if this side

1316
00:51:22,079 --> 00:51:24,960
is above this side and finally we check

1317
00:51:24,960 --> 00:51:27,440
if the height of rectangle 1 plus its y

1318
00:51:27,440 --> 00:51:29,599
position is more than vertical y

1319
00:51:29,599 --> 00:51:32,559
position of rectangle 2 if this side is

1320
00:51:32,559 --> 00:51:34,160
below this side

1321
00:51:34,160 --> 00:51:36,640
if all 4 of these checks are true this

1322
00:51:36,640 --> 00:51:39,200
entire statement will evaluate to true

1323
00:51:39,200 --> 00:51:41,440
and check collision function will return

1324
00:51:41,440 --> 00:51:44,240
true if at least one of these is false

1325
00:51:44,240 --> 00:51:46,480
the entire statement will be false and

1326
00:51:46,480 --> 00:51:48,640
we know these two rectangles don't

1327
00:51:48,640 --> 00:51:50,720
collide

1328
00:51:50,720 --> 00:51:52,960
we stay inside the main game class and

1329
00:51:52,960 --> 00:51:55,760
go to its update method in this for each

1330
00:51:55,760 --> 00:51:57,839
call we cycle through every object

1331
00:51:57,839 --> 00:52:00,800
inside enemiesarray from 941

1332
00:52:00,800 --> 00:52:02,960
and we call their update method

1333
00:52:02,960 --> 00:52:05,119
as we go through that array one enemy

1334
00:52:05,119 --> 00:52:06,800
object at the time we will check

1335
00:52:06,800 --> 00:52:11,720
collision between player object from 937

1336
00:52:13,280 --> 00:52:16,960
and that particular enemy rectangle

1337
00:52:16,960 --> 00:52:18,960
i do this by calling our custom check

1338
00:52:18,960 --> 00:52:21,280
collision method we just wrote and i

1339
00:52:21,280 --> 00:52:23,599
pass it player as rectangle one and

1340
00:52:23,599 --> 00:52:26,480
enemy as rectangle two if this message

1341
00:52:26,480 --> 00:52:28,880
returns true we know we are colliding

1342
00:52:28,880 --> 00:52:31,040
and i will set marked for deletion on

1343
00:52:31,040 --> 00:52:34,400
that animator true i go down to line 200

1344
00:52:34,400 --> 00:52:36,640
and i uncomment request animation frame

1345
00:52:36,640 --> 00:52:40,160
again so that we can test it

1346
00:52:42,640 --> 00:52:44,800
i can see that whenever player collides

1347
00:52:44,800 --> 00:52:47,520
with an enemy that enemy gets deleted

1348
00:52:47,520 --> 00:52:50,160
perfect we have some interactions in the

1349
00:52:50,160 --> 00:52:52,240
same for each method i will also check

1350
00:52:52,240 --> 00:52:54,559
each anime against all currently active

1351
00:52:54,559 --> 00:52:57,880
projectiles they are stored inside

1352
00:52:57,880 --> 00:53:00,160
this.player.projectiles and i call for

1353
00:53:00,160 --> 00:53:03,119
each on that array as well like this

1354
00:53:03,119 --> 00:53:06,000
for each enemy inside enemies array we

1355
00:53:06,000 --> 00:53:08,240
check against every single projectile in

1356
00:53:08,240 --> 00:53:10,720
projectiles array

1357
00:53:10,720 --> 00:53:13,839
i say if this.check collision between

1358
00:53:13,839 --> 00:53:16,319
projectile from this iteration of this

1359
00:53:16,319 --> 00:53:17,760
for each

1360
00:53:17,760 --> 00:53:20,160
and enemy from this iteration from this

1361
00:53:20,160 --> 00:53:21,359
for each

1362
00:53:21,359 --> 00:53:23,680
if check collision is true decrease

1363
00:53:23,680 --> 00:53:27,040
enemy life by one

1364
00:53:27,359 --> 00:53:30,079
at the same time set marked for deletion

1365
00:53:30,079 --> 00:53:32,800
on that projectile that collided to true

1366
00:53:32,800 --> 00:53:34,880
so it gets deleted

1367
00:53:34,880 --> 00:53:37,359
then i check if enemy lives are less or

1368
00:53:37,359 --> 00:53:40,319
equal to zero

1369
00:53:40,720 --> 00:53:42,960
and if they are set marked for deletion

1370
00:53:42,960 --> 00:53:45,760
on that enemy to true as well

1371
00:53:45,760 --> 00:53:48,240
and lastly i will increase score by plus

1372
00:53:48,240 --> 00:53:49,280
one

1373
00:53:49,280 --> 00:53:51,280
actually i want each enemy to give

1374
00:53:51,280 --> 00:53:53,040
different amount of score points when

1375
00:53:53,040 --> 00:53:55,440
defeated so we will increase game score

1376
00:53:55,440 --> 00:53:58,400
by score property on that enemy

1377
00:53:58,400 --> 00:54:00,400
now i used three properties that don't

1378
00:54:00,400 --> 00:54:03,200
exist yet i go up to parent enemy class

1379
00:54:03,200 --> 00:54:07,119
and i declare them here i set lives to 5

1380
00:54:07,119 --> 00:54:09,280
and score that this enemy rewards will

1381
00:54:09,280 --> 00:54:11,680
be equal to the number of its lives like

1382
00:54:11,680 --> 00:54:12,480
this

1383
00:54:12,480 --> 00:54:14,400
i will also draw that number on top of

1384
00:54:14,400 --> 00:54:16,400
each anime for debugging purposes by

1385
00:54:16,400 --> 00:54:19,520
calling fill text here i pass it distort

1386
00:54:19,520 --> 00:54:22,079
lives from line 92 and x and y

1387
00:54:22,079 --> 00:54:24,480
coordinates of that enemy it's very

1388
00:54:24,480 --> 00:54:28,000
small so i will set fill style to black

1389
00:54:28,000 --> 00:54:30,240
and font property will be set to 20

1390
00:54:30,240 --> 00:54:34,599
pixels helvetica for now

1391
00:54:37,100 --> 00:54:44,459
[Music]

1392
00:54:44,559 --> 00:54:46,640
i need to define score on the main game

1393
00:54:46,640 --> 00:54:50,559
class here on line 154

1394
00:54:50,880 --> 00:54:53,359
and i will also define winning score

1395
00:54:53,359 --> 00:54:55,520
let's set it to 10 points for now so

1396
00:54:55,520 --> 00:54:58,480
it's easy to test

1397
00:54:58,800 --> 00:55:00,880
every time we increase score here we

1398
00:55:00,880 --> 00:55:03,040
check if the current score is more than

1399
00:55:03,040 --> 00:55:05,839
winning score and if it is game over

1400
00:55:05,839 --> 00:55:10,000
from line 153 is true

1401
00:55:10,559 --> 00:55:13,520
i go up to line 130 inside draw method

1402
00:55:13,520 --> 00:55:16,160
on ui class in this area i will write

1403
00:55:16,160 --> 00:55:18,640
code to display the current score to the

1404
00:55:18,640 --> 00:55:21,200
user i call build in fill text method

1405
00:55:21,200 --> 00:55:23,680
again and i pass it the text i want to

1406
00:55:23,680 --> 00:55:25,839
draw so this.game.score

1407
00:55:25,839 --> 00:55:27,920
and i want to draw it at coordinates

1408
00:55:27,920 --> 00:55:31,359
2040. i set font property to this.font

1409
00:55:31,359 --> 00:55:35,520
size from line 126 plus pixels space

1410
00:55:35,520 --> 00:55:40,079
plus this.font family from line 127.

1411
00:55:40,079 --> 00:55:42,319
i put a string that says score colon

1412
00:55:42,319 --> 00:55:44,319
space here plus we will concatenate

1413
00:55:44,319 --> 00:55:46,720
this.game.score

1414
00:55:46,720 --> 00:55:48,480
let's see if everything works

1415
00:55:48,480 --> 00:55:50,640
all seems to be fine except for the text

1416
00:55:50,640 --> 00:55:52,960
colors jumping around i will move this

1417
00:55:52,960 --> 00:55:55,599
fill style declaration up here and i set

1418
00:55:55,599 --> 00:55:58,880
this dot color to white

1419
00:56:00,160 --> 00:56:02,000
i can also do other adjustments to the

1420
00:56:02,000 --> 00:56:04,400
text for example shadows if i want the

1421
00:56:04,400 --> 00:56:06,559
shadows to apply only to the text and

1422
00:56:06,559 --> 00:56:08,799
not all the shapes on canvas i will put

1423
00:56:08,799 --> 00:56:10,799
it between built in save and restore

1424
00:56:10,799 --> 00:56:12,160
canvas methods

1425
00:56:12,160 --> 00:56:14,960
save method of canvas 2d api saves the

1426
00:56:14,960 --> 00:56:17,040
entire state of canvas at that point in

1427
00:56:17,040 --> 00:56:19,280
time that includes settings like stroke

1428
00:56:19,280 --> 00:56:22,720
style fill style line width global alpha

1429
00:56:22,720 --> 00:56:24,559
all shadow settings we will use in a

1430
00:56:24,559 --> 00:56:26,400
minute as well as other things like

1431
00:56:26,400 --> 00:56:28,240
clipping region or the current

1432
00:56:28,240 --> 00:56:30,480
transformation matrix so whatever we do

1433
00:56:30,480 --> 00:56:32,960
with scale translate and rotate canvas

1434
00:56:32,960 --> 00:56:35,200
methods then we can change the state of

1435
00:56:35,200 --> 00:56:37,280
canvas however we want and we call

1436
00:56:37,280 --> 00:56:40,000
restore canvas restore method restores

1437
00:56:40,000 --> 00:56:42,640
the most recently saved canvas state if

1438
00:56:42,640 --> 00:56:45,119
there is no saved state this method does

1439
00:56:45,119 --> 00:56:47,920
nothing so save and restore only work

1440
00:56:47,920 --> 00:56:50,319
when used together i will start applying

1441
00:56:50,319 --> 00:56:52,640
canvas shadows if i did that outside

1442
00:56:52,640 --> 00:56:54,720
save and restore shadows would get

1443
00:56:54,720 --> 00:56:56,480
applied to everything including player

1444
00:56:56,480 --> 00:56:58,559
and enemies but in our case these

1445
00:56:58,559 --> 00:57:00,799
shadows will only affect shapes and text

1446
00:57:00,799 --> 00:57:03,440
we draw in this area between this save

1447
00:57:03,440 --> 00:57:06,559
and this restore shadow offset x defines

1448
00:57:06,559 --> 00:57:08,480
the distance that shadow will be offset

1449
00:57:08,480 --> 00:57:10,640
horizontally it can be positive or

1450
00:57:10,640 --> 00:57:12,319
negative depending on if you want the

1451
00:57:12,319 --> 00:57:14,240
shadow to be to the left or to the right

1452
00:57:14,240 --> 00:57:16,720
from the source element shadow offset y

1453
00:57:16,720 --> 00:57:19,040
defines vertical distance of the shadow

1454
00:57:19,040 --> 00:57:21,680
i set shadow color to black i could also

1455
00:57:21,680 --> 00:57:23,520
set shadow blur but i don't need it at

1456
00:57:23,520 --> 00:57:26,079
this time so by wrapping code in save

1457
00:57:26,079 --> 00:57:27,920
and restore i make sure that canvas

1458
00:57:27,920 --> 00:57:30,240
shadows and this fill style property

1459
00:57:30,240 --> 00:57:32,640
affect only this drawing code and not

1460
00:57:32,640 --> 00:57:34,480
other shapes and graphics we are drawing

1461
00:57:34,480 --> 00:57:36,640
on the same canvas element this is a

1462
00:57:36,640 --> 00:57:38,640
pretty solid code base you can use this

1463
00:57:38,640 --> 00:57:40,640
as a base boilerplate for many different

1464
00:57:40,640 --> 00:57:42,559
games maybe some of you want to make a

1465
00:57:42,559 --> 00:57:44,480
copy of this project at this state and

1466
00:57:44,480 --> 00:57:46,400
save it in a different folder so you can

1467
00:57:46,400 --> 00:57:48,559
experiment with it later and use it as a

1468
00:57:48,559 --> 00:57:50,079
starting point of a different game

1469
00:57:50,079 --> 00:57:51,300
project

1470
00:57:51,300 --> 00:57:57,280
[Music]

1471
00:57:57,280 --> 00:57:59,040
win and lose condition in our game will

1472
00:57:59,040 --> 00:58:01,119
depend on how many score points can the

1473
00:58:01,119 --> 00:58:03,839
player get in a specific time window we

1474
00:58:03,839 --> 00:58:05,359
are going to handle those game over

1475
00:58:05,359 --> 00:58:08,400
messages here before we call restore

1476
00:58:08,400 --> 00:58:10,559
so if game over property on the main

1477
00:58:10,559 --> 00:58:13,760
game object is true we set text align to

1478
00:58:13,760 --> 00:58:14,799
center

1479
00:58:14,799 --> 00:58:16,640
we are going to display message 1 in

1480
00:58:16,640 --> 00:58:18,880
larger letters and under that there will

1481
00:58:18,880 --> 00:58:21,200
be message 2 and smaller font what these

1482
00:58:21,200 --> 00:58:23,200
two messages say will depend on how many

1483
00:58:23,200 --> 00:58:25,440
score points we managed to get in a

1484
00:58:25,440 --> 00:58:28,640
specified game time

1485
00:58:28,640 --> 00:58:30,319
i check if game score is more than

1486
00:58:30,319 --> 00:58:33,040
winning score

1487
00:58:33,440 --> 00:58:35,280
message 1 will say

1488
00:58:35,280 --> 00:58:37,839
you win

1489
00:58:39,280 --> 00:58:43,440
and message two will say well done

1490
00:58:44,240 --> 00:58:46,640
so that's our winning message else we

1491
00:58:46,640 --> 00:58:48,480
display the losing message so message

1492
00:58:48,480 --> 00:58:51,839
one is you lost

1493
00:58:52,960 --> 00:58:55,380
message two is try again next time

1494
00:58:55,380 --> 00:58:57,040
[Music]

1495
00:58:57,040 --> 00:58:58,559
now we actually need to draw these

1496
00:58:58,559 --> 00:59:01,119
messages on canvas so font for the first

1497
00:59:01,119 --> 00:59:04,079
message will be 50 pixels space plus

1498
00:59:04,079 --> 00:59:05,599
font family

1499
00:59:05,599 --> 00:59:07,680
then i call fill text and we draw

1500
00:59:07,680 --> 00:59:10,480
message 1 in the center of the screen

1501
00:59:10,480 --> 00:59:12,880
so x coordinate will be game with times

1502
00:59:12,880 --> 00:59:16,160
0.5 vertical y coordinate will be game

1503
00:59:16,160 --> 00:59:19,839
height times 0.5

1504
00:59:20,079 --> 00:59:22,240
i copy these two lines of code and i

1505
00:59:22,240 --> 00:59:24,319
change some things to draw message to in

1506
00:59:24,319 --> 00:59:27,440
smaller letters 25 pixels here and

1507
00:59:27,440 --> 00:59:30,480
message 2 here

1508
00:59:31,280 --> 00:59:34,960
i try to play the game and win

1509
00:59:35,040 --> 00:59:37,599
nice we get a winning message i need to

1510
00:59:37,599 --> 00:59:39,599
create some space between the lines so

1511
00:59:39,599 --> 00:59:41,760
first message will be minus 40 pixels

1512
00:59:41,760 --> 00:59:44,240
vertically and the second message plus

1513
00:59:44,240 --> 00:59:46,480
40 pixels vertically

1514
00:59:46,480 --> 00:59:48,960
let's see

1515
00:59:50,079 --> 00:59:52,810
yeah this is fine for now

1516
00:59:52,810 --> 00:59:58,880
[Music]

1517
00:59:58,880 --> 01:00:00,880
we need a time limit for our game on the

1518
01:00:00,880 --> 01:00:02,880
main game object i create two helper

1519
01:00:02,880 --> 01:00:05,119
variables i call them for example game

1520
01:00:05,119 --> 01:00:07,440
time which will start at 0 milliseconds

1521
01:00:07,440 --> 01:00:10,160
and time limit for testing purposes time

1522
01:00:10,160 --> 01:00:12,480
limit will be 5000 milliseconds 5

1523
01:00:12,480 --> 01:00:15,040
seconds after 5 seconds the game will

1524
01:00:15,040 --> 01:00:17,119
end and depending on how many score

1525
01:00:17,119 --> 01:00:19,040
points we managed to get we will display

1526
01:00:19,040 --> 01:00:21,040
winning or losing message

1527
01:00:21,040 --> 01:00:23,680
in update method i say if game over is

1528
01:00:23,680 --> 01:00:27,119
false take game time from line 181 and

1529
01:00:27,119 --> 01:00:29,760
increase it by delta time delta time is

1530
01:00:29,760 --> 01:00:31,599
the difference in milliseconds between

1531
01:00:31,599 --> 01:00:34,079
timestamp from this animation loop and

1532
01:00:34,079 --> 01:00:36,400
the timestamp from the previous loop so

1533
01:00:36,400 --> 01:00:38,240
it's the amount of milliseconds between

1534
01:00:38,240 --> 01:00:41,119
frames by adding delta time to game time

1535
01:00:41,119 --> 01:00:43,280
every time we draw a new frame we are

1536
01:00:43,280 --> 01:00:45,119
keeping track of how many milliseconds

1537
01:00:45,119 --> 01:00:47,520
passed since the game started game time

1538
01:00:47,520 --> 01:00:49,440
variable is simply just accumulating

1539
01:00:49,440 --> 01:00:52,240
milliseconds since the game started

1540
01:00:52,240 --> 01:00:54,240
if game time is more than time limit

1541
01:00:54,240 --> 01:00:56,160
from line 182

1542
01:00:56,160 --> 01:00:58,079
so when the game has been running for

1543
01:00:58,079 --> 01:01:00,880
5000 milliseconds we set game over to

1544
01:01:00,880 --> 01:01:03,359
true the final game will run longer i

1545
01:01:03,359 --> 01:01:05,359
just use 5 seconds time limit here so

1546
01:01:05,359 --> 01:01:06,960
it's easy to test

1547
01:01:06,960 --> 01:01:09,280
up inside ui class we want to draw game

1548
01:01:09,280 --> 01:01:11,839
timer on screen let's do it in this area

1549
01:01:11,839 --> 01:01:14,240
on line 143

1550
01:01:14,240 --> 01:01:16,559
i call fill text and the text will say

1551
01:01:16,559 --> 01:01:21,280
timer colon plus this dot game.time

1552
01:01:21,359 --> 01:01:24,559
add coordinates 20 100.

1553
01:01:24,559 --> 01:01:26,160
actually the variable we just created

1554
01:01:26,160 --> 01:01:28,799
was called game time like this and i

1555
01:01:28,799 --> 01:01:32,079
need to add space here

1556
01:01:33,040 --> 01:01:34,079
nice

1557
01:01:34,079 --> 01:01:36,480
so we can see game timer i want to

1558
01:01:36,480 --> 01:01:38,319
format that value so it looks a bit

1559
01:01:38,319 --> 01:01:40,559
cleaner i create a temporary helper

1560
01:01:40,559 --> 01:01:43,119
variable called formatted time

1561
01:01:43,119 --> 01:01:45,359
i want to move the decimal point to show

1562
01:01:45,359 --> 01:01:47,160
seconds so

1563
01:01:47,160 --> 01:01:52,440
this.game.gametime times 0.001

1564
01:01:53,920 --> 01:01:56,240
that works i also want to display only

1565
01:01:56,240 --> 01:01:58,400
one digit after the decimal point so i

1566
01:01:58,400 --> 01:02:01,359
use built in two fixed method and i pass

1567
01:02:01,359 --> 01:02:04,240
it one two fixed method formats a number

1568
01:02:04,240 --> 01:02:07,040
using fixed point notation we can use it

1569
01:02:07,040 --> 01:02:08,880
to define the number of digits we want

1570
01:02:08,880 --> 01:02:12,079
to appear after the decimal point

1571
01:02:12,079 --> 01:02:14,480
perfect we have game time functionality

1572
01:02:14,480 --> 01:02:16,240
i'm getting a buck when i get a losing

1573
01:02:16,240 --> 01:02:18,079
message and then i defeat a couple of

1574
01:02:18,079 --> 01:02:20,240
remaining enemies and that message

1575
01:02:20,240 --> 01:02:22,480
switches to the winning message i want

1576
01:02:22,480 --> 01:02:24,000
to make sure that after game over

1577
01:02:24,000 --> 01:02:26,000
message appears we are no longer able to

1578
01:02:26,000 --> 01:02:28,559
gain more score points down here inside

1579
01:02:28,559 --> 01:02:30,640
update method on game class i only want

1580
01:02:30,640 --> 01:02:35,640
to increase score if game over is false

1581
01:02:38,160 --> 01:02:40,319
i get an error it's supposed to be

1582
01:02:40,319 --> 01:02:42,720
this.gameover like this

1583
01:02:42,720 --> 01:02:45,680
this will fix the bug

1584
01:02:45,680 --> 01:02:47,839
we have the base game we have player

1585
01:02:47,839 --> 01:02:49,839
enemies and projectiles we have

1586
01:02:49,839 --> 01:02:53,440
recharging ammo score timer and win and

1587
01:02:53,440 --> 01:02:55,680
lose condition you can save this code in

1588
01:02:55,680 --> 01:02:57,280
a separate folder and use it as a base

1589
01:02:57,280 --> 01:02:59,200
skeleton for many different games if you

1590
01:02:59,200 --> 01:03:01,200
want from this point i will start adding

1591
01:03:01,200 --> 01:03:02,799
graphics and features that will be

1592
01:03:02,799 --> 01:03:05,119
specific to our steampunk alien game

1593
01:03:05,119 --> 01:03:08,030
this will be the fun part let's go

1594
01:03:08,030 --> 01:03:13,200
[Music]

1595
01:03:13,200 --> 01:03:15,119
we will be using large detailed images

1596
01:03:15,119 --> 01:03:16,880
and graphics today i will put all of

1597
01:03:16,880 --> 01:03:19,280
them here inside index html and because

1598
01:03:19,280 --> 01:03:21,440
all the code in script.js is inside

1599
01:03:21,440 --> 01:03:24,000
event listener for load event javascript

1600
01:03:24,000 --> 01:03:26,079
will only run after all our images have

1601
01:03:26,079 --> 01:03:27,920
been fully loaded this will prevent

1602
01:03:27,920 --> 01:03:29,200
errors

1603
01:03:29,200 --> 01:03:31,039
i will separate art assets in this

1604
01:03:31,039 --> 01:03:33,520
project into three different categories

1605
01:03:33,520 --> 01:03:35,599
characters which will include player and

1606
01:03:35,599 --> 01:03:37,920
enemies props which will include things

1607
01:03:37,920 --> 01:03:39,839
like mechanical parts that fall from

1608
01:03:39,839 --> 01:03:42,160
enemies when we damage them and game

1609
01:03:42,160 --> 01:03:43,520
environment

1610
01:03:43,520 --> 01:03:45,359
let's start by creating the game world

1611
01:03:45,359 --> 01:03:48,799
first img element with an id of layer 1

1612
01:03:48,799 --> 01:03:51,200
and source will point towards that png

1613
01:03:51,200 --> 01:03:53,280
file you can download all project images

1614
01:03:53,280 --> 01:03:54,960
in the description i will put all my

1615
01:03:54,960 --> 01:03:57,039
images into a project folder i call

1616
01:03:57,039 --> 01:03:59,280
assets our game world will be made out

1617
01:03:59,280 --> 01:04:01,359
of four separate layers for parallax

1618
01:04:01,359 --> 01:04:04,960
scrolling effect layer one two three and

1619
01:04:04,960 --> 01:04:06,720
four like this

1620
01:04:06,720 --> 01:04:08,559
i don't really want to draw these images

1621
01:04:08,559 --> 01:04:11,039
on the web page like this i only want to

1622
01:04:11,039 --> 01:04:13,280
draw them on canvas with the javascript

1623
01:04:13,280 --> 01:04:16,559
so inside style css i set all of them to

1624
01:04:16,559 --> 01:04:19,440
display none

1625
01:04:21,760 --> 01:04:24,319
in script js on line 116 we have a

1626
01:04:24,319 --> 01:04:27,359
custom class i called layer its job will

1627
01:04:27,359 --> 01:04:29,200
be to set up each individual layer

1628
01:04:29,200 --> 01:04:31,599
object constructor will expect three

1629
01:04:31,599 --> 01:04:34,480
arguments coming from the outside game

1630
01:04:34,480 --> 01:04:38,400
image and speed modifier

1631
01:04:38,559 --> 01:04:40,720
i convert those arguments into class

1632
01:04:40,720 --> 01:04:43,920
properties like this

1633
01:04:47,680 --> 01:04:50,599
the width of the images we are using is

1634
01:04:50,599 --> 01:04:54,720
1768 pixels and the height is 500 pixels

1635
01:04:54,720 --> 01:04:56,960
horizontal x coordinate will start at

1636
01:04:56,960 --> 01:04:58,240
zero

1637
01:04:58,240 --> 01:05:02,000
and y will also be zero

1638
01:05:02,880 --> 01:05:04,720
we will need update method to move the

1639
01:05:04,720 --> 01:05:06,799
background layers from right to left as

1640
01:05:06,799 --> 01:05:09,280
the game scrolls if horizontal x

1641
01:05:09,280 --> 01:05:11,760
coordinate is less or equal to minus

1642
01:05:11,760 --> 01:05:14,400
width from line 121 meaning the

1643
01:05:14,400 --> 01:05:16,240
background image has moved across the

1644
01:05:16,240 --> 01:05:18,559
screen and is now fully hidden behind

1645
01:05:18,559 --> 01:05:21,200
the left edge of canvas we set x back to

1646
01:05:21,200 --> 01:05:23,760
zero so that it can scroll again

1647
01:05:23,760 --> 01:05:26,720
else decrease x by game speed times

1648
01:05:26,720 --> 01:05:29,200
speed modifier each layer object will

1649
01:05:29,200 --> 01:05:31,119
have different speed modifier to create

1650
01:05:31,119 --> 01:05:33,280
parallax but all will depend on the main

1651
01:05:33,280 --> 01:05:35,359
game speed variable so that all four

1652
01:05:35,359 --> 01:05:37,920
layers can be controlled from one place

1653
01:05:37,920 --> 01:05:39,920
gamespeed variable doesn't exist yet so

1654
01:05:39,920 --> 01:05:43,039
i created on the main game class here

1655
01:05:43,039 --> 01:05:45,599
initially i set it to 1.

1656
01:05:45,599 --> 01:05:47,760
layer class will also need a draw method

1657
01:05:47,760 --> 01:05:50,240
it will take context as an argument i

1658
01:05:50,240 --> 01:05:52,400
call built in draw image method this

1659
01:05:52,400 --> 01:05:54,480
method needs at least three arguments

1660
01:05:54,480 --> 01:05:56,799
image we want to draw so this dot image

1661
01:05:56,799 --> 01:05:59,680
from line 119 and where on canvas we

1662
01:05:59,680 --> 01:06:02,000
want to draw it so i want to draw it at

1663
01:06:02,000 --> 01:06:05,799
this dot x this dot y from lines 123 and

1664
01:06:05,799 --> 01:06:08,480
124 so we have our layer class which

1665
01:06:08,480 --> 01:06:11,599
will handle individual background layers

1666
01:06:11,599 --> 01:06:13,440
we will also need background class that

1667
01:06:13,440 --> 01:06:15,359
will put all four layer objects together

1668
01:06:15,359 --> 01:06:17,680
to create the game world constructor

1669
01:06:17,680 --> 01:06:19,520
will take the main game object as an

1670
01:06:19,520 --> 01:06:21,920
argument i convert it into a class

1671
01:06:21,920 --> 01:06:24,079
property like this

1672
01:06:24,079 --> 01:06:26,319
here we will grab all four images for

1673
01:06:26,319 --> 01:06:28,079
each layer with javascript so

1674
01:06:28,079 --> 01:06:31,200
this.image1 will be

1675
01:06:31,200 --> 01:06:33,119
by document.getelementbyid and i pass it

1676
01:06:33,119 --> 01:06:37,119
layer one the id i gave it in index html

1677
01:06:37,119 --> 01:06:39,599
this.layer1 property will be an object

1678
01:06:39,599 --> 01:06:41,440
that holds an instance of layer class

1679
01:06:41,440 --> 01:06:45,440
from line 116 so new layer like this

1680
01:06:45,440 --> 01:06:48,240
on line 117 i can see that layer class

1681
01:06:48,240 --> 01:06:50,960
constructor expects game image and speed

1682
01:06:50,960 --> 01:06:53,280
modifier arguments so i pass it this dot

1683
01:06:53,280 --> 01:06:55,520
game from line 137

1684
01:06:55,520 --> 01:06:58,960
this look image 1 from 938 and speed

1685
01:06:58,960 --> 01:07:02,559
modifier will be one for now

1686
01:07:02,720 --> 01:07:04,319
update method will move all the layer

1687
01:07:04,319 --> 01:07:06,880
objects

1688
01:07:08,160 --> 01:07:10,640
and draw method will draw all of them

1689
01:07:10,640 --> 01:07:12,960
we will hold all layer objects inside

1690
01:07:12,960 --> 01:07:15,039
this dot layer's property it will be an

1691
01:07:15,039 --> 01:07:19,680
array let's start with just layer one

1692
01:07:21,280 --> 01:07:23,440
inside update method i take these dot

1693
01:07:23,440 --> 01:07:26,839
layers and i call for each

1694
01:07:26,839 --> 01:07:29,839
method for each layer object call their

1695
01:07:29,839 --> 01:07:31,920
associated update method we declared on

1696
01:07:31,920 --> 01:07:33,680
line 126

1697
01:07:33,680 --> 01:07:35,760
draw method will expect context as an

1698
01:07:35,760 --> 01:07:38,480
argument to specify which canvas we want

1699
01:07:38,480 --> 01:07:39,760
to draw on

1700
01:07:39,760 --> 01:07:42,000
inside we will do the same thing call

1701
01:07:42,000 --> 01:07:44,000
for each on layers array and for each

1702
01:07:44,000 --> 01:07:46,640
layer object trigger its draw method and

1703
01:07:46,640 --> 01:07:48,799
pass it that context value because we

1704
01:07:48,799 --> 01:07:51,440
know that the draw method on line 130

1705
01:07:51,440 --> 01:07:53,839
expects that argument

1706
01:07:53,839 --> 01:07:56,160
so background will handle all layers to

1707
01:07:56,160 --> 01:07:58,480
create the game world layer class will

1708
01:07:58,480 --> 01:08:00,559
handle logic for each individual

1709
01:08:00,559 --> 01:08:04,079
background layer object separately

1710
01:08:04,079 --> 01:08:05,920
now to animate the background i just

1711
01:08:05,920 --> 01:08:07,760
need to create an instance of background

1712
01:08:07,760 --> 01:08:10,480
class inside game class constructor same

1713
01:08:10,480 --> 01:08:12,559
as we did before with player and input

1714
01:08:12,559 --> 01:08:14,960
handler classes background class expects

1715
01:08:14,960 --> 01:08:16,960
game as an argument so i pass it this

1716
01:08:16,960 --> 01:08:19,120
keyword because i am inside that game

1717
01:08:19,120 --> 01:08:22,000
class right now

1718
01:08:22,000 --> 01:08:24,400
inside blade method on game class i take

1719
01:08:24,400 --> 01:08:26,640
this new background property and i call

1720
01:08:26,640 --> 01:08:29,440
its update method

1721
01:08:29,440 --> 01:08:31,359
inside the draw method on game class i

1722
01:08:31,359 --> 01:08:32,880
call draw method on the background

1723
01:08:32,880 --> 01:08:36,880
object and i pass it context along here

1724
01:08:36,880 --> 01:08:38,480
notice that i am drawing background

1725
01:08:38,480 --> 01:08:40,719
first then the player this will make

1726
01:08:40,719 --> 01:08:42,400
sure that the background is behind the

1727
01:08:42,400 --> 01:08:44,560
player and doesn't cover it

1728
01:08:44,560 --> 01:08:46,480
i'm getting an error

1729
01:08:46,480 --> 01:08:48,319
i go back to my background class and i

1730
01:08:48,319 --> 01:08:50,480
want to put this layer 1 object into the

1731
01:08:50,480 --> 01:08:54,560
array so i have to use this keyword

1732
01:08:56,960 --> 01:08:58,880
nice we are animating layer 1 of our

1733
01:08:58,880 --> 01:09:01,359
background

1734
01:09:01,359 --> 01:09:03,199
i can change scrolling speed by changing

1735
01:09:03,199 --> 01:09:05,759
the value i pass as a speed modifier if

1736
01:09:05,759 --> 01:09:08,400
i pass it 5 the game speed is 1 because

1737
01:09:08,400 --> 01:09:10,560
i'm multiplying game speed times speed

1738
01:09:10,560 --> 01:09:14,000
modifier 1 times 5 is 5 so background

1739
01:09:14,000 --> 01:09:16,640
will scroll at the speed of 5 pixels per

1740
01:09:16,640 --> 01:09:17,920
frame

1741
01:09:17,920 --> 01:09:19,520
i will bring all other layers into the

1742
01:09:19,520 --> 01:09:20,400
project

1743
01:09:20,400 --> 01:09:22,719
i bring their images first then for each

1744
01:09:22,719 --> 01:09:26,960
one i create an instance of layer class

1745
01:09:29,279 --> 01:09:31,520
and i put all of them inside this dot

1746
01:09:31,520 --> 01:09:34,920
layers array

1747
01:09:41,199 --> 01:09:43,679
okay now we see all four layers

1748
01:09:43,679 --> 01:09:45,199
i give each layer a different speed

1749
01:09:45,199 --> 01:09:46,640
modifier

1750
01:09:46,640 --> 01:09:48,480
these values are passed as speed

1751
01:09:48,480 --> 01:09:50,719
modifier and they will be multiplied by

1752
01:09:50,719 --> 01:09:52,880
the current game speed you can control

1753
01:09:52,880 --> 01:09:54,239
scrolling speed of each layer

1754
01:09:54,239 --> 01:09:56,159
individually like this

1755
01:09:56,159 --> 01:09:58,719
for now i will set speed modifier to 1

1756
01:09:58,719 --> 01:10:01,040
on all 4 layers

1757
01:10:01,040 --> 01:10:03,760
you can see that because of line 128 as

1758
01:10:03,760 --> 01:10:05,360
soon as the layer images slide

1759
01:10:05,360 --> 01:10:07,840
completely off screen they reset back to

1760
01:10:07,840 --> 01:10:10,560
x position of 0 so that they can slide

1761
01:10:10,560 --> 01:10:13,440
again we are getting this gap to get a

1762
01:10:13,440 --> 01:10:15,360
seamless scrolling background effect we

1763
01:10:15,360 --> 01:10:17,440
can use a simple trick we can place a

1764
01:10:17,440 --> 01:10:19,679
second identical image next to the first

1765
01:10:19,679 --> 01:10:21,679
one so at the point where the first

1766
01:10:21,679 --> 01:10:23,840
image doesn't fill the entire game area

1767
01:10:23,840 --> 01:10:25,679
the second image comes in to fill the

1768
01:10:25,679 --> 01:10:28,000
gap the second image will never be fully

1769
01:10:28,000 --> 01:10:30,000
visible it will be filling in just for

1770
01:10:30,000 --> 01:10:31,760
that short period of time before the

1771
01:10:31,760 --> 01:10:33,679
first image can reset to its starting

1772
01:10:33,679 --> 01:10:35,920
position again reset to the original

1773
01:10:35,920 --> 01:10:37,760
position happens in one frame so it's

1774
01:10:37,760 --> 01:10:40,159
not visible by naked eye it will create

1775
01:10:40,159 --> 01:10:42,400
an illusion that we have one endless

1776
01:10:42,400 --> 01:10:45,199
seamless background how do i apply that

1777
01:10:45,199 --> 01:10:48,000
in code i simply draw a second identical

1778
01:10:48,000 --> 01:10:50,719
image but i need to make sure it is next

1779
01:10:50,719 --> 01:10:52,719
to the first one the second image will

1780
01:10:52,719 --> 01:10:55,360
start where the first image ends so its

1781
01:10:55,360 --> 01:10:58,080
horizontal x position will be this dot x

1782
01:10:58,080 --> 01:11:01,120
plus this dot width like this

1783
01:11:01,120 --> 01:11:03,199
and that's it we have endless parallax

1784
01:11:03,199 --> 01:11:06,159
background implemented in our game

1785
01:11:06,159 --> 01:11:07,760
i can change its scrolling speed by

1786
01:11:07,760 --> 01:11:09,520
adjusting speed property on the main

1787
01:11:09,520 --> 01:11:11,520
game object or i can change speed

1788
01:11:11,520 --> 01:11:13,920
modifier values i pass as arguments when

1789
01:11:13,920 --> 01:11:16,880
i create individual layer objects

1790
01:11:16,880 --> 01:11:18,400
i'm getting a small stutter when the

1791
01:11:18,400 --> 01:11:20,080
background image is reset back to

1792
01:11:20,080 --> 01:11:22,960
position 0. i fix that by removing this

1793
01:11:22,960 --> 01:11:26,840
else statement here

1794
01:11:27,600 --> 01:11:29,440
now the reset should be smooth and not

1795
01:11:29,440 --> 01:11:30,880
noticeable

1796
01:11:30,880 --> 01:11:32,880
i can also use small values as speed

1797
01:11:32,880 --> 01:11:35,280
modifiers

1798
01:11:35,280 --> 01:11:37,040
i want the back layer to scroll very

1799
01:11:37,040 --> 01:11:40,320
slowly if i use speed modifier 0.2 and

1800
01:11:40,320 --> 01:11:42,880
base game speed is 1 that layer will

1801
01:11:42,880 --> 01:11:45,679
scroll by 0.2 pixels per frame because

1802
01:11:45,679 --> 01:11:47,760
we are multiplying game speed by speed

1803
01:11:47,760 --> 01:11:49,360
modifier

1804
01:11:49,360 --> 01:11:51,679
i will try 0.2

1805
01:11:51,679 --> 01:11:53,280
0.4

1806
01:11:53,280 --> 01:11:55,679
1 because layer 3 is this ground image

1807
01:11:55,679 --> 01:11:57,360
so that it should scroll the same speed

1808
01:11:57,360 --> 01:11:59,840
as the rest of the main game objects and

1809
01:11:59,840 --> 01:12:01,440
layer 4 are these items in the

1810
01:12:01,440 --> 01:12:03,600
foreground so i will make them scroll at

1811
01:12:03,600 --> 01:12:06,719
1.5 base game speed

1812
01:12:06,719 --> 01:12:08,159
the issue we have right now is that

1813
01:12:08,159 --> 01:12:10,159
layer 4 these foreground objects should

1814
01:12:10,159 --> 01:12:12,320
be in front of the player but right now

1815
01:12:12,320 --> 01:12:14,080
they are behind because in the main

1816
01:12:14,080 --> 01:12:16,080
animation loop i'm drawing all four

1817
01:12:16,080 --> 01:12:17,840
background layers before i draw the

1818
01:12:17,840 --> 01:12:20,159
player there are multiple ways to solve

1819
01:12:20,159 --> 01:12:22,080
this i'll use the simplest possible

1820
01:12:22,080 --> 01:12:23,360
solution

1821
01:12:23,360 --> 01:12:26,719
i will draw only layer 1 2 and 3 here as

1822
01:12:26,719 --> 01:12:29,040
part of the background class and remove

1823
01:12:29,040 --> 01:12:31,679
layer 4 to draw it separately later

1824
01:12:31,679 --> 01:12:33,760
because i removed layer 4 from the array

1825
01:12:33,760 --> 01:12:35,920
i need to call its update method first

1826
01:12:35,920 --> 01:12:37,600
from inside update method on the main

1827
01:12:37,600 --> 01:12:41,000
game class here on line 226 i'm calling

1828
01:12:41,000 --> 01:12:43,520
background.update which updates layers 1

1829
01:12:43,520 --> 01:12:46,159
2 and 3 and i will also call update on

1830
01:12:46,159 --> 01:12:49,120
layer 4 like this

1831
01:12:49,120 --> 01:12:51,199
inside draw method we are redrawing all

1832
01:12:51,199 --> 01:12:53,199
elements that make up our game for every

1833
01:12:53,199 --> 01:12:55,199
animation frame first we draw the

1834
01:12:55,199 --> 01:12:57,360
background which now contains only layer

1835
01:12:57,360 --> 01:13:00,080
1 2 and 3. then we draw the player on

1836
01:13:00,080 --> 01:13:02,800
top of that then we draw ui then enemies

1837
01:13:02,800 --> 01:13:04,400
and on top of everything we will draw

1838
01:13:04,400 --> 01:13:06,400
background layer 4 to make it appear in

1839
01:13:06,400 --> 01:13:08,960
front of all other game objects

1840
01:13:08,960 --> 01:13:10,640
the thing to understand is that since we

1841
01:13:10,640 --> 01:13:11,920
are drawing everything on the same

1842
01:13:11,920 --> 01:13:14,320
canvas element what is drawn first will

1843
01:13:14,320 --> 01:13:16,560
be drawn behind the thing that is drawn

1844
01:13:16,560 --> 01:13:17,520
after

1845
01:13:17,520 --> 01:13:21,280
background will be behind the player

1846
01:13:26,480 --> 01:13:28,480
time to draw the player we start by

1847
01:13:28,480 --> 01:13:30,400
bringing player image into the project

1848
01:13:30,400 --> 01:13:32,960
here in index html i created this

1849
01:13:32,960 --> 01:13:34,480
seahorse sprite sheet that you can

1850
01:13:34,480 --> 01:13:36,400
download and use we will have basic

1851
01:13:36,400 --> 01:13:38,159
swimming animation and we will have

1852
01:13:38,159 --> 01:13:40,080
power up animation row because when the

1853
01:13:40,080 --> 01:13:42,080
player collects a special overcharged

1854
01:13:42,080 --> 01:13:44,239
fish it will absorb its energy the

1855
01:13:44,239 --> 01:13:46,080
player's eyes and chest will light up

1856
01:13:46,080 --> 01:13:48,080
and player will shoot two lasers instead

1857
01:13:48,080 --> 01:13:51,440
of one in script.js i go to line 59

1858
01:13:51,440 --> 01:13:53,679
inside player class constructor and i

1859
01:13:53,679 --> 01:13:55,600
bring the image into the project using

1860
01:13:55,600 --> 01:13:57,920
getelementbyid same as we did with

1861
01:13:57,920 --> 01:13:59,520
background images

1862
01:13:59,520 --> 01:14:02,080
in style css i give player image display

1863
01:14:02,080 --> 01:14:04,320
none

1864
01:14:06,480 --> 01:14:07,920
we are bringing the image into

1865
01:14:07,920 --> 01:14:10,719
javascript project here on line 59.

1866
01:14:10,719 --> 01:14:12,640
inside the draw method currently we are

1867
01:14:12,640 --> 01:14:14,719
drawing a black rectangle representing

1868
01:14:14,719 --> 01:14:16,719
the player to draw the sprite sheet i

1869
01:14:16,719 --> 01:14:18,560
will use built in canvas draw image

1870
01:14:18,560 --> 01:14:19,520
method

1871
01:14:19,520 --> 01:14:21,679
i pass it the image i want to draw so

1872
01:14:21,679 --> 01:14:24,800
this dot image from line 59 and x and y

1873
01:14:24,800 --> 01:14:26,880
coordinates where i want to draw it i

1874
01:14:26,880 --> 01:14:28,800
want to draw it at player's current x

1875
01:14:28,800 --> 01:14:31,840
and y position from lines 54 and 55. you

1876
01:14:31,840 --> 01:14:33,679
can see we are drawing the entire sprite

1877
01:14:33,679 --> 01:14:36,320
sheet with all its frames and rows draw

1878
01:14:36,320 --> 01:14:38,400
image method can accept three arguments

1879
01:14:38,400 --> 01:14:40,400
like this we can also give it five

1880
01:14:40,400 --> 01:14:42,560
arguments by adding width and height

1881
01:14:42,560 --> 01:14:44,400
in case of a sprite sheet like this it

1882
01:14:44,400 --> 01:14:46,320
will just squeeze all frames into an

1883
01:14:46,320 --> 01:14:48,239
area of one frame we don't really want

1884
01:14:48,239 --> 01:14:49,199
that

1885
01:14:49,199 --> 01:14:50,880
what we need is the longest version of

1886
01:14:50,880 --> 01:14:52,880
draw image method that expects nine

1887
01:14:52,880 --> 01:14:54,719
arguments and it gives us the most

1888
01:14:54,719 --> 01:14:56,719
control over the image we want to draw

1889
01:14:56,719 --> 01:14:59,120
on canvas those nine arguments are image

1890
01:14:59,120 --> 01:15:02,400
we want to draw source x source y source

1891
01:15:02,400 --> 01:15:04,640
width and source height of the area we

1892
01:15:04,640 --> 01:15:06,880
want to crop out from the source image

1893
01:15:06,880 --> 01:15:09,440
and destination x destination y

1894
01:15:09,440 --> 01:15:11,520
destination with and destination height

1895
01:15:11,520 --> 01:15:13,679
to specify where we want to draw that

1896
01:15:13,679 --> 01:15:15,520
cropped out piece of image on

1897
01:15:15,520 --> 01:15:17,840
destination canvas we will need some

1898
01:15:17,840 --> 01:15:20,080
helper variables as well frame x will

1899
01:15:20,080 --> 01:15:21,360
cycle through the sprite sheet

1900
01:15:21,360 --> 01:15:23,920
horizontally frame y will determine row

1901
01:15:23,920 --> 01:15:26,400
of the sprite sheet in this case row 0

1902
01:15:26,400 --> 01:15:29,280
or row 1.

1903
01:15:29,280 --> 01:15:31,280
i need to crop out just one frame from

1904
01:15:31,280 --> 01:15:33,360
the source sprite sheet image so source

1905
01:15:33,360 --> 01:15:35,679
x will be frame x times width of a

1906
01:15:35,679 --> 01:15:37,840
single frame which in our case is the

1907
01:15:37,840 --> 01:15:39,840
width of player because i like to size

1908
01:15:39,840 --> 01:15:41,840
my images to the same size we will draw

1909
01:15:41,840 --> 01:15:43,280
them in game

1910
01:15:43,280 --> 01:15:46,000
when frame x is 0 we display this frame

1911
01:15:46,000 --> 01:15:49,360
when frame x is 1 1 times width of 120

1912
01:15:49,360 --> 01:15:52,640
pixels is 120 so we will draw this frame

1913
01:15:52,640 --> 01:15:56,880
frame x 2 will be 2 x 120 so 240 pixels

1914
01:15:56,880 --> 01:15:59,520
this frame and so on it will work the

1915
01:15:59,520 --> 01:16:01,920
same with frame y vertically frame y

1916
01:16:01,920 --> 01:16:03,520
times height of the player which is

1917
01:16:03,520 --> 01:16:05,199
identical to the height of the sprite

1918
01:16:05,199 --> 01:16:07,760
sheet frame source width is width of a

1919
01:16:07,760 --> 01:16:10,480
single frame

1920
01:16:10,640 --> 01:16:12,320
source height is height of a single

1921
01:16:12,320 --> 01:16:13,760
frame

1922
01:16:13,760 --> 01:16:15,600
now we are cropping out just one frame

1923
01:16:15,600 --> 01:16:16,250
perfect

1924
01:16:16,250 --> 01:16:17,920
[Music]

1925
01:16:17,920 --> 01:16:19,440
i will animate the sprite sheet by

1926
01:16:19,440 --> 01:16:21,840
cycling between frames horizontally from

1927
01:16:21,840 --> 01:16:24,640
0 to max frame in the case of player

1928
01:16:24,640 --> 01:16:27,520
sprite sheet max frame is 37 we count

1929
01:16:27,520 --> 01:16:29,760
from 0.

1930
01:16:29,760 --> 01:16:31,600
i will handle sprite animation logic

1931
01:16:31,600 --> 01:16:34,400
down here it's simple if frame x from

1932
01:16:34,400 --> 01:16:37,360
line 56 is less than max frame from line

1933
01:16:37,360 --> 01:16:40,640
58 increase frame x by 1.

1934
01:16:40,640 --> 01:16:44,480
else reset frame x back to zero

1935
01:16:44,480 --> 01:16:46,159
if you prepare your sprite sheets well

1936
01:16:46,159 --> 01:16:48,000
in graphics editor the way i prepared

1937
01:16:48,000 --> 01:16:50,320
the sea horse for you you only need very

1938
01:16:50,320 --> 01:16:53,760
little code to get the animation

1939
01:16:53,760 --> 01:16:55,840
if i set frame y to 1 we will see the

1940
01:16:55,840 --> 01:16:57,679
second row in the sprite sheet we will

1941
01:16:57,679 --> 01:17:00,000
use that for power up state for now i

1942
01:17:00,000 --> 01:17:03,470
set it back to 0.

1943
01:17:03,470 --> 01:17:10,320
[Music]

1944
01:17:10,320 --> 01:17:12,159
at this point i no longer need the black

1945
01:17:12,159 --> 01:17:14,719
rectangle that represents the player but

1946
01:17:14,719 --> 01:17:16,640
it is still useful to keep track of that

1947
01:17:16,640 --> 01:17:19,440
area because it will be player's hitbox

1948
01:17:19,440 --> 01:17:21,920
used for collision detection i replace

1949
01:17:21,920 --> 01:17:24,640
fill rectangle with stroke rectangle i

1950
01:17:24,640 --> 01:17:26,719
remove this fill style declaration

1951
01:17:26,719 --> 01:17:28,880
stroke style will be black by default

1952
01:17:28,880 --> 01:17:31,280
unless we set it to a different color

1953
01:17:31,280 --> 01:17:33,360
i want to have a debug mode in my game

1954
01:17:33,360 --> 01:17:35,520
when i press letter d the game will show

1955
01:17:35,520 --> 01:17:37,840
hitboxes and maybe other things like

1956
01:17:37,840 --> 01:17:40,000
enemy hit points player hitbox is this

1957
01:17:40,000 --> 01:17:42,880
black rectangle we are outlining so i

1958
01:17:42,880 --> 01:17:45,840
only want to draw that if game.debug is

1959
01:17:45,840 --> 01:17:48,159
true

1960
01:17:49,040 --> 01:17:50,960
i need to create that property so down

1961
01:17:50,960 --> 01:17:53,679
here inside game class constructor i say

1962
01:17:53,679 --> 01:17:56,000
this.debug is true

1963
01:17:56,000 --> 01:17:57,600
the last thing i need is to create a

1964
01:17:57,600 --> 01:17:59,360
switch that will allow the user to

1965
01:17:59,360 --> 01:18:01,920
toggle debug mode on and off by pressing

1966
01:18:01,920 --> 01:18:03,360
letter d

1967
01:18:03,360 --> 01:18:05,440
to create a toggle with javascript is

1968
01:18:05,440 --> 01:18:08,000
simple i go up inside our input handler

1969
01:18:08,000 --> 01:18:10,320
class and inside key down event listener

1970
01:18:10,320 --> 01:18:12,719
i create an else if statement and i

1971
01:18:12,719 --> 01:18:14,480
check if the key that was pressed is

1972
01:18:14,480 --> 01:18:15,600
letter d

1973
01:18:15,600 --> 01:18:18,239
if it is i set the new debug property we

1974
01:18:18,239 --> 01:18:20,640
just created on the game object to its

1975
01:18:20,640 --> 01:18:23,520
opposite value so if it's true i set it

1976
01:18:23,520 --> 01:18:26,960
to false if it's false i set it to true

1977
01:18:26,960 --> 01:18:28,719
now when i play my game i can toggle

1978
01:18:28,719 --> 01:18:30,800
debug mode on and off by pressing the

1979
01:18:30,800 --> 01:18:33,440
letter d at this point debug mode only

1980
01:18:33,440 --> 01:18:35,760
shows and hides player hitbox but we

1981
01:18:35,760 --> 01:18:37,679
will attach more functionality to it a

1982
01:18:37,679 --> 01:18:40,840
bit later

1983
01:18:43,280 --> 01:18:45,040
nice we are making a lot of progress

1984
01:18:45,040 --> 01:18:47,360
let's add more characters to the game

1985
01:18:47,360 --> 01:18:49,440
the base game loop will have three enemy

1986
01:18:49,440 --> 01:18:51,520
types i created multiple animations for

1987
01:18:51,520 --> 01:18:53,440
each enemy type to give our game more

1988
01:18:53,440 --> 01:18:55,600
variety and i will show you how easy it

1989
01:18:55,600 --> 01:18:57,920
is to swap between them you can download

1990
01:18:57,920 --> 01:18:59,840
all our datasets in the project files in

1991
01:18:59,840 --> 01:19:01,440
the section below i made these

1992
01:19:01,440 --> 01:19:03,040
characters spreadsheets for you so feel

1993
01:19:03,040 --> 01:19:04,480
free to keep them for your personal

1994
01:19:04,480 --> 01:19:06,400
projects you can modify them and do

1995
01:19:06,400 --> 01:19:07,840
whatever you want with them you can

1996
01:19:07,840 --> 01:19:09,199
credit me if you use it for your

1997
01:19:09,199 --> 01:19:11,120
personal projects but only if you want

1998
01:19:11,120 --> 01:19:12,960
also if you want the base photoshop

1999
01:19:12,960 --> 01:19:15,440
files or separate pieces in png format

2000
01:19:15,440 --> 01:19:17,120
for all these characters so that you can

2001
01:19:17,120 --> 01:19:18,480
animate them and turn them into

2002
01:19:18,480 --> 01:19:20,159
spreadsheets yourself let me know the

2003
01:19:20,159 --> 01:19:22,000
best free software to create custom

2004
01:19:22,000 --> 01:19:24,640
sprite animations is dragonbones if you

2005
01:19:24,640 --> 01:19:26,239
want more advanced features there is

2006
01:19:26,239 --> 01:19:28,560
also a paid software called spine you

2007
01:19:28,560 --> 01:19:29,920
don't need any of that because i'm

2008
01:19:29,920 --> 01:19:31,679
already giving you complete ready to use

2009
01:19:31,679 --> 01:19:33,280
sprite sheets this is just for those of

2010
01:19:33,280 --> 01:19:34,719
you who want to learn more and create

2011
01:19:34,719 --> 01:19:36,320
custom animations or different

2012
01:19:36,320 --> 01:19:38,000
animations than the ones i created for

2013
01:19:38,000 --> 01:19:39,920
you so i'm bringing three new images

2014
01:19:39,920 --> 01:19:41,280
into the project

2015
01:19:41,280 --> 01:19:42,960
angular 1 will be the most basic

2016
01:19:42,960 --> 01:19:45,199
anglerfish anime type the sprite sheet

2017
01:19:45,199 --> 01:19:46,880
has multiple different animations for

2018
01:19:46,880 --> 01:19:49,040
the same character model and we will use

2019
01:19:49,040 --> 01:19:50,719
all of them in a minute

2020
01:19:50,719 --> 01:19:52,400
the second character is a different type

2021
01:19:52,400 --> 01:19:54,560
of angler fish with more gears and

2022
01:19:54,560 --> 01:19:55,679
chimney

2023
01:19:55,679 --> 01:19:57,360
these are steampunk machines that come

2024
01:19:57,360 --> 01:19:59,520
to life i gave them a lot of mechanical

2025
01:19:59,520 --> 01:20:02,159
parts these two anglerfish enemies will

2026
01:20:02,159 --> 01:20:04,400
be just a simple basic enemy type that

2027
01:20:04,400 --> 01:20:06,719
comes at the player trying to eat it

2028
01:20:06,719 --> 01:20:08,400
they are not very resistant and they are

2029
01:20:08,400 --> 01:20:10,159
easy to deal with using our seahorse

2030
01:20:10,159 --> 01:20:12,800
sentinel lasers the only advantage they

2031
01:20:12,800 --> 01:20:14,560
have is that they can come in big

2032
01:20:14,560 --> 01:20:16,800
numbers sometimes to deal with that we

2033
01:20:16,800 --> 01:20:18,480
have to be smart and use our slowly

2034
01:20:18,480 --> 01:20:21,120
recharging ammo wisely we can use the

2035
01:20:21,120 --> 01:20:23,679
third enemy type to help us i call this

2036
01:20:23,679 --> 01:20:25,679
third enemy type luckyface because it

2037
01:20:25,679 --> 01:20:28,080
will be an enemy but also a power up at

2038
01:20:28,080 --> 01:20:30,320
the same time it will have two different

2039
01:20:30,320 --> 01:20:32,320
models different skins that we will use

2040
01:20:32,320 --> 01:20:34,480
randomly when we create a new one and

2041
01:20:34,480 --> 01:20:36,239
the way we use this enemy type to make

2042
01:20:36,239 --> 01:20:37,840
gameplay more interesting is that the

2043
01:20:37,840 --> 01:20:39,760
player can do two things when this enemy

2044
01:20:39,760 --> 01:20:42,000
appears we can shoot it for a lot of

2045
01:20:42,000 --> 01:20:44,159
score points or we can collide with it

2046
01:20:44,159 --> 01:20:46,320
to collect it as a power up it doesn't

2047
01:20:46,320 --> 01:20:48,320
have many life so players also have to

2048
01:20:48,320 --> 01:20:50,000
be careful not to destroy it

2049
01:20:50,000 --> 01:20:51,920
accidentally before they can collect it

2050
01:20:51,920 --> 01:20:54,560
and activate the power up the story is

2051
01:20:54,560 --> 01:20:56,640
that this is an overcharged fish and

2052
01:20:56,640 --> 01:20:58,320
when the sentinel sea horse collides

2053
01:20:58,320 --> 01:21:00,800
with it it absorbs its light and power

2054
01:21:00,800 --> 01:21:03,280
to activate its ultimate offensive mode

2055
01:21:03,280 --> 01:21:05,360
for a short period of time it will all

2056
01:21:05,360 --> 01:21:07,280
be represented by graphics to make it

2057
01:21:07,280 --> 01:21:09,440
clear to the user what's happening so

2058
01:21:09,440 --> 01:21:11,440
here is the parent anime class and here

2059
01:21:11,440 --> 01:21:13,520
we have a child angle 1 class that

2060
01:21:13,520 --> 01:21:16,640
extends it and inherits from it

2061
01:21:16,640 --> 01:21:19,120
i will add this.image property and i

2062
01:21:19,120 --> 01:21:20,719
point it towards the sprite sheet we

2063
01:21:20,719 --> 01:21:23,920
just included in index.html like this

2064
01:21:23,920 --> 01:21:26,159
we have three different animations that

2065
01:21:26,159 --> 01:21:28,320
loop and when we create a new angular

2066
01:21:28,320 --> 01:21:30,080
fish we will assign it one of these

2067
01:21:30,080 --> 01:21:32,640
three randomly by setting this dot frame

2068
01:21:32,640 --> 01:21:34,960
y property to a random number between

2069
01:21:34,960 --> 01:21:38,239
zero or one or two so mass at random

2070
01:21:38,239 --> 01:21:40,000
times three

2071
01:21:40,000 --> 01:21:43,840
wrapped in math floor

2072
01:21:44,480 --> 01:21:45,920
like this

2073
01:21:45,920 --> 01:21:47,520
right now we have these small red

2074
01:21:47,520 --> 01:21:49,760
rectangles representing each anglerfish

2075
01:21:49,760 --> 01:21:51,840
enemy same as i did with player i

2076
01:21:51,840 --> 01:21:54,000
replace fill rectangle with stroke

2077
01:21:54,000 --> 01:21:56,159
rectangle and i remove this fill style

2078
01:21:56,159 --> 01:21:58,880
declaration

2079
01:22:00,719 --> 01:22:02,639
and also this one

2080
01:22:02,639 --> 01:22:04,560
the draw enemy sprite sheet same as we

2081
01:22:04,560 --> 01:22:06,560
did with player sprite sheet i use

2082
01:22:06,560 --> 01:22:09,440
built-in canvas draw image method i pass

2083
01:22:09,440 --> 01:22:11,440
it image i want to draw so this dot

2084
01:22:11,440 --> 01:22:14,400
image from line 124

2085
01:22:14,400 --> 01:22:16,800
if i just pass it x and y coordinates it

2086
01:22:16,800 --> 01:22:18,560
will draw the entire big sprite sheet

2087
01:22:18,560 --> 01:22:21,360
with all frames and all rows i declare

2088
01:22:21,360 --> 01:22:23,280
frame x that will help us to navigate in

2089
01:22:23,280 --> 01:22:26,639
the spreadsheet horizontally

2090
01:22:26,639 --> 01:22:28,670
frame y will navigate vertically

2091
01:22:28,670 --> 01:22:31,280
[Music]

2092
01:22:31,280 --> 01:22:33,280
max frame will be the maximum horizontal

2093
01:22:33,280 --> 01:22:35,679
frame which is 37 for this particular

2094
01:22:35,679 --> 01:22:37,040
sprite sheet

2095
01:22:37,040 --> 01:22:39,360
i only want to draw enemy hitboxes when

2096
01:22:39,360 --> 01:22:41,760
debug mode is active so this line will

2097
01:22:41,760 --> 01:22:45,520
run only if this.game.debug is true

2098
01:22:45,520 --> 01:22:47,840
i want to draw them at the original full

2099
01:22:47,840 --> 01:22:50,000
size so i remove this temporary size

2100
01:22:50,000 --> 01:22:52,960
modifier we created earlier

2101
01:22:52,960 --> 01:22:54,960
if i pass a draw image method additional

2102
01:22:54,960 --> 01:22:56,719
width and height we will squeeze all

2103
01:22:56,719 --> 01:22:59,840
frames into an area of one frame

2104
01:22:59,840 --> 01:23:02,080
so i will add four more to define an

2105
01:23:02,080 --> 01:23:04,480
area i want to crop out same as we did

2106
01:23:04,480 --> 01:23:07,280
with the player so source x source y

2107
01:23:07,280 --> 01:23:09,920
source with and source height

2108
01:23:09,920 --> 01:23:12,639
so image i want to draw four arguments

2109
01:23:12,639 --> 01:23:14,880
for the area i want to crop out from the

2110
01:23:14,880 --> 01:23:17,280
source image and four arguments for

2111
01:23:17,280 --> 01:23:19,600
where to place that cropped out image on

2112
01:23:19,600 --> 01:23:21,440
destination canvas

2113
01:23:21,440 --> 01:23:23,679
source x will handle horizontal cycling

2114
01:23:23,679 --> 01:23:25,360
through the sprite sheet and it will be

2115
01:23:25,360 --> 01:23:28,880
frame x from line 106 times width from

2116
01:23:28,880 --> 01:23:31,920
line 124. we keep width property on a

2117
01:23:31,920 --> 01:23:33,600
subclass because it will be different

2118
01:23:33,600 --> 01:23:35,600
for each enemy type

2119
01:23:35,600 --> 01:23:38,800
source y will be frame y from 107

2120
01:23:38,800 --> 01:23:41,920
times height from line 125.

2121
01:23:41,920 --> 01:23:45,679
source width will be this.wave

2122
01:23:46,159 --> 01:23:49,040
source height is this.height

2123
01:23:49,040 --> 01:23:50,639
i'm giving you sprite sheets that are

2124
01:23:50,639 --> 01:23:52,480
already sized exactly as they will be

2125
01:23:52,480 --> 01:23:54,560
drawn in the game so we don't have to do

2126
01:23:54,560 --> 01:23:56,960
any scaling with code here it's simpler

2127
01:23:56,960 --> 01:23:58,639
and it's more performance efficient to

2128
01:23:58,639 --> 01:24:00,480
do it this way

2129
01:24:00,480 --> 01:24:02,080
the sprite animation itself will be

2130
01:24:02,080 --> 01:24:04,880
simply going between frame x0 and max

2131
01:24:04,880 --> 01:24:06,719
frame over and over

2132
01:24:06,719 --> 01:24:08,560
we will handle it here inside update

2133
01:24:08,560 --> 01:24:12,400
method if frame x from 106 is less than

2134
01:24:12,400 --> 01:24:15,920
max frame from line 108 increase frame x

2135
01:24:15,920 --> 01:24:20,320
by one else reset frame x back to zero

2136
01:24:20,320 --> 01:24:22,320
and we are animating our first enemy

2137
01:24:22,320 --> 01:24:24,960
type the final game will be wider i just

2138
01:24:24,960 --> 01:24:26,800
keep the game area smaller so that i can

2139
01:24:26,800 --> 01:24:30,800
show you everything on one screen

2140
01:24:30,800 --> 01:24:33,840
in style css i hide images with id angle

2141
01:24:33,840 --> 01:24:36,800
1 angle 2

2142
01:24:36,800 --> 01:24:37,560
and lucky

2143
01:24:37,560 --> 01:24:39,520
[Music]

2144
01:24:39,520 --> 01:24:42,159
i can set the game width to 700 pixels

2145
01:24:42,159 --> 01:24:44,560
so that the large enemies fit better

2146
01:24:44,560 --> 01:24:46,560
you can see that each enemy fish has

2147
01:24:46,560 --> 01:24:48,560
been randomly assigned one of the three

2148
01:24:48,560 --> 01:24:51,360
possible animations i prepared for you

2149
01:24:51,360 --> 01:24:53,920
it gives our game a nice variety

2150
01:24:53,920 --> 01:24:55,840
a needs to account for game scrolling

2151
01:24:55,840 --> 01:24:57,840
speed when calculating anime positions

2152
01:24:57,840 --> 01:25:00,000
so down here inside update method on

2153
01:25:00,000 --> 01:25:03,520
enemy class i say this dot x plus equals

2154
01:25:03,520 --> 01:25:06,040
this dot speed x minus

2155
01:25:06,040 --> 01:25:07,600
this.game.speed

2156
01:25:07,600 --> 01:25:09,760
this way we can have dynamic events that

2157
01:25:09,760 --> 01:25:11,600
change game speed and enemies will

2158
01:25:11,600 --> 01:25:13,199
always be correctly positioned in

2159
01:25:13,199 --> 01:25:16,910
relation to our scrolling game world

2160
01:25:16,910 --> 01:25:21,760
[Music]

2161
01:25:21,760 --> 01:25:24,000
let's add the second type of angularfish

2162
01:25:24,000 --> 01:25:26,320
i created for you i copy this child

2163
01:25:26,320 --> 01:25:28,320
class that extends the parent enemy

2164
01:25:28,320 --> 01:25:32,560
class and i call it angular 2.

2165
01:25:32,560 --> 01:25:35,760
width of a single frame is 213 pixels

2166
01:25:35,760 --> 01:25:40,600
and height is 165 pixels

2167
01:25:40,719 --> 01:25:42,719
for this anime model i created two

2168
01:25:42,719 --> 01:25:45,360
different animations so frame y can be

2169
01:25:45,360 --> 01:25:49,360
row 0 or row 1.

2170
01:25:49,360 --> 01:25:51,600
so now we have two different anime types

2171
01:25:51,600 --> 01:25:53,440
i want to have a simple functionality

2172
01:25:53,440 --> 01:25:55,360
where i say something like when you

2173
01:25:55,360 --> 01:25:58,400
create a new enemy in the game in 50 of

2174
01:25:58,400 --> 01:26:01,040
cases make that enemy angular 1

2175
01:26:01,040 --> 01:26:03,760
otherwise make it angular 2. we will

2176
01:26:03,760 --> 01:26:06,960
handle that logic inside add nme method

2177
01:26:06,960 --> 01:26:09,120
we will do it by rolling dice once every

2178
01:26:09,120 --> 01:26:11,440
time we create a new enemy so helper

2179
01:26:11,440 --> 01:26:13,600
variable i call randomize

2180
01:26:13,600 --> 01:26:17,120
is math.random math at random declared

2181
01:26:17,120 --> 01:26:18,880
like this will generate a random number

2182
01:26:18,880 --> 01:26:21,840
between 0 and 1. if that random number

2183
01:26:21,840 --> 01:26:25,199
is less than 0.5 create angular 1 enemy

2184
01:26:25,199 --> 01:26:27,520
type

2185
01:26:30,080 --> 01:26:34,840
else create angular 2.

2186
01:26:36,239 --> 01:26:39,120
up here on line 249 i increase game

2187
01:26:39,120 --> 01:26:41,520
limit to 15 seconds so we have some more

2188
01:26:41,520 --> 01:26:43,600
time to test everything before game over

2189
01:26:43,600 --> 01:26:45,600
is triggered immediately i can see the

2190
01:26:45,600 --> 01:26:47,920
new angular 2 enemy type

2191
01:26:47,920 --> 01:26:49,520
and i can see we are playing both

2192
01:26:49,520 --> 01:26:51,360
animations perfect

2193
01:26:51,360 --> 01:26:53,120
giving graphics like this for your game

2194
01:26:53,120 --> 01:26:54,800
will go a long way to help you create

2195
01:26:54,800 --> 01:26:56,639
unique stories and adventures for your

2196
01:26:56,639 --> 01:26:58,480
players if you are interested how to

2197
01:26:58,480 --> 01:27:00,880
take drawings of static characters and

2198
01:27:00,880 --> 01:27:02,560
turn them into animated sprite sheets

2199
01:27:02,560 --> 01:27:04,560
with free dragon bone software like i

2200
01:27:04,560 --> 01:27:06,480
did with this seahorse and angular for

2201
01:27:06,480 --> 01:27:08,880
this class let me know and i might make

2202
01:27:08,880 --> 01:27:10,320
a course on that

2203
01:27:10,320 --> 01:27:12,800
on enemy class i have this dot lives and

2204
01:27:12,800 --> 01:27:14,880
this dot score properties i want each

2205
01:27:14,880 --> 01:27:16,800
enemy to have different values here so i

2206
01:27:16,800 --> 01:27:19,840
cut it here and i paste it on each enemy

2207
01:27:19,840 --> 01:27:22,000
type individually

2208
01:27:22,000 --> 01:27:24,239
angular 1 will have 2 lives and when we

2209
01:27:24,239 --> 01:27:26,639
defeat it we will get 2 score points

2210
01:27:26,639 --> 01:27:28,800
angle 2 will have 3 lives and it will

2211
01:27:28,800 --> 01:27:31,440
give 3 score points quick test to see if

2212
01:27:31,440 --> 01:27:33,840
everything works i can see enemy lives

2213
01:27:33,840 --> 01:27:35,679
and it gives the correct amount of score

2214
01:27:35,679 --> 01:27:36,560
points

2215
01:27:36,560 --> 01:27:37,840
don't worry about the color of the

2216
01:27:37,840 --> 01:27:40,790
numbers right now we will fix that later

2217
01:27:40,790 --> 01:27:46,639
[Music]

2218
01:27:46,639 --> 01:27:48,880
let's create a third enemy type i copy

2219
01:27:48,880 --> 01:27:50,719
this code block and i will call this

2220
01:27:50,719 --> 01:27:54,719
subclass luckyfish for example

2221
01:27:55,600 --> 01:28:00,840
width will be 99 pixels and height 95.

2222
01:28:01,120 --> 01:28:03,600
this fish will have three lives and if

2223
01:28:03,600 --> 01:28:06,960
destroyed it will award 15 score points

2224
01:28:06,960 --> 01:28:09,360
i will give it a property i call type

2225
01:28:09,360 --> 01:28:11,520
and i will set it to lucky we will use

2226
01:28:11,520 --> 01:28:13,520
this to check which enemy type player

2227
01:28:13,520 --> 01:28:14,960
collided with

2228
01:28:14,960 --> 01:28:18,800
down on line 314 inside add anime method

2229
01:28:18,800 --> 01:28:21,280
i add another else if statement like

2230
01:28:21,280 --> 01:28:22,159
this

2231
01:28:22,159 --> 01:28:24,960
if random number is less than 0.3 we

2232
01:28:24,960 --> 01:28:27,520
create angular 1 else if it's less than

2233
01:28:27,520 --> 01:28:30,639
0.6 we create angular 2. when the random

2234
01:28:30,639 --> 01:28:33,280
value is between 0.6 and 1 we create

2235
01:28:33,280 --> 01:28:35,360
luckyfish using the new class we just

2236
01:28:35,360 --> 01:28:37,679
wrote

2237
01:28:38,000 --> 01:28:39,520
there's something strange happening with

2238
01:28:39,520 --> 01:28:41,920
the animation i go up to luckyfish class

2239
01:28:41,920 --> 01:28:43,840
to see what's wrong

2240
01:28:43,840 --> 01:28:46,480
i can see that on line 153 i need to

2241
01:28:46,480 --> 01:28:47,440
point

2242
01:28:47,440 --> 01:28:49,360
this dot image property to the correct

2243
01:28:49,360 --> 01:28:50,880
sprite sheet

2244
01:28:50,880 --> 01:28:52,400
and we are animating our special

2245
01:28:52,400 --> 01:28:54,080
luckyfish powerup

2246
01:28:54,080 --> 01:28:55,679
there are two models because the sprite

2247
01:28:55,679 --> 01:28:56,960
sheet has two rows and we are

2248
01:28:56,960 --> 01:28:58,800
randomizing vertical coordinate with

2249
01:28:58,800 --> 01:29:02,100
frame y here on line 154

2250
01:29:02,100 --> 01:29:07,600
[Music]

2251
01:29:07,600 --> 01:29:09,199
when the player collides with one of

2252
01:29:09,199 --> 01:29:11,520
these special overcharged fish it enters

2253
01:29:11,520 --> 01:29:14,400
a powerup mode let's write that code now

2254
01:29:14,400 --> 01:29:16,560
we start by declaring this.powerup

2255
01:29:16,560 --> 01:29:18,560
property on the player up here on line

2256
01:29:18,560 --> 01:29:22,560
65. initially i set it to false powerup

2257
01:29:22,560 --> 01:29:24,159
will last for a while and then the

2258
01:29:24,159 --> 01:29:26,480
player will go back to the normal state

2259
01:29:26,480 --> 01:29:28,719
so we will need another timer

2260
01:29:28,719 --> 01:29:30,880
we can use delta time for it

2261
01:29:30,880 --> 01:29:32,880
we will have two helper variables called

2262
01:29:32,880 --> 01:29:36,400
powerup timer and powerup limit powerup

2263
01:29:36,400 --> 01:29:38,560
timer will be count in milliseconds

2264
01:29:38,560 --> 01:29:40,719
when it reaches power up limit of 10 000

2265
01:29:40,719 --> 01:29:43,120
milliseconds 10 seconds powerup state

2266
01:29:43,120 --> 01:29:44,400
will end

2267
01:29:44,400 --> 01:29:46,320
we will handle that logic here in update

2268
01:29:46,320 --> 01:29:49,120
method on player class i say if this dot

2269
01:29:49,120 --> 01:29:52,400
power up from line 65 is true we enter

2270
01:29:52,400 --> 01:29:54,800
this code block

2271
01:29:54,800 --> 01:29:57,360
inside we check if powerup timer is more

2272
01:29:57,360 --> 01:30:00,400
than powerup limit

2273
01:30:03,840 --> 01:30:06,560
and if it is we set powerup timer back

2274
01:30:06,560 --> 01:30:09,120
to 0

2275
01:30:09,520 --> 01:30:12,639
and power up to false

2276
01:30:12,639 --> 01:30:14,639
we will also set player sprite sheet to

2277
01:30:14,639 --> 01:30:18,320
frame y 0 so normal default animation

2278
01:30:18,320 --> 01:30:20,880
else meaning power up is true and power

2279
01:30:20,880 --> 01:30:23,120
up timer is not yet higher than power up

2280
01:30:23,120 --> 01:30:25,840
limit the player is in power up mode and

2281
01:30:25,840 --> 01:30:28,080
powerup timer is counted in milliseconds

2282
01:30:28,080 --> 01:30:31,120
by adding delta time we calculated delta

2283
01:30:31,120 --> 01:30:33,199
time before inside the main animation

2284
01:30:33,199 --> 01:30:35,440
loop is the difference in milliseconds

2285
01:30:35,440 --> 01:30:37,600
between timestamp from previous and the

2286
01:30:37,600 --> 01:30:39,840
current loop we need to make sure update

2287
01:30:39,840 --> 01:30:42,080
method expects delta time as an argument

2288
01:30:42,080 --> 01:30:45,199
on line 69

2289
01:30:46,400 --> 01:30:48,560
and we pass it to this method inside

2290
01:30:48,560 --> 01:30:50,480
update method on the main game class

2291
01:30:50,480 --> 01:30:54,120
here on line 286

2292
01:30:57,360 --> 01:31:00,080
so we are counting timer and frame y is

2293
01:31:00,080 --> 01:31:02,400
on the second row so value is one we

2294
01:31:02,400 --> 01:31:04,400
come from zero that will give us a

2295
01:31:04,400 --> 01:31:06,480
special animation with light coming from

2296
01:31:06,480 --> 01:31:08,400
chest and eyes and also tail will

2297
01:31:08,400 --> 01:31:10,080
animate differently because while in

2298
01:31:10,080 --> 01:31:12,560
this state we will shoot two lasers one

2299
01:31:12,560 --> 01:31:14,719
from the nose and one from the tail at

2300
01:31:14,719 --> 01:31:16,960
the same time two lasers for the price

2301
01:31:16,960 --> 01:31:18,800
of one ammo

2302
01:31:18,800 --> 01:31:20,800
at the same time we will be recharging

2303
01:31:20,800 --> 01:31:23,840
ammo by 0.1 per frame and this will be

2304
01:31:23,840 --> 01:31:25,760
on top of the regular recharging speed

2305
01:31:25,760 --> 01:31:27,840
so ammo will be recharging very fast

2306
01:31:27,840 --> 01:31:31,040
while in power up mode so when powerup

2307
01:31:31,040 --> 01:31:33,760
is set to true we enter this code block

2308
01:31:33,760 --> 01:31:36,080
powerup timer is increasing by delta

2309
01:31:36,080 --> 01:31:38,239
time counting how many milliseconds we

2310
01:31:38,239 --> 01:31:41,120
are in powerup mode frame y is animating

2311
01:31:41,120 --> 01:31:43,760
special overcharged animation and ammo

2312
01:31:43,760 --> 01:31:45,600
is recharging fast

2313
01:31:45,600 --> 01:31:48,080
as soon as power up timer increases over

2314
01:31:48,080 --> 01:31:50,080
the value in power up limit which will

2315
01:31:50,080 --> 01:31:52,239
happen after 10 seconds 10 000

2316
01:31:52,239 --> 01:31:54,800
milliseconds we set power up timer back

2317
01:31:54,800 --> 01:31:58,719
to 0 we set power up to false and we set

2318
01:31:58,719 --> 01:32:00,800
animation rule back to normal regular

2319
01:32:00,800 --> 01:32:03,920
floating animation

2320
01:32:06,239 --> 01:32:08,639
inside update method on game class

2321
01:32:08,639 --> 01:32:10,239
in this area where we check for

2322
01:32:10,239 --> 01:32:12,239
collision between player and enemies we

2323
01:32:12,239 --> 01:32:14,480
check if type property on that enemy is

2324
01:32:14,480 --> 01:32:17,360
set to lucky

2325
01:32:23,679 --> 01:32:25,679
if it is we call a special method on the

2326
01:32:25,679 --> 01:32:28,719
player object called enter powerup we

2327
01:32:28,719 --> 01:32:31,360
will write it in a minute

2328
01:32:31,360 --> 01:32:33,520
else if we collided with another anime

2329
01:32:33,520 --> 01:32:36,159
that is not luckyfish we decrease score

2330
01:32:36,159 --> 01:32:38,960
by 1 as a penalty to the player this

2331
01:32:38,960 --> 01:32:40,480
will encourage player to collide with

2332
01:32:40,480 --> 01:32:42,800
power up fish and avoid regular enemies

2333
01:32:42,800 --> 01:32:46,400
to get maximum possible score

2334
01:32:48,159 --> 01:32:51,040
i go up to player class here on line 111

2335
01:32:51,040 --> 01:32:54,080
i create that method so enter power up

2336
01:32:54,080 --> 01:32:56,080
its job will be to set everything up

2337
01:32:56,080 --> 01:32:58,719
when player enters power up state

2338
01:32:58,719 --> 01:33:00,719
i could have used state design pattern

2339
01:33:00,719 --> 01:33:02,400
but we don't have that many player

2340
01:33:02,400 --> 01:33:04,960
states so we can do it simply like this

2341
01:33:04,960 --> 01:33:06,880
when we enter power up we set power

2342
01:33:06,880 --> 01:33:09,280
powerup timer back to zero in case we

2343
01:33:09,280 --> 01:33:11,760
collided with powerupfish while we are

2344
01:33:11,760 --> 01:33:13,679
already in powerup state this will make

2345
01:33:13,679 --> 01:33:15,840
sure the time resets and we get full 10

2346
01:33:15,840 --> 01:33:18,239
seconds from that second collision

2347
01:33:18,239 --> 01:33:20,719
we set powerup property on player object

2348
01:33:20,719 --> 01:33:23,440
to true we will also recharge the ammo

2349
01:33:23,440 --> 01:33:27,120
to its maximum possible value

2350
01:33:29,920 --> 01:33:32,639
i test it

2351
01:33:32,719 --> 01:33:34,719
i collide with our special overcharged

2352
01:33:34,719 --> 01:33:37,199
fish and player gets overcharged we are

2353
01:33:37,199 --> 01:33:39,440
in powerup mode and ammo is instantly

2354
01:33:39,440 --> 01:33:42,639
refilled and it's recharging very fast

2355
01:33:42,639 --> 01:33:45,679
perfect after 10 seconds power up ends

2356
01:33:45,679 --> 01:33:47,600
ammo stops recharging because we are

2357
01:33:47,600 --> 01:33:50,000
well over max ammo value and player

2358
01:33:50,000 --> 01:33:51,840
sprite sheet switched to the basic

2359
01:33:51,840 --> 01:33:53,440
floating animation

2360
01:33:53,440 --> 01:33:54,800
great

2361
01:33:54,800 --> 01:33:57,120
so when we are in powerup mode our

2362
01:33:57,120 --> 01:33:59,280
sentinel seahorse will shoot defensive

2363
01:33:59,280 --> 01:34:01,840
lasers from mouth and tail at the same

2364
01:34:01,840 --> 01:34:02,639
time

2365
01:34:02,639 --> 01:34:04,719
it's overflowing with energy and it can

2366
01:34:04,719 --> 01:34:07,199
shoot extra free projectiles from tail

2367
01:34:07,199 --> 01:34:10,000
every time it shoots one from the mouth

2368
01:34:10,000 --> 01:34:11,600
we can handle that functionality with

2369
01:34:11,600 --> 01:34:13,679
javascript very easily by declaring

2370
01:34:13,679 --> 01:34:16,400
additional method i call should bottom

2371
01:34:16,400 --> 01:34:18,480
in shoot top we handle shooting from the

2372
01:34:18,480 --> 01:34:20,719
mouth and shoot bottom we will handle

2373
01:34:20,719 --> 01:34:22,960
logic for tail lasers

2374
01:34:22,960 --> 01:34:25,360
so inside i check if ammo is more than

2375
01:34:25,360 --> 01:34:28,000
zero and we just push new projectile

2376
01:34:28,000 --> 01:34:32,040
into projectiles array

2377
01:34:33,280 --> 01:34:35,280
i adjust its horizontal and vertical

2378
01:34:35,280 --> 01:34:37,199
starting position because i want it to

2379
01:34:37,199 --> 01:34:39,440
be coming out from the tail

2380
01:34:39,440 --> 01:34:41,280
i will call this method from inside

2381
01:34:41,280 --> 01:34:43,760
shoot top like this while we are running

2382
01:34:43,760 --> 01:34:46,000
the code in shoot top we check if we are

2383
01:34:46,000 --> 01:34:48,960
in power up mode

2384
01:34:49,520 --> 01:34:51,920
and if we are we execute shoot bottom

2385
01:34:51,920 --> 01:34:54,639
method as well to add that extra free

2386
01:34:54,639 --> 01:34:56,320
projectile

2387
01:34:56,320 --> 01:34:58,719
i tested lasers are just coming out from

2388
01:34:58,719 --> 01:35:01,679
sears's mouth in basic floating state

2389
01:35:01,679 --> 01:35:03,600
if we collect the power up fish we enter

2390
01:35:03,600 --> 01:35:05,920
power up mode and both should stop and

2391
01:35:05,920 --> 01:35:08,000
shoot bottom methods are running we are

2392
01:35:08,000 --> 01:35:10,239
shooting two projectiles but it costs

2393
01:35:10,239 --> 01:35:12,320
only one ammo

2394
01:35:12,320 --> 01:35:14,080
getting overcharged makes the player

2395
01:35:14,080 --> 01:35:16,080
very powerful maybe we need some bigger

2396
01:35:16,080 --> 01:35:18,320
bulkier enemies so we get more challenge

2397
01:35:18,320 --> 01:35:20,320
i made two types of mechanical whales

2398
01:35:20,320 --> 01:35:22,320
for player to defeat probably you will

2399
01:35:22,320 --> 01:35:23,950
need these power apps to do so

2400
01:35:23,950 --> 01:35:25,360
[Music]

2401
01:35:25,360 --> 01:35:27,040
i want the projectiles to come from

2402
01:35:27,040 --> 01:35:28,719
behind the player we are drawing

2403
01:35:28,719 --> 01:35:30,719
projectiles inside a draw method on

2404
01:35:30,719 --> 01:35:33,120
player class if i want them to be drawn

2405
01:35:33,120 --> 01:35:35,040
behind i need to make sure we draw

2406
01:35:35,040 --> 01:35:38,159
projectiles first and the player second

2407
01:35:38,159 --> 01:35:40,639
like this

2408
01:35:41,360 --> 01:35:43,199
i want to make it even more visually

2409
01:35:43,199 --> 01:35:45,760
clear when powerup mode is active for

2410
01:35:45,760 --> 01:35:48,320
example i can make this ammo display up

2411
01:35:48,320 --> 01:35:51,440
here different color while in powerup we

2412
01:35:51,440 --> 01:35:53,679
draw all these ui elements in our custom

2413
01:35:53,679 --> 01:35:55,199
ui class

2414
01:35:55,199 --> 01:35:58,000
on line 243 before i draw all these

2415
01:35:58,000 --> 01:36:00,480
small rectangles representing ammo i

2416
01:36:00,480 --> 01:36:02,800
check if power up property on player

2417
01:36:02,800 --> 01:36:05,760
class is true if it is i set fill style

2418
01:36:05,760 --> 01:36:08,000
to a different color i want that color

2419
01:36:08,000 --> 01:36:09,920
to be similar to the glow effect we have

2420
01:36:09,920 --> 01:36:14,239
on our sprite sheets so maybe this

2421
01:36:15,760 --> 01:36:17,920
it works the problem is that it also

2422
01:36:17,920 --> 01:36:19,840
recolors the timer text because we

2423
01:36:19,840 --> 01:36:22,800
define fill style here we draw ammo and

2424
01:36:22,800 --> 01:36:24,480
then we draw the timer

2425
01:36:24,480 --> 01:36:26,239
i can keep drawing ammo at the same

2426
01:36:26,239 --> 01:36:28,400
coordinates in our game and i can move

2427
01:36:28,400 --> 01:36:30,250
this entire code block further down

2428
01:36:30,250 --> 01:36:33,319
[Music]

2429
01:36:33,600 --> 01:36:35,679
that way this white fill style will

2430
01:36:35,679 --> 01:36:38,239
apply to timer and the other color will

2431
01:36:38,239 --> 01:36:43,159
apply only to ammo like this

2432
01:36:51,360 --> 01:36:56,960
[Music]

2433
01:36:56,960 --> 01:36:58,719
instead of drawing a rectangle

2434
01:36:58,719 --> 01:37:01,040
representing a laser projectile we can

2435
01:37:01,040 --> 01:37:03,360
also use an image i bring it into the

2436
01:37:03,360 --> 01:37:06,000
project here in props section in index

2437
01:37:06,000 --> 01:37:08,560
html you can download it in the video

2438
01:37:08,560 --> 01:37:10,320
description or you can use your own

2439
01:37:10,320 --> 01:37:15,119
image i give it an id of projectile

2440
01:37:15,520 --> 01:37:17,679
i bring it into the project here on line

2441
01:37:17,679 --> 01:37:21,040
38 inside projectile class constructor

2442
01:37:21,040 --> 01:37:24,040
this dot image equals to

2443
01:37:24,040 --> 01:37:26,239
document.getelementbyid and i use the id

2444
01:37:26,239 --> 01:37:28,320
i just gave it so right now we are

2445
01:37:28,320 --> 01:37:30,320
drawing yellow rectangles representing

2446
01:37:30,320 --> 01:37:32,719
our projectiles i delete that and

2447
01:37:32,719 --> 01:37:34,960
instead i will use draw image method

2448
01:37:34,960 --> 01:37:36,960
this time it's simple because the image

2449
01:37:36,960 --> 01:37:39,840
is already the right size

2450
01:37:39,840 --> 01:37:42,159
i just give it three arguments the image

2451
01:37:42,159 --> 01:37:44,800
i want to draw and x and y coordinates

2452
01:37:44,800 --> 01:37:48,760
where to draw it on canvas

2453
01:37:49,119 --> 01:37:51,199
nice we are drawing images these

2454
01:37:51,199 --> 01:37:53,520
projectiles can also be animated either

2455
01:37:53,520 --> 01:37:55,679
using a special sprite sheet or all

2456
01:37:55,679 --> 01:37:57,679
different kinds of particle effects we

2457
01:37:57,679 --> 01:37:58,960
will use sprite sheet to animate

2458
01:37:58,960 --> 01:38:00,880
projectiles in a bonus section of this

2459
01:38:00,880 --> 01:38:01,960
course

2460
01:38:01,960 --> 01:38:07,679
[Music]

2461
01:38:07,679 --> 01:38:09,520
let's add a web font to make the text

2462
01:38:09,520 --> 01:38:10,960
look better

2463
01:38:10,960 --> 01:38:12,960
adding a font to a canvas game is very

2464
01:38:12,960 --> 01:38:15,280
simple i go to google phones and i

2465
01:38:15,280 --> 01:38:17,760
search for bangers i like this comic

2466
01:38:17,760 --> 01:38:19,280
book style

2467
01:38:19,280 --> 01:38:21,119
when you have your font you click select

2468
01:38:21,119 --> 01:38:23,440
your style here you can select multiple

2469
01:38:23,440 --> 01:38:25,760
different fonts like this if you want

2470
01:38:25,760 --> 01:38:27,679
then we go up here to view selected

2471
01:38:27,679 --> 01:38:29,440
families if you choose more than one

2472
01:38:29,440 --> 01:38:31,360
this code will be adjusted to contain

2473
01:38:31,360 --> 01:38:33,199
all of them as part of a single

2474
01:38:33,199 --> 01:38:35,440
declaration all we need to do to bring

2475
01:38:35,440 --> 01:38:37,600
the font to our project is to copy these

2476
01:38:37,600 --> 01:38:40,239
link tags and paste them up here in

2477
01:38:40,239 --> 01:38:43,360
index html ideally above the main css

2478
01:38:43,360 --> 01:38:45,199
style sheet to make sure the fonts are

2479
01:38:45,199 --> 01:38:47,280
available from there as the code gets

2480
01:38:47,280 --> 01:38:50,639
executed line by line from top to bottom

2481
01:38:50,639 --> 01:38:52,719
i go back to google phone's website and

2482
01:38:52,719 --> 01:38:55,119
here it also gives us a ready-made css

2483
01:38:55,119 --> 01:38:58,000
font family declaration i copy it and i

2484
01:38:58,000 --> 01:39:00,800
put it inside our style css file here on

2485
01:39:00,800 --> 01:39:03,679
canvas element

2486
01:39:03,840 --> 01:39:05,679
now my font is available so i go to

2487
01:39:05,679 --> 01:39:08,480
script js inside ui class i set this

2488
01:39:08,480 --> 01:39:10,400
custom font family property we wrote

2489
01:39:10,400 --> 01:39:13,119
before to bangers and now all the texts

2490
01:39:13,119 --> 01:39:16,080
drawn by ui class so score timer and

2491
01:39:16,080 --> 01:39:19,119
game over messages will use the new font

2492
01:39:19,119 --> 01:39:20,639
let's adjust the winning text to

2493
01:39:20,639 --> 01:39:22,800
something less boring i want to keep the

2494
01:39:22,800 --> 01:39:25,119
victorian steampunk explorer theme going

2495
01:39:25,119 --> 01:39:26,880
for this game so winning message will

2496
01:39:26,880 --> 01:39:30,159
say most wonders in big letters

2497
01:39:30,159 --> 01:39:32,480
and with an exclamation mark

2498
01:39:32,480 --> 01:39:35,199
secondary smaller message will say well

2499
01:39:35,199 --> 01:39:36,719
done explorer

2500
01:39:36,719 --> 01:39:38,719
for the losing message let's use another

2501
01:39:38,719 --> 01:39:41,199
old phrase i will say blazes with an

2502
01:39:41,199 --> 01:39:43,440
exclamation mark it's a word for when

2503
01:39:43,440 --> 01:39:46,960
something goes wrong in old english

2504
01:39:47,920 --> 01:39:50,960
secondary small message will say

2505
01:39:50,960 --> 01:39:53,600
get my repair kit and try again for

2506
01:39:53,600 --> 01:39:54,560
example

2507
01:39:54,560 --> 01:39:56,080
you can come up with your own messages

2508
01:39:56,080 --> 01:39:58,560
here if you want now i have my messages

2509
01:39:58,560 --> 01:40:00,719
in a new font so i can adjust the sizing

2510
01:40:00,719 --> 01:40:02,960
and spacing

2511
01:40:02,960 --> 01:40:04,719
i want the main message one to be much

2512
01:40:04,719 --> 01:40:09,280
bigger i try 150 pixels

2513
01:40:09,280 --> 01:40:11,440
well that's way too big we could also

2514
01:40:11,440 --> 01:40:13,520
adjust the text size to match the width

2515
01:40:13,520 --> 01:40:15,280
of canvas but let's keep it simple for

2516
01:40:15,280 --> 01:40:19,119
now and set it to 100 pixels

2517
01:40:20,960 --> 01:40:25,360
hm i think i will go with 70 pixels

2518
01:40:28,800 --> 01:40:30,239
i want the messages to be closer

2519
01:40:30,239 --> 01:40:32,480
together so instead of 40 pixels offset

2520
01:40:32,480 --> 01:40:37,000
i tried 20 for both of them

2521
01:40:40,560 --> 01:40:42,719
i'm happy with the spacing and font size

2522
01:40:42,719 --> 01:40:45,199
for now

2523
01:40:47,679 --> 01:40:49,040
i can see that we still have the

2524
01:40:49,040 --> 01:40:51,119
projectile image visible in the top left

2525
01:40:51,119 --> 01:40:53,040
corner of the browser window so install

2526
01:40:53,040 --> 01:40:56,000
css i set it to display none

2527
01:40:56,000 --> 01:40:57,679
we can also see the spacing of the

2528
01:40:57,679 --> 01:41:01,360
losing message now looks good

2529
01:41:02,000 --> 01:41:03,600
i would also like the little numbers

2530
01:41:03,600 --> 01:41:05,920
above each enemy that represent their

2531
01:41:05,920 --> 01:41:08,320
lives to be only visible when debug mode

2532
01:41:08,320 --> 01:41:10,880
is active to do that i go up to enemy

2533
01:41:10,880 --> 01:41:13,520
class and inside draw method i only want

2534
01:41:13,520 --> 01:41:15,920
to call that fill text method if debug

2535
01:41:15,920 --> 01:41:18,480
mode is active if debug property on the

2536
01:41:18,480 --> 01:41:22,159
main game object is true

2537
01:41:25,679 --> 01:41:28,560
let's test it

2538
01:41:31,360 --> 01:41:34,080
yes i can only see hitboxes and enemy

2539
01:41:34,080 --> 01:41:38,239
lives when in debug mode perfect

2540
01:41:39,040 --> 01:41:40,639
i want to make sure that player cannot

2541
01:41:40,639 --> 01:41:42,880
leave the screen right now if you press

2542
01:41:42,880 --> 01:41:44,960
up or down arrow for long enough player

2543
01:41:44,960 --> 01:41:47,040
will move completely off screen inside

2544
01:41:47,040 --> 01:41:48,800
update method on player class we will

2545
01:41:48,800 --> 01:41:52,239
handle vertical boundaries

2546
01:41:52,239 --> 01:41:54,320
let's start with the bottom boundary if

2547
01:41:54,320 --> 01:41:56,320
this dot y vertical position of the

2548
01:41:56,320 --> 01:41:58,560
player is more than the height of the

2549
01:41:58,560 --> 01:42:01,040
game minus the height of the player

2550
01:42:01,040 --> 01:42:02,639
meaning that the bottom edge of the

2551
01:42:02,639 --> 01:42:04,800
player is touching the bottom edge of

2552
01:42:04,800 --> 01:42:07,360
the game area make sure we cannot move

2553
01:42:07,360 --> 01:42:09,520
past this point

2554
01:42:09,520 --> 01:42:10,960
like this

2555
01:42:10,960 --> 01:42:12,639
i actually want the player to disappear

2556
01:42:12,639 --> 01:42:14,719
halfway so that it can avoid very big

2557
01:42:14,719 --> 01:42:17,040
dangerous enemies we will add soon i

2558
01:42:17,040 --> 01:42:18,560
will do that by multiplying player

2559
01:42:18,560 --> 01:42:22,080
height times 0.5 here and here now we

2560
01:42:22,080 --> 01:42:23,920
can move half the sea horse's body

2561
01:42:23,920 --> 01:42:26,159
outside the screen and then we hit the

2562
01:42:26,159 --> 01:42:28,400
boundary we just defined

2563
01:42:28,400 --> 01:42:29,920
i will do the same thing for the top

2564
01:42:29,920 --> 01:42:32,239
boundary else if player's current

2565
01:42:32,239 --> 01:42:34,960
vertical y coordinate is less than minus

2566
01:42:34,960 --> 01:42:38,080
player height times 0.5 meaning that the

2567
01:42:38,080 --> 01:42:40,560
top half of the seahorse is off screen

2568
01:42:40,560 --> 01:42:43,520
make sure it cannot move any further up

2569
01:42:43,520 --> 01:42:45,600
like this i test it

2570
01:42:45,600 --> 01:42:48,320
top boundary works

2571
01:42:48,320 --> 01:42:52,150
bottom boundary works perfect

2572
01:42:52,150 --> 01:42:57,199
[Music]

2573
01:42:57,199 --> 01:43:00,400
up on line 48 we have a particle class i

2574
01:43:00,400 --> 01:43:02,320
will use it to create broken parts

2575
01:43:02,320 --> 01:43:04,400
falling from enemies every time we hit

2576
01:43:04,400 --> 01:43:06,960
them and for a big spray of spare parts

2577
01:43:06,960 --> 01:43:09,280
when we completely destroy an enemy we

2578
01:43:09,280 --> 01:43:11,199
will also make those parts bounce from

2579
01:43:11,199 --> 01:43:13,360
the floor for a specific number of times

2580
01:43:13,360 --> 01:43:15,600
before they fall off screen particle

2581
01:43:15,600 --> 01:43:17,360
class constructor will need a reference

2582
01:43:17,360 --> 01:43:19,360
to the main game object start in

2583
01:43:19,360 --> 01:43:21,760
horizontal x coordinate and start in

2584
01:43:21,760 --> 01:43:24,320
vertical y coordinate i convert those

2585
01:43:24,320 --> 01:43:26,960
arguments into class properties as usual

2586
01:43:26,960 --> 01:43:28,800
we will use a sprite sheet with nine

2587
01:43:28,800 --> 01:43:31,199
images in a grid each particle object

2588
01:43:31,199 --> 01:43:33,040
will randomly choose one of these images

2589
01:43:33,040 --> 01:43:36,159
so that we have some variety

2590
01:43:36,159 --> 01:43:38,000
this dot image is documented to the

2591
01:43:38,000 --> 01:43:41,000
getelementbyid

2592
01:43:41,040 --> 01:43:44,400
and id will be gears

2593
01:43:44,400 --> 01:43:46,560
in index.html i bring it into the

2594
01:43:46,560 --> 01:43:49,840
project here in the props section id is

2595
01:43:49,840 --> 01:43:53,119
gears and file name is gears.png you can

2596
01:43:53,119 --> 01:43:54,800
download it in the project section as

2597
01:43:54,800 --> 01:43:57,199
usual

2598
01:43:58,320 --> 01:44:00,560
install css i hide it by giving it

2599
01:44:00,560 --> 01:44:03,360
display none

2600
01:44:04,639 --> 01:44:06,320
here we are referencing that image with

2601
01:44:06,320 --> 01:44:08,320
javascript i will need some helper

2602
01:44:08,320 --> 01:44:10,239
variables to navigate around the sprite

2603
01:44:10,239 --> 01:44:12,719
sheet each particle object each spare

2604
01:44:12,719 --> 01:44:14,719
part flying from the enemy will have a

2605
01:44:14,719 --> 01:44:17,040
random image assigned from these nine

2606
01:44:17,040 --> 01:44:19,360
available options frame x will be a

2607
01:44:19,360 --> 01:44:21,920
random number between 0 and 2 so column

2608
01:44:21,920 --> 01:44:25,520
0 or 1 or 2.

2609
01:44:26,000 --> 01:44:28,800
frame y will be the same so row 0 or 1

2610
01:44:28,800 --> 01:44:31,600
or 2. combination of frame x and frame y

2611
01:44:31,600 --> 01:44:33,440
value for each particle object will

2612
01:44:33,440 --> 01:44:35,440
point to a specific image in the grid

2613
01:44:35,440 --> 01:44:38,639
for example frame x2 frame y1 will be

2614
01:44:38,639 --> 01:44:39,760
here

2615
01:44:39,760 --> 01:44:41,520
sprite size will be the size of

2616
01:44:41,520 --> 01:44:43,760
individual frame in this case frames are

2617
01:44:43,760 --> 01:44:46,880
squares 50 x 50 pixels i want each

2618
01:44:46,880 --> 01:44:48,560
particle to have a different size when

2619
01:44:48,560 --> 01:44:50,480
drawn on canvas so we will create size

2620
01:44:50,480 --> 01:44:52,719
modifier and we will set it to be a

2621
01:44:52,719 --> 01:44:55,760
random number between 0.5 and 1. i will

2622
01:44:55,760 --> 01:44:58,000
set it to one number after decimal point

2623
01:44:58,000 --> 01:45:00,800
to reduce artifacts

2624
01:45:00,800 --> 01:45:04,400
so particle size will be sprite size

2625
01:45:04,400 --> 01:45:07,360
multiplied by size modifier to make sure

2626
01:45:07,360 --> 01:45:09,600
every particle is a different random

2627
01:45:09,600 --> 01:45:11,760
size when drawn on canvas

2628
01:45:11,760 --> 01:45:13,440
i want particles to fall in both

2629
01:45:13,440 --> 01:45:15,600
directions horizontally from the enemy

2630
01:45:15,600 --> 01:45:17,360
so speed x will be a random number

2631
01:45:17,360 --> 01:45:20,719
between -3 and plus 3. if it's minus it

2632
01:45:20,719 --> 01:45:22,800
will move to the left if it's plus value

2633
01:45:22,800 --> 01:45:24,080
it will move to the right on the

2634
01:45:24,080 --> 01:45:28,719
positive direction on horizontal x-axis

2635
01:45:28,960 --> 01:45:31,119
speed y vertical speed will be a random

2636
01:45:31,119 --> 01:45:34,800
number between 0 and -15 so particles

2637
01:45:34,800 --> 01:45:36,719
will always start moving upwards on the

2638
01:45:36,719 --> 01:45:38,480
negative direction on the vertical

2639
01:45:38,480 --> 01:45:40,719
y-axis before they start being pulled

2640
01:45:40,719 --> 01:45:43,440
down towards the ground by gravity

2641
01:45:43,440 --> 01:45:46,560
i set gravity to 0.5 let's see what kind

2642
01:45:46,560 --> 01:45:49,040
of curved movement we get we can adjust

2643
01:45:49,040 --> 01:45:50,239
it later

2644
01:45:50,239 --> 01:45:52,239
marked for deletion will initially be

2645
01:45:52,239 --> 01:45:54,639
false

2646
01:45:54,960 --> 01:45:57,199
i want the corks wheels and spare parts

2647
01:45:57,199 --> 01:45:59,360
to rotate as they fall so i will have an

2648
01:45:59,360 --> 01:46:01,920
angle property storing rotation angle

2649
01:46:01,920 --> 01:46:04,159
for each particle separately starting at

2650
01:46:04,159 --> 01:46:05,280
0

2651
01:46:05,280 --> 01:46:07,119
and the speed of that rotation will also

2652
01:46:07,119 --> 01:46:10,080
be randomized in this dot va property

2653
01:46:10,080 --> 01:46:12,880
velocity of angle rotation speed will be

2654
01:46:12,880 --> 01:46:15,679
random value between minus 0.1 and plus

2655
01:46:15,679 --> 01:46:20,080
0.1 radians per animation frame

2656
01:46:23,280 --> 01:46:24,960
in update method we will increase the

2657
01:46:24,960 --> 01:46:28,560
rotation angle by va

2658
01:46:28,560 --> 01:46:30,800
speed y will increase by gravity which

2659
01:46:30,800 --> 01:46:32,960
will give it a nice curve let's say the

2660
01:46:32,960 --> 01:46:34,719
particle will start moving upwards

2661
01:46:34,719 --> 01:46:37,760
because starting speed y is -15 as we

2662
01:46:37,760 --> 01:46:40,639
increase speed y by gravity from line 61

2663
01:46:40,639 --> 01:46:43,679
that -15 value goes closer to zero at

2664
01:46:43,679 --> 01:46:45,679
that point when it reaches zero it will

2665
01:46:45,679 --> 01:46:47,840
stop moving and it will be at its peak

2666
01:46:47,840 --> 01:46:50,400
height as speed y further increases by

2667
01:46:50,400 --> 01:46:52,960
gravity value into positive numbers it

2668
01:46:52,960 --> 01:46:55,840
increases by 0.5 per animation frame

2669
01:46:55,840 --> 01:46:58,000
that particle will start falling down

2670
01:46:58,000 --> 01:47:00,480
faster and faster until it disappears

2671
01:47:00,480 --> 01:47:02,719
below the bottom edge of canvas

2672
01:47:02,719 --> 01:47:05,199
this dot x minus equals speed x to move

2673
01:47:05,199 --> 01:47:07,199
particles horizontally

2674
01:47:07,199 --> 01:47:09,440
this dot y plus equals speed y to

2675
01:47:09,440 --> 01:47:11,199
actually apply that speed y value

2676
01:47:11,199 --> 01:47:13,280
affected by gravity to the vertical

2677
01:47:13,280 --> 01:47:16,320
coordinate of each particle

2678
01:47:16,320 --> 01:47:18,000
if the particle fell off screen

2679
01:47:18,000 --> 01:47:20,320
vertically so its y coordinate is more

2680
01:47:20,320 --> 01:47:22,159
than game height plus size of the

2681
01:47:22,159 --> 01:47:25,199
particle or if the game scrolled past

2682
01:47:25,199 --> 01:47:28,159
the particle so its x position is less

2683
01:47:28,159 --> 01:47:30,960
than zero minus particle size set its

2684
01:47:30,960 --> 01:47:34,400
marked variation property to

2685
01:47:34,840 --> 01:47:37,840
true draw method will take context as an

2686
01:47:37,840 --> 01:47:39,040
argument

2687
01:47:39,040 --> 01:47:40,880
we call draw image method

2688
01:47:40,880 --> 01:47:44,000
pass it the image we want to draw

2689
01:47:44,000 --> 01:47:45,840
and x y

2690
01:47:45,840 --> 01:47:47,679
width and height where to draw it on

2691
01:47:47,679 --> 01:47:49,760
canvas

2692
01:47:49,760 --> 01:47:51,600
since the particle image is a grid of

2693
01:47:51,600 --> 01:47:53,840
frames it's a sprite sheet we only want

2694
01:47:53,840 --> 01:47:55,920
to crop out one individual frame for

2695
01:47:55,920 --> 01:47:58,480
each particle object i will also need to

2696
01:47:58,480 --> 01:48:01,119
specify cropping position so source x

2697
01:48:01,119 --> 01:48:04,639
source y source width and source height

2698
01:48:04,639 --> 01:48:07,520
source x is this dot frame x from 954

2699
01:48:07,520 --> 01:48:12,480
times this dot sprite size from line 56

2700
01:48:12,639 --> 01:48:18,199
source y is frame y times sprite size

2701
01:48:18,480 --> 01:48:20,239
source width and source height will be

2702
01:48:20,239 --> 01:48:22,880
this dot sprite size like this we want

2703
01:48:22,880 --> 01:48:25,440
to crop out a frame 50 times 50 pixels

2704
01:48:25,440 --> 01:48:27,360
from the source sprite sheet

2705
01:48:27,360 --> 01:48:30,239
then we multiply that by size modifier

2706
01:48:30,239 --> 01:48:34,719
and we draw it at that scaled size

2707
01:48:35,280 --> 01:48:37,280
we will need an array that holds all

2708
01:48:37,280 --> 01:48:39,600
active particle objects i will create it

2709
01:48:39,600 --> 01:48:42,159
here as this.particles property on the

2710
01:48:42,159 --> 01:48:45,639
main game object

2711
01:48:48,000 --> 01:48:49,920
for each particle in that array we call

2712
01:48:49,920 --> 01:48:52,320
their update method like this

2713
01:48:52,320 --> 01:48:55,040
using es6 arrow function syntax to keep

2714
01:48:55,040 --> 01:48:57,920
the code cleaner

2715
01:48:59,040 --> 01:49:01,280
after that i call built-in filter method

2716
01:49:01,280 --> 01:49:03,360
on that array and i replace that

2717
01:49:03,360 --> 01:49:05,360
original array with a different one that

2718
01:49:05,360 --> 01:49:07,520
contains only particles that have marked

2719
01:49:07,520 --> 01:49:10,080
for deletion property set to false

2720
01:49:10,080 --> 01:49:11,600
all the particles with marked for

2721
01:49:11,600 --> 01:49:13,440
deletion properties set to true will be

2722
01:49:13,440 --> 01:49:15,840
removed

2723
01:49:17,360 --> 01:49:19,520
inside the draw method again we call for

2724
01:49:19,520 --> 01:49:22,159
each on each particle object we call its

2725
01:49:22,159 --> 01:49:24,719
draw method and we pass it context as an

2726
01:49:24,719 --> 01:49:25,920
argument

2727
01:49:25,920 --> 01:49:30,480
as it expects up here on line 73

2728
01:49:31,520 --> 01:49:33,520
we have our particle class ready we just

2729
01:49:33,520 --> 01:49:35,360
need to find a good place in our code to

2730
01:49:35,360 --> 01:49:38,000
add these particles i go down to update

2731
01:49:38,000 --> 01:49:40,320
method on game class and here where we

2732
01:49:40,320 --> 01:49:42,320
check for collisions between projectiles

2733
01:49:42,320 --> 01:49:46,080
and enemies i create a for loop

2734
01:49:46,080 --> 01:49:49,920
this for loop will run 10 times

2735
01:49:52,080 --> 01:49:54,239
and each time it runs it takes this dot

2736
01:49:54,239 --> 01:49:56,480
particles array and it will push new

2737
01:49:56,480 --> 01:49:58,560
particle object inside

2738
01:49:58,560 --> 01:50:00,639
i know that particle class constructor

2739
01:50:00,639 --> 01:50:02,480
expects a reference to the main game

2740
01:50:02,480 --> 01:50:04,800
object as the first argument so i pass

2741
01:50:04,800 --> 01:50:07,679
it this because right now in our code we

2742
01:50:07,679 --> 01:50:10,560
are inside that game object

2743
01:50:10,560 --> 01:50:12,960
each particle also needs starting x and

2744
01:50:12,960 --> 01:50:15,280
y coordinates so i pass it x and y of

2745
01:50:15,280 --> 01:50:16,960
the enemy that just collided with the

2746
01:50:16,960 --> 01:50:18,320
projectile

2747
01:50:18,320 --> 01:50:20,159
i don't want the particles to come from

2748
01:50:20,159 --> 01:50:22,159
the top left corner of each enemy i want

2749
01:50:22,159 --> 01:50:24,000
them to come from the middle so i add

2750
01:50:24,000 --> 01:50:27,360
enemy width times 0.5 horizontally and

2751
01:50:27,360 --> 01:50:31,840
enemy height times 0.5 vertically

2752
01:50:34,639 --> 01:50:36,400
i copy this for loop

2753
01:50:36,400 --> 01:50:38,560
i actually want 10 particle spare parts

2754
01:50:38,560 --> 01:50:40,400
to fall from the enemy when it collides

2755
01:50:40,400 --> 01:50:44,400
with the player and gets destroyed

2756
01:50:46,400 --> 01:50:48,639
down here i remove the for loop and just

2757
01:50:48,639 --> 01:50:50,560
push one particle

2758
01:50:50,560 --> 01:50:53,840
i test it

2759
01:50:55,600 --> 01:50:57,600
nice we have a splash of spare parts

2760
01:50:57,600 --> 01:50:59,040
coming out of anime when they are

2761
01:50:59,040 --> 01:51:01,520
destroyed by colliding with the player

2762
01:51:01,520 --> 01:51:03,360
player in this game is indestructible we

2763
01:51:03,360 --> 01:51:04,800
will make that clear by giving it a

2764
01:51:04,800 --> 01:51:06,639
special animated shield later in the

2765
01:51:06,639 --> 01:51:09,199
bonus section

2766
01:51:09,199 --> 01:51:11,199
i copy this code that adds just one

2767
01:51:11,199 --> 01:51:13,199
particle and i actually want to put it

2768
01:51:13,199 --> 01:51:15,199
here so that every time projectile

2769
01:51:15,199 --> 01:51:17,679
collides with enemy one particle follows

2770
01:51:17,679 --> 01:51:18,960
out

2771
01:51:18,960 --> 01:51:21,040
nice so now every time enemy gets hit by

2772
01:51:21,040 --> 01:51:23,360
a projectile one particle spare part

2773
01:51:23,360 --> 01:51:24,239
falls

2774
01:51:24,239 --> 01:51:26,159
if enemy is destroyed by colliding with

2775
01:51:26,159 --> 01:51:28,400
the player 10 particles come out in all

2776
01:51:28,400 --> 01:51:30,880
directions

2777
01:51:30,880 --> 01:51:32,639
i want the particles to bounce off the

2778
01:51:32,639 --> 01:51:34,560
floor for a specific number of times

2779
01:51:34,560 --> 01:51:36,719
before they fall off screen to make this

2780
01:51:36,719 --> 01:51:38,560
effect even more intense

2781
01:51:38,560 --> 01:51:40,800
i go up to our particle class and here

2782
01:51:40,800 --> 01:51:44,560
on line 65 i create a helper variable

2783
01:51:44,560 --> 01:51:47,199
i call it bounced and initially i set it

2784
01:51:47,199 --> 01:51:48,800
to false

2785
01:51:48,800 --> 01:51:51,199
i also want to define a margin from the

2786
01:51:51,199 --> 01:51:53,280
bottom end of canvas from which point

2787
01:51:53,280 --> 01:51:55,840
the particles will bounce so i call it

2788
01:51:55,840 --> 01:51:59,440
for example bottom bound boundary

2789
01:51:59,440 --> 01:52:02,800
like this and i set it to 100 pixels if

2790
01:52:02,800 --> 01:52:04,960
particle reaches this point i want it to

2791
01:52:04,960 --> 01:52:07,119
bounce so i will switch its speed y

2792
01:52:07,119 --> 01:52:10,719
value to its opposite

2793
01:52:11,119 --> 01:52:13,280
if vertical position of the particle is

2794
01:52:13,280 --> 01:52:15,920
more than game height minus bottom bound

2795
01:52:15,920 --> 01:52:20,080
boundary so somewhere around this point

2796
01:52:20,080 --> 01:52:22,239
and at the same time if this dot bounce

2797
01:52:22,239 --> 01:52:25,599
from line 65 is false

2798
01:52:25,599 --> 01:52:27,920
set bounced to true so that it doesn't

2799
01:52:27,920 --> 01:52:31,119
bounce again after this and set speed y

2800
01:52:31,119 --> 01:52:33,199
to its opposite value by multiplying it

2801
01:52:33,199 --> 01:52:36,400
times 0.5

2802
01:52:39,280 --> 01:52:41,520
so particles fall in it reaches this

2803
01:52:41,520 --> 01:52:43,599
point and its current speed is for

2804
01:52:43,599 --> 01:52:46,560
example plus 5. we switch it to minus

2805
01:52:46,560 --> 01:52:49,280
2.5 making it bounce moving upwards

2806
01:52:49,280 --> 01:52:51,840
again still line 70 keeps applying

2807
01:52:51,840 --> 01:52:54,480
gravity so eventually we reach zero and

2808
01:52:54,480 --> 01:52:56,239
go into positive numbers making the

2809
01:52:56,239 --> 01:52:58,560
particle curve towards the ground again

2810
01:52:58,560 --> 01:53:00,719
and eventually fall off screen it

2811
01:53:00,719 --> 01:53:03,520
bounces once sets bounced to true so

2812
01:53:03,520 --> 01:53:05,599
this if statement check will fail for

2813
01:53:05,599 --> 01:53:07,760
the second bounce and particle will just

2814
01:53:07,760 --> 01:53:10,560
fall off screen

2815
01:53:11,360 --> 01:53:13,199
maybe i don't want particles to all

2816
01:53:13,199 --> 01:53:15,119
bounce from the same vertical point on

2817
01:53:15,119 --> 01:53:17,360
the ground how about they bounce from a

2818
01:53:17,360 --> 01:53:19,520
range between this and this point

2819
01:53:19,520 --> 01:53:22,639
roughly to match our ground level image

2820
01:53:22,639 --> 01:53:24,719
so bottom bounds boundary will be a

2821
01:53:24,719 --> 01:53:28,400
random value between 60 and 160 pixels

2822
01:53:28,400 --> 01:53:31,199
from the bottom edge of canvas area

2823
01:53:31,199 --> 01:53:33,360
what about if we want to specify how

2824
01:53:33,360 --> 01:53:35,760
many times each spare part bounces from

2825
01:53:35,760 --> 01:53:37,360
the ground rather than having them

2826
01:53:37,360 --> 01:53:39,280
bounce just once

2827
01:53:39,280 --> 01:53:42,239
line 65 i set the initial bounced

2828
01:53:42,239 --> 01:53:44,800
property to zero in this check on line

2829
01:53:44,800 --> 01:53:49,920
74 i check if bounced is less than two

2830
01:53:50,239 --> 01:53:52,400
and each time we bounce i increase

2831
01:53:52,400 --> 01:53:55,840
bounced by 1 here on line 75.

2832
01:53:55,840 --> 01:53:58,159
now each particle bounces twice before

2833
01:53:58,159 --> 01:54:01,800
it falls off screen

2834
01:54:21,040 --> 01:54:22,880
down here where we create particles i

2835
01:54:22,880 --> 01:54:24,719
copy this for loop that creates 10

2836
01:54:24,719 --> 01:54:25,920
particles

2837
01:54:25,920 --> 01:54:27,679
we create one particle when anime

2838
01:54:27,679 --> 01:54:30,000
collides with the projectile i paste

2839
01:54:30,000 --> 01:54:31,679
that for loop here to create 10

2840
01:54:31,679 --> 01:54:33,840
particles when enemy is destroyed by a

2841
01:54:33,840 --> 01:54:35,199
projectile

2842
01:54:35,199 --> 01:54:37,199
so particles will come out of enemies

2843
01:54:37,199 --> 01:54:39,360
after three different events when enemy

2844
01:54:39,360 --> 01:54:40,480
collides with the player and is

2845
01:54:40,480 --> 01:54:43,599
destroyed we get 10 particles

2846
01:54:43,599 --> 01:54:45,599
when projectile collides with an enemy

2847
01:54:45,599 --> 01:54:47,920
we get one particle

2848
01:54:47,920 --> 01:54:50,400
when enemy is destroyed by projectile we

2849
01:54:50,400 --> 01:54:52,320
get 10 particles

2850
01:54:52,320 --> 01:54:54,400
so we know how to create particles when

2851
01:54:54,400 --> 01:54:56,560
certain events happen in our game we

2852
01:54:56,560 --> 01:54:58,719
know how to bounce them off floor and we

2853
01:54:58,719 --> 01:55:00,800
know how to control how many times they

2854
01:55:00,800 --> 01:55:03,800
bounce

2855
01:55:04,680 --> 01:55:09,920
[Music]

2856
01:55:09,920 --> 01:55:12,080
we also have this angle property that is

2857
01:55:12,080 --> 01:55:15,440
increasing by va on line 69. if you've

2858
01:55:15,440 --> 01:55:17,679
never done rotation on canvas this part

2859
01:55:17,679 --> 01:55:19,360
might be a little bit challenging but i

2860
01:55:19,360 --> 01:55:21,760
will try to explain each particle has a

2861
01:55:21,760 --> 01:55:23,760
different angle value that's increasing

2862
01:55:23,760 --> 01:55:26,400
by va value that's also randomized for

2863
01:55:26,400 --> 01:55:29,040
each particle object it means that at

2864
01:55:29,040 --> 01:55:30,960
any point each particle is at a

2865
01:55:30,960 --> 01:55:33,199
different rotation their angles have

2866
01:55:33,199 --> 01:55:34,880
different values

2867
01:55:34,880 --> 01:55:36,960
to make sure that rotation angle only

2868
01:55:36,960 --> 01:55:39,040
affects one specific particle and

2869
01:55:39,040 --> 01:55:40,880
doesn't spill out and affect other

2870
01:55:40,880 --> 01:55:43,119
objects we draw on canvas i will wrap

2871
01:55:43,119 --> 01:55:45,520
the entire drawing code between save and

2872
01:55:45,520 --> 01:55:46,800
restore

2873
01:55:46,800 --> 01:55:48,960
save method takes note of the current

2874
01:55:48,960 --> 01:55:51,760
canvas state when we call restore later

2875
01:55:51,760 --> 01:55:53,360
that restore will look for its

2876
01:55:53,360 --> 01:55:56,320
associated save method and it will reset

2877
01:55:56,320 --> 01:55:58,719
all canvas settings back to that point

2878
01:55:58,719 --> 01:56:01,119
in time anything done between save and

2879
01:56:01,119 --> 01:56:03,440
restore will just affect the code the

2880
01:56:03,440 --> 01:56:06,080
drawing code in between after we call

2881
01:56:06,080 --> 01:56:08,159
restore everything will be reset to its

2882
01:56:08,159 --> 01:56:09,840
original state

2883
01:56:09,840 --> 01:56:12,000
to rotate something on canvas we first

2884
01:56:12,000 --> 01:56:14,320
have to move rotation center point the

2885
01:56:14,320 --> 01:56:16,000
point that is normally considered

2886
01:56:16,000 --> 01:56:18,800
coordinates 0 0 on canvas so the top

2887
01:56:18,800 --> 01:56:21,040
left corner we have to translate that

2888
01:56:21,040 --> 01:56:23,920
point over the object we are rotating so

2889
01:56:23,920 --> 01:56:26,080
translate to the current x and y

2890
01:56:26,080 --> 01:56:28,400
position of the particle

2891
01:56:28,400 --> 01:56:30,239
calling translate like this moved

2892
01:56:30,239 --> 01:56:32,159
rotation center point from top left

2893
01:56:32,159 --> 01:56:34,560
corner to this dot x this dot y

2894
01:56:34,560 --> 01:56:36,719
coordinates of this particle

2895
01:56:36,719 --> 01:56:39,040
then we call built in rotate method that

2896
01:56:39,040 --> 01:56:42,000
takes angle value in radians i pass it

2897
01:56:42,000 --> 01:56:43,920
the angle property that is increasing

2898
01:56:43,920 --> 01:56:46,400
for every animation frame by va here on

2899
01:56:46,400 --> 01:56:48,159
line 69.

2900
01:56:48,159 --> 01:56:50,000
not sure if you can see but particles

2901
01:56:50,000 --> 01:56:52,159
are currently making very large circles

2902
01:56:52,159 --> 01:56:54,400
around their x and y coordinates it is

2903
01:56:54,400 --> 01:56:56,480
because we are going to another distance

2904
01:56:56,480 --> 01:56:59,040
of x and y from these coordinates

2905
01:56:59,040 --> 01:57:01,280
because of the fact that we translated

2906
01:57:01,280 --> 01:57:03,599
point zero zero and rotation center

2907
01:57:03,599 --> 01:57:05,679
point to these coordinates for all

2908
01:57:05,679 --> 01:57:08,159
intents and purposes this dot x and this

2909
01:57:08,159 --> 01:57:10,560
dot y between the save and restore in

2910
01:57:10,560 --> 01:57:12,800
this area of our code is considered

2911
01:57:12,800 --> 01:57:15,440
point zero zero on canvas and then i'm

2912
01:57:15,440 --> 01:57:17,520
drawing this particle at this dot x this

2913
01:57:17,520 --> 01:57:20,000
dot y from that translated point

2914
01:57:20,000 --> 01:57:22,400
further and i'm rotating it making it go

2915
01:57:22,400 --> 01:57:24,400
in larger circles around that center

2916
01:57:24,400 --> 01:57:27,520
point i fix it by changing x and y to

2917
01:57:27,520 --> 01:57:29,760
zero here

2918
01:57:29,760 --> 01:57:31,840
because position of that particle is

2919
01:57:31,840 --> 01:57:34,560
already defined on line 81 in translate

2920
01:57:34,560 --> 01:57:37,560
call

2921
01:57:40,560 --> 01:57:42,320
now the particles are rotating from

2922
01:57:42,320 --> 01:57:44,560
their top left corner so i shift them a

2923
01:57:44,560 --> 01:57:46,719
little bit by half of their width

2924
01:57:46,719 --> 01:57:48,719
and half of their height to rotate

2925
01:57:48,719 --> 01:57:53,080
around the center point of each particle

2926
01:57:54,560 --> 01:57:56,639
i have other classes about rotation for

2927
01:57:56,639 --> 01:57:58,159
now let's just move on if you don't

2928
01:57:58,159 --> 01:57:59,679
fully understand some things about

2929
01:57:59,679 --> 01:58:01,760
rotation don't worry it will become more

2930
01:58:01,760 --> 01:58:03,360
clear as you use these techniques more

2931
01:58:03,360 --> 01:58:05,520
often in the future we are getting a lot

2932
01:58:05,520 --> 01:58:07,520
of particles now if you are on a very

2933
01:58:07,520 --> 01:58:09,440
old computer you can reduce the amounts

2934
01:58:09,440 --> 01:58:11,760
of particles to get better performance i

2935
01:58:11,760 --> 01:58:13,360
don't have any performance issues on my

2936
01:58:13,360 --> 01:58:15,440
computer let me know if it runs smoothly

2937
01:58:15,440 --> 01:58:17,199
for you or if you had to decrease the

2938
01:58:17,199 --> 01:58:18,960
number of particles to get a good frame

2939
01:58:18,960 --> 01:58:21,840
rate

2940
01:58:22,560 --> 01:58:24,400
the particles don't move correctly in

2941
01:58:24,400 --> 01:58:26,639
relation to the ground artwork i need to

2942
01:58:26,639 --> 01:58:29,040
go here and include the game's scrolling

2943
01:58:29,040 --> 01:58:30,880
speed in the horizontal position

2944
01:58:30,880 --> 01:58:33,880
calculation

2945
01:58:36,480 --> 01:58:39,920
so this actually has to be plus

2946
01:58:42,800 --> 01:58:46,840
yes now it works awesome

2947
01:58:48,100 --> 01:58:53,840
[Music]

2948
01:58:53,840 --> 01:58:56,080
time for a small cleanup first of all i

2949
01:58:56,080 --> 01:58:58,239
want the debug mode to be disabled by

2950
01:58:58,239 --> 01:59:00,719
default we can still press letter d on

2951
01:59:00,719 --> 01:59:02,960
keyboard to toggle it on and off but

2952
01:59:02,960 --> 01:59:05,040
when the game first loads i want player

2953
01:59:05,040 --> 01:59:07,520
and enemy hitboxes and enemy lives to be

2954
01:59:07,520 --> 01:59:09,599
hidden by default

2955
01:59:09,599 --> 01:59:11,440
we have a bug in our game when the

2956
01:59:11,440 --> 01:59:13,599
player collides with any enemy type it

2957
01:59:13,599 --> 01:59:15,520
goes into a power up mode that would

2958
01:59:15,520 --> 01:59:17,840
make the game too easy we only want the

2959
01:59:17,840 --> 01:59:19,360
player to enter power up when it

2960
01:59:19,360 --> 01:59:21,840
collides with power up fish and later in

2961
01:59:21,840 --> 01:59:23,599
the bonus section there will be another

2962
01:59:23,599 --> 01:59:25,760
way to enter power up for skilled and

2963
01:59:25,760 --> 01:59:28,000
fast players who can shoot fast and big

2964
01:59:28,000 --> 01:59:31,040
moonfish before it comes too close

2965
01:59:31,040 --> 01:59:32,560
to make sure the power up works

2966
01:59:32,560 --> 01:59:34,320
correctly i just need to fix this

2967
01:59:34,320 --> 01:59:37,920
comparison operator on line 357

2968
01:59:37,920 --> 01:59:39,040
like this

2969
01:59:39,040 --> 01:59:41,280
now our sentinel sea horse only enters

2970
01:59:41,280 --> 01:59:45,119
power up if it collides with lucky fish

2971
01:59:45,119 --> 01:59:47,360
another bug is when we enter power up

2972
01:59:47,360 --> 01:59:49,040
player's ammo gets automatically

2973
01:59:49,040 --> 01:59:51,520
assigned to max ammo this is meant to

2974
01:59:51,520 --> 01:59:53,760
refill the ammo but if the player saved

2975
01:59:53,760 --> 01:59:55,840
up and has current ammo higher than

2976
01:59:55,840 --> 01:59:58,239
maximum ammo entering power up will

2977
01:59:58,239 --> 02:00:00,560
actually reduce the total amount of ammo

2978
02:00:00,560 --> 02:00:04,000
they have i fix it here on line 159

2979
02:00:04,000 --> 02:00:06,159
inside enter power up method on the

2980
02:00:06,159 --> 02:00:08,960
player class we only refill ammo to max

2981
02:00:08,960 --> 02:00:11,119
ammo if the current ammo is less than

2982
02:00:11,119 --> 02:00:13,840
max ammo

2983
02:00:14,480 --> 02:00:16,960
like this

2984
02:00:19,679 --> 02:00:20,960
that works

2985
02:00:20,960 --> 02:00:23,119
i'm using vs code editor when i press

2986
02:00:23,119 --> 02:00:24,080
ctrl

2987
02:00:24,080 --> 02:00:26,560
f i can look for all console logs i want

2988
02:00:26,560 --> 02:00:28,560
to delete them let's keep our code and

2989
02:00:28,560 --> 02:00:30,320
console clean

2990
02:00:30,320 --> 02:00:32,080
particle spare parts falling from the

2991
02:00:32,080 --> 02:00:33,599
enemies are not bouncing from the

2992
02:00:33,599 --> 02:00:35,679
correct area i want the bounce area

2993
02:00:35,679 --> 02:00:37,840
range to match the ground artwork a bit

2994
02:00:37,840 --> 02:00:40,880
closer here on line 66 inside particle

2995
02:00:40,880 --> 02:00:43,199
class constructor i set bottom bounds

2996
02:00:43,199 --> 02:00:46,880
boundary to a range between 60 and 140

2997
02:00:46,880 --> 02:00:49,360
pixels

2998
02:00:50,080 --> 02:00:51,840
i want to change the order in which we

2999
02:00:51,840 --> 02:00:53,840
draw our game elements because we are

3000
02:00:53,840 --> 02:00:55,520
drawing everything on a single canvas

3001
02:00:55,520 --> 02:00:57,520
element the order in which we call draw

3002
02:00:57,520 --> 02:00:59,920
methods will determine what is behind

3003
02:00:59,920 --> 02:01:01,599
and what's on top

3004
02:01:01,599 --> 02:01:03,599
i go down here inside the main draw

3005
02:01:03,599 --> 02:01:06,080
method on game class and i want to draw

3006
02:01:06,080 --> 02:01:09,840
the background first then ui elements so

3007
02:01:09,840 --> 02:01:13,040
score ammo timer and game over messages

3008
02:01:13,040 --> 02:01:14,960
then we draw player projectiles

3009
02:01:14,960 --> 02:01:17,520
particles and enemies on top of that you

3010
02:01:17,520 --> 02:01:19,360
can play with the draw order here if you

3011
02:01:19,360 --> 02:01:21,199
want if you want ui to be on top of

3012
02:01:21,199 --> 02:01:23,679
everything for example just draw it last

3013
02:01:23,679 --> 02:01:25,199
i think it looks better like this

3014
02:01:25,199 --> 02:01:28,159
because it's a bit 3d or 2 and a half d

3015
02:01:28,159 --> 02:01:30,080
when it's slotted between the game world

3016
02:01:30,080 --> 02:01:32,080
and game characters like this we can do

3017
02:01:32,080 --> 02:01:34,000
many other things to make the ui feel

3018
02:01:34,000 --> 02:01:35,760
like a part of the game world i have

3019
02:01:35,760 --> 02:01:37,760
lots of ideas maybe in the next class

3020
02:01:37,760 --> 02:01:39,440
i'll show you more game text can be

3021
02:01:39,440 --> 02:01:41,760
floating moving changing colors it's

3022
02:01:41,760 --> 02:01:43,360
easy to do it if you follow my other

3023
02:01:43,360 --> 02:01:44,960
coding tutorials and you understand

3024
02:01:44,960 --> 02:01:48,920
canvas animation well

3025
02:01:52,480 --> 02:01:54,239
we have a power up mode so the game

3026
02:01:54,239 --> 02:01:56,400
currently is very easy when we are in

3027
02:01:56,400 --> 02:01:58,719
power up enemies have no chance let's

3028
02:01:58,719 --> 02:02:00,639
add a massive enemy type that when

3029
02:02:00,639 --> 02:02:02,800
defeated splits into five smaller

3030
02:02:02,800 --> 02:02:04,719
enemies that should give the player some

3031
02:02:04,719 --> 02:02:06,800
challenge hope you like teeth and

3032
02:02:06,800 --> 02:02:07,920
tentacles

3033
02:02:07,920 --> 02:02:09,760
it will also introduce some tactical

3034
02:02:09,760 --> 02:02:12,159
decisions into the game maybe sometimes

3035
02:02:12,159 --> 02:02:13,599
it's better to avoid the enemy

3036
02:02:13,599 --> 02:02:15,679
altogether if we are low on ammo when we

3037
02:02:15,679 --> 02:02:17,199
know we can't deal with the little

3038
02:02:17,199 --> 02:02:18,719
enemies that come out of it when we

3039
02:02:18,719 --> 02:02:20,800
destroy the big one

3040
02:02:20,800 --> 02:02:23,040
i copy luckyfish class that extends the

3041
02:02:23,040 --> 02:02:25,360
main parent enemy class

3042
02:02:25,360 --> 02:02:28,400
and i rename that copy hive whale this

3043
02:02:28,400 --> 02:02:30,159
is a massive mechanical whale that

3044
02:02:30,159 --> 02:02:32,480
serves the enemy swarm as a hive vessel

3045
02:02:32,480 --> 02:02:34,880
containing a lot of aggressive and fast

3046
02:02:34,880 --> 02:02:38,520
drones width is 400 pixels and height is

3047
02:02:38,520 --> 02:02:40,800
227 pixels

3048
02:02:40,800 --> 02:02:42,880
this dot image will be looking for an id

3049
02:02:42,880 --> 02:02:44,400
of hive whale

3050
02:02:44,400 --> 02:02:46,719
i need to go to index.html to bring that

3051
02:02:46,719 --> 02:02:48,880
spreadsheet into the project you can

3052
02:02:48,880 --> 02:02:51,040
download it in the project files section

3053
02:02:51,040 --> 02:02:52,880
i made just one animation row for this

3054
02:02:52,880 --> 02:02:54,880
anime type it's a lot of work animating

3055
02:02:54,880 --> 02:02:56,560
all these tentacles and creating this

3056
02:02:56,560 --> 02:02:58,800
sprite sheet and also it's already a big

3057
02:02:58,800 --> 02:03:01,679
image file image with an id of hive

3058
02:03:01,679 --> 02:03:04,480
whale and source is assets slash hive

3059
02:03:04,480 --> 02:03:06,480
whale png

3060
02:03:06,480 --> 02:03:08,800
in style css i give that image display

3061
02:03:08,800 --> 02:03:10,480
none

3062
02:03:10,480 --> 02:03:12,560
frame y will be zero because this sprite

3063
02:03:12,560 --> 02:03:16,080
sheet only has one animation row

3064
02:03:16,080 --> 02:03:18,480
it will have 15 lives it can take a lot

3065
02:03:18,480 --> 02:03:20,480
of damage when defeated it will give

3066
02:03:20,480 --> 02:03:23,520
player 15 score points

3067
02:03:23,520 --> 02:03:25,679
type is hive like this and it will move

3068
02:03:25,679 --> 02:03:27,840
very slow so here i will override the

3069
02:03:27,840 --> 02:03:30,159
default speed x property from the parent

3070
02:03:30,159 --> 02:03:32,560
enemy class and i set it to a random

3071
02:03:32,560 --> 02:03:36,080
number between minus 0.2 and minus 1.4

3072
02:03:36,080 --> 02:03:37,920
pixels per frame

3073
02:03:37,920 --> 02:03:39,679
i want the enemies to be spread a bit

3074
02:03:39,679 --> 02:03:41,840
more down not all the way to the bottom

3075
02:03:41,840 --> 02:03:44,239
of the game area but maybe 95 percent of

3076
02:03:44,239 --> 02:03:46,560
the game height i do it by replacing

3077
02:03:46,560 --> 02:03:48,480
this vertical position calculation on

3078
02:03:48,480 --> 02:03:51,599
angular 1 angular 2 luckyfish and hive

3079
02:03:51,599 --> 02:03:53,080
whale with

3080
02:03:53,080 --> 02:03:54,639
0.95

3081
02:03:54,639 --> 02:03:56,560
position where enemies can spawn in the

3082
02:03:56,560 --> 02:03:59,599
game can be anywhere between 0 and 95

3083
02:03:59,599 --> 02:04:01,679
percent of game height we need this

3084
02:04:01,679 --> 02:04:03,760
extra space there are some large enemies

3085
02:04:03,760 --> 02:04:06,320
incoming

3086
02:04:06,719 --> 02:04:08,880
we add hive whale into the project down

3087
02:04:08,880 --> 02:04:11,040
here inside add enemy method on the main

3088
02:04:11,040 --> 02:04:13,840
game class i copy this line and i say if

3089
02:04:13,840 --> 02:04:18,239
randomize is between 0.6 and 0.8 add new

3090
02:04:18,239 --> 02:04:22,280
hive whale enemy type

3091
02:04:25,280 --> 02:04:27,679
and here they come i can enable debug

3092
02:04:27,679 --> 02:04:29,599
mode by pressing letter d to see its

3093
02:04:29,599 --> 02:04:32,080
massive hitbox and its current lives we

3094
02:04:32,080 --> 02:04:33,599
need to hit the whale with 15

3095
02:04:33,599 --> 02:04:35,760
projectiles to destroy it but that's not

3096
02:04:35,760 --> 02:04:39,199
all when destroyed 5 smaller fast and

3097
02:04:39,199 --> 02:04:41,199
aggressive drones come out of it and

3098
02:04:41,199 --> 02:04:43,199
they will go straight for our sentinel

3099
02:04:43,199 --> 02:04:45,360
seahorse character let's create that

3100
02:04:45,360 --> 02:04:47,330
enemy type

3101
02:04:47,330 --> 02:04:54,560
[Music]

3102
02:04:54,560 --> 02:04:56,719
drones are small fast and aggressive

3103
02:04:56,719 --> 02:04:58,960
creatures they live inside hive wells

3104
02:04:58,960 --> 02:05:01,199
where they collect resources and feed on

3105
02:05:01,199 --> 02:05:03,440
whatever the hive will swallows let's

3106
02:05:03,440 --> 02:05:05,440
make sure that sentinel seahorse is not

3107
02:05:05,440 --> 02:05:07,199
their next meal

3108
02:05:07,199 --> 02:05:09,040
i copy this code block and i will name

3109
02:05:09,040 --> 02:05:11,760
it drone

3110
02:05:12,560 --> 02:05:14,400
this enemy type is different they are

3111
02:05:14,400 --> 02:05:16,320
ambush predators and they always hide

3112
02:05:16,320 --> 02:05:18,719
inside the hive whale ready to jump out

3113
02:05:18,719 --> 02:05:20,800
and attack their prey they will not be

3114
02:05:20,800 --> 02:05:22,480
coming at player from the right side of

3115
02:05:22,480 --> 02:05:24,639
the screen like the other enemy types do

3116
02:05:24,639 --> 02:05:26,560
we will only see them when we destroy a

3117
02:05:26,560 --> 02:05:28,719
hive whale for that reason when we

3118
02:05:28,719 --> 02:05:30,719
create a new drone using this class we

3119
02:05:30,719 --> 02:05:33,360
need to pass a game object as usual but

3120
02:05:33,360 --> 02:05:35,440
also we need to pass it the current x

3121
02:05:35,440 --> 02:05:37,440
and y position it will be the current

3122
02:05:37,440 --> 02:05:38,960
position of the hive while we just

3123
02:05:38,960 --> 02:05:41,599
destroyed

3124
02:05:41,599 --> 02:05:43,840
i convert x and y into class properties

3125
02:05:43,840 --> 02:05:47,480
as we always do

3126
02:05:48,320 --> 02:05:49,840
image will be looking for an element

3127
02:05:49,840 --> 02:05:53,280
with an id of a drone

3128
02:05:54,239 --> 02:05:56,000
i bring it into the project here in

3129
02:05:56,000 --> 02:05:59,360
index html id is a drone source is

3130
02:05:59,360 --> 02:06:00,320
assets

3131
02:06:00,320 --> 02:06:02,880
drone png i created two different

3132
02:06:02,880 --> 02:06:04,880
animation rows each one will be moving

3133
02:06:04,880 --> 02:06:07,599
differently so we get some variety

3134
02:06:07,599 --> 02:06:09,840
frame y will be a random number either

3135
02:06:09,840 --> 02:06:13,360
row 0 or row 1.

3136
02:06:13,360 --> 02:06:15,920
each drone will have 3 lives and will

3137
02:06:15,920 --> 02:06:18,000
award player with 3 score points if

3138
02:06:18,000 --> 02:06:20,800
destroyed i will give it type drone i'm

3139
02:06:20,800 --> 02:06:22,320
not sure if i will use this type

3140
02:06:22,320 --> 02:06:24,080
property for something but might as well

3141
02:06:24,080 --> 02:06:26,880
declare it we might need it later

3142
02:06:26,880 --> 02:06:28,960
this enemy can move very fast if it

3143
02:06:28,960 --> 02:06:31,119
wants to it will have a random speed

3144
02:06:31,119 --> 02:06:35,360
range from a minus 0.5 to minus 4.7

3145
02:06:35,360 --> 02:06:38,400
pixels per frame

3146
02:06:39,360 --> 02:06:41,440
the way i want this to work is when we

3147
02:06:41,440 --> 02:06:43,920
destroy hive whale with projectiles it

3148
02:06:43,920 --> 02:06:46,320
will spawn 5 drones

3149
02:06:46,320 --> 02:06:48,400
in star css i give the drone image

3150
02:06:48,400 --> 02:06:50,000
display none

3151
02:06:50,000 --> 02:06:51,760
if the hive whale gets destroyed by

3152
02:06:51,760 --> 02:06:53,360
colliding with the player there will be

3153
02:06:53,360 --> 02:06:55,920
no drones because the drones would spawn

3154
02:06:55,920 --> 02:06:57,679
too close to the player and there will

3155
02:06:57,679 --> 02:06:59,840
be no time to try and aim and target

3156
02:06:59,840 --> 02:07:01,599
them properly it would not be a good

3157
02:07:01,599 --> 02:07:03,679
gameplay experience having enemies spawn

3158
02:07:03,679 --> 02:07:06,800
so close to the player

3159
02:07:06,800 --> 02:07:09,199
if projectile collides with an enemy and

3160
02:07:09,199 --> 02:07:11,280
if lives of that enemy are less or equal

3161
02:07:11,280 --> 02:07:14,320
to zero that enemy is destroyed

3162
02:07:14,320 --> 02:07:16,159
we check if the enemy that was just

3163
02:07:16,159 --> 02:07:20,079
destroyed has type property set to hive

3164
02:07:20,079 --> 02:07:22,159
if it is a hive whale we take enemies

3165
02:07:22,159 --> 02:07:24,800
array and push one new drone enemy

3166
02:07:24,800 --> 02:07:27,440
object inside if you remember drone

3167
02:07:27,440 --> 02:07:30,159
class expects game and x and y position

3168
02:07:30,159 --> 02:07:32,639
were to appear in the game world i want

3169
02:07:32,639 --> 02:07:34,800
it to appear under the destroyed hive

3170
02:07:34,800 --> 02:07:36,639
whale so i pass it x and y of that

3171
02:07:36,639 --> 02:07:38,159
destroyed enemy

3172
02:07:38,159 --> 02:07:42,079
let's test it i destroy a hive whale and

3173
02:07:42,079 --> 02:07:45,440
we have one drone coming out of it nice

3174
02:07:45,440 --> 02:07:47,520
let's put this code into a for loop that

3175
02:07:47,520 --> 02:07:52,920
runs five times to create five drones

3176
02:07:59,679 --> 02:08:01,599
we have five drones but they all appear

3177
02:08:01,599 --> 02:08:03,199
on top of each other in the top left

3178
02:08:03,199 --> 02:08:05,040
corner of the hive whale that's not

3179
02:08:05,040 --> 02:08:09,119
ideal let's spread them around a bit

3180
02:08:09,119 --> 02:08:10,800
starting position of the drone will be

3181
02:08:10,800 --> 02:08:13,119
horizontal exposition of the hive whale

3182
02:08:13,119 --> 02:08:15,280
that was just destroyed plus a random

3183
02:08:15,280 --> 02:08:17,520
number between zero and the width of the

3184
02:08:17,520 --> 02:08:19,199
hive whale enemy

3185
02:08:19,199 --> 02:08:21,280
starting vertical position of each drone

3186
02:08:21,280 --> 02:08:23,280
will be vertical y position of the hive

3187
02:08:23,280 --> 02:08:26,159
well plus a random number between zero

3188
02:08:26,159 --> 02:08:30,480
and height of the hive whale like this

3189
02:08:35,040 --> 02:08:39,119
maybe just height times 0.5

3190
02:08:42,960 --> 02:08:45,520
nice now the drones are more spread out

3191
02:08:45,520 --> 02:08:48,000
some move very fast some move slower

3192
02:08:48,000 --> 02:08:49,599
this is good

3193
02:08:49,599 --> 02:08:51,679
we get too many particles i don't want

3194
02:08:51,679 --> 02:08:53,760
each drone to burst into 10 particles

3195
02:08:53,760 --> 02:08:55,760
when destroyed what if we make the

3196
02:08:55,760 --> 02:08:57,679
number of particles spare parts that

3197
02:08:57,679 --> 02:08:59,520
fall from enemies when destroyed to be

3198
02:08:59,520 --> 02:09:04,040
equal to the score that enemy gives

3199
02:09:05,840 --> 02:09:08,000
i also make the same change here on line

3200
02:09:08,000 --> 02:09:10,800
383 when enemies get destroyed by

3201
02:09:10,800 --> 02:09:13,280
colliding with the player

3202
02:09:13,280 --> 02:09:15,520
now hive whale should burst into 15

3203
02:09:15,520 --> 02:09:17,920
particles because when defeated it gives

3204
02:09:17,920 --> 02:09:19,599
15 score points

3205
02:09:19,599 --> 02:09:21,599
each drone will turn into three spare

3206
02:09:21,599 --> 02:09:23,840
parts that way we won't get a massive

3207
02:09:23,840 --> 02:09:25,920
flood of 50 cogs and wheels when we

3208
02:09:25,920 --> 02:09:29,719
destroy 5 drones

3209
02:09:30,380 --> 02:09:36,159
[Music]

3210
02:09:36,159 --> 02:09:37,679
i want the game to feel good when we

3211
02:09:37,679 --> 02:09:40,000
score some points and destroy an enemy i

3212
02:09:40,000 --> 02:09:42,079
want that enemy to really pop so not

3213
02:09:42,079 --> 02:09:44,159
only we will turn it into spare parts

3214
02:09:44,159 --> 02:09:46,159
that bounce around we will also play a

3215
02:09:46,159 --> 02:09:48,320
dust or fire explosion from a sprite

3216
02:09:48,320 --> 02:09:50,480
sheet i have two special sprite sheets

3217
02:09:50,480 --> 02:09:52,159
for this purpose you can take them and

3218
02:09:52,159 --> 02:09:53,840
use them in your other projects as well

3219
02:09:53,840 --> 02:09:56,000
if you want many games need dust and

3220
02:09:56,000 --> 02:09:58,159
fire effects like this all art assets

3221
02:09:58,159 --> 02:10:00,480
for this episode were custom made by me

3222
02:10:00,480 --> 02:10:02,719
or artists i hired so there is no

3223
02:10:02,719 --> 02:10:04,400
copyright you can use them however you

3224
02:10:04,400 --> 02:10:07,199
want enjoy

3225
02:10:07,280 --> 02:10:09,280
we will have the parent explosion class

3226
02:10:09,280 --> 02:10:11,280
and we will extend it into two child

3227
02:10:11,280 --> 02:10:14,239
classes dust explosion and fire

3228
02:10:14,239 --> 02:10:16,560
explosion parent explosion class will

3229
02:10:16,560 --> 02:10:18,639
contain methods and properties shared

3230
02:10:18,639 --> 02:10:21,199
for all explosion types it will expect

3231
02:10:21,199 --> 02:10:23,679
game x and y as arguments because i want

3232
02:10:23,679 --> 02:10:26,000
the animation to play over the enemy

3233
02:10:26,000 --> 02:10:28,400
that was just destroyed so that x and y

3234
02:10:28,400 --> 02:10:30,320
position will be passed from the outside

3235
02:10:30,320 --> 02:10:32,320
each time we create a new explosion

3236
02:10:32,320 --> 02:10:35,280
object both fire and smoke explosion

3237
02:10:35,280 --> 02:10:37,440
will be single row sprite sheets i could

3238
02:10:37,440 --> 02:10:39,040
also have placed them into a single

3239
02:10:39,040 --> 02:10:41,040
image we will cover compact sprite sheet

3240
02:10:41,040 --> 02:10:43,520
animation in later class not today i

3241
02:10:43,520 --> 02:10:45,520
will cycle through them from left to

3242
02:10:45,520 --> 02:10:50,239
right from frame x0 to max frame

3243
02:10:50,239 --> 02:10:52,000
sprite height is the height of a single

3244
02:10:52,000 --> 02:10:54,159
animation frame in the sprite sheet and

3245
02:10:54,159 --> 02:10:56,159
it will be the same for both explosion

3246
02:10:56,159 --> 02:10:57,119
types

3247
02:10:57,119 --> 02:10:58,719
i made both sprite sheets the same

3248
02:10:58,719 --> 02:11:01,119
height of 200 pixels so that property

3249
02:11:01,119 --> 02:11:03,040
can be on the parent class it's a

3250
02:11:03,040 --> 02:11:04,960
property shared between all explosion

3251
02:11:04,960 --> 02:11:05,920
types

3252
02:11:05,920 --> 02:11:07,679
sprite with the width of a single

3253
02:11:07,679 --> 02:11:09,280
animation frame in the sprite sheet will

3254
02:11:09,280 --> 02:11:11,199
be different for each type because of

3255
02:11:11,199 --> 02:11:13,119
that it will sit on each subclass

3256
02:11:13,119 --> 02:11:14,880
separately we will define that in a

3257
02:11:14,880 --> 02:11:16,000
minute

3258
02:11:16,000 --> 02:11:18,000
the sprite sheets have only 8 frames so

3259
02:11:18,000 --> 02:11:20,159
they will animate very fast i want us to

3260
02:11:20,159 --> 02:11:22,960
be able to control fps frames per second

3261
02:11:22,960 --> 02:11:25,599
on this animation and i want that fps to

3262
02:11:25,599 --> 02:11:27,679
be independent of animation speed of the

3263
02:11:27,679 --> 02:11:29,920
rest of the game we will do that using

3264
02:11:29,920 --> 02:11:32,000
delta time again and we will need 2

3265
02:11:32,000 --> 02:11:34,320
helper variables timer that will count

3266
02:11:34,320 --> 02:11:36,800
from 0 adding delta time over and over

3267
02:11:36,800 --> 02:11:39,280
until it reaches interval value when we

3268
02:11:39,280 --> 02:11:41,040
reach it we will serve the next

3269
02:11:41,040 --> 02:11:43,199
animation frame in the sprite sheet

3270
02:11:43,199 --> 02:11:45,520
interval will be 1000 milliseconds 1

3271
02:11:45,520 --> 02:11:48,320
second divided by 15 so the animation

3272
02:11:48,320 --> 02:11:51,599
will run at 15 fps i can also put frames

3273
02:11:51,599 --> 02:11:53,520
per second in a separate property if i

3274
02:11:53,520 --> 02:11:55,920
want to we can control fps by adjusting

3275
02:11:55,920 --> 02:11:58,320
that property instead

3276
02:11:58,320 --> 02:11:59,920
marked for deletion will be initially

3277
02:11:59,920 --> 02:12:03,119
set to false as usual

3278
02:12:03,119 --> 02:12:04,960
we will need update method and it will

3279
02:12:04,960 --> 02:12:07,280
expect delta time value as an argument

3280
02:12:07,280 --> 02:12:09,040
we calculate delta time in the main

3281
02:12:09,040 --> 02:12:11,599
animation loop draw method will expect

3282
02:12:11,599 --> 02:12:13,920
context as an argument to specify which

3283
02:12:13,920 --> 02:12:16,320
canvas element we want to draw on

3284
02:12:16,320 --> 02:12:18,079
update method will simply animate the

3285
02:12:18,079 --> 02:12:19,840
sprite sheet by increasing frame x

3286
02:12:19,840 --> 02:12:23,040
property from line 302

3287
02:12:23,040 --> 02:12:24,800
draw method will draw currently active

3288
02:12:24,800 --> 02:12:26,480
animation frame cropped out from the

3289
02:12:26,480 --> 02:12:28,560
sprite sheet let's start by just giving

3290
02:12:28,560 --> 02:12:30,880
it image we want to draw

3291
02:12:30,880 --> 02:12:35,040
and x and y coordinates where to draw it

3292
02:12:35,040 --> 02:12:37,520
so this is the parent explosion class it

3293
02:12:37,520 --> 02:12:39,760
contains properties and methods shared

3294
02:12:39,760 --> 02:12:42,320
between all explosion types we will have

3295
02:12:42,320 --> 02:12:45,280
two child classes smoke explosion and

3296
02:12:45,280 --> 02:12:48,000
fire explosion i say class smoke

3297
02:12:48,000 --> 02:12:51,280
explosion extends explosion that extends

3298
02:12:51,280 --> 02:12:53,440
keyword creates a relationship between

3299
02:12:53,440 --> 02:12:55,599
these two classes and it sets up

3300
02:12:55,599 --> 02:12:57,679
prototype-based inheritance behind the

3301
02:12:57,679 --> 02:13:00,320
scenes for us smoke explosion subclass

3302
02:13:00,320 --> 02:13:02,880
now has access to properties and methods

3303
02:13:02,880 --> 02:13:05,840
that sit on explosion super class we

3304
02:13:05,840 --> 02:13:08,800
will also have fire explosion subclass

3305
02:13:08,800 --> 02:13:11,599
constructor will expect game and x and y

3306
02:13:11,599 --> 02:13:14,320
coordinates in index html i bring the

3307
02:13:14,320 --> 02:13:16,480
sprite sheets into the project here in

3308
02:13:16,480 --> 02:13:19,520
the props section

3309
02:13:20,320 --> 02:13:24,239
ids will be smoke explosion

3310
02:13:26,480 --> 02:13:30,119
and fire explosion

3311
02:13:30,639 --> 02:13:33,199
install css we give both of them display

3312
02:13:33,199 --> 02:13:35,440
none

3313
02:13:38,719 --> 02:13:41,280
i point the subclass towards that image

3314
02:13:41,280 --> 02:13:43,360
using getelementbyid

3315
02:13:43,360 --> 02:13:45,440
i'm placing this.image property on the

3316
02:13:45,440 --> 02:13:47,760
subclass because that image is specific

3317
02:13:47,760 --> 02:13:50,719
only for this subclass parent superclass

3318
02:13:50,719 --> 02:13:52,719
contains only properties and methods

3319
02:13:52,719 --> 02:13:55,920
that are shared between all subclasses

3320
02:13:55,920 --> 02:13:58,000
sprite width the width of a single frame

3321
02:13:58,000 --> 02:13:59,920
will be 200 pixels

3322
02:13:59,920 --> 02:14:02,400
both sprite sheets have 8 frames so max

3323
02:14:02,400 --> 02:14:04,960
frame will be 8.

3324
02:14:04,960 --> 02:14:07,040
rectangles on canvas are drawn from the

3325
02:14:07,040 --> 02:14:09,199
top left corner i want the explosion

3326
02:14:09,199 --> 02:14:10,960
animation rectangle to be coming from

3327
02:14:10,960 --> 02:14:13,520
the exact center of the anime rectangle

3328
02:14:13,520 --> 02:14:15,599
i can do it like this i'm going to give

3329
02:14:15,599 --> 02:14:17,840
it width and height property and i set

3330
02:14:17,840 --> 02:14:20,560
it to be equal to sprite with and sprite

3331
02:14:20,560 --> 02:14:21,440
height

3332
02:14:21,440 --> 02:14:23,199
i take x and y properties from the

3333
02:14:23,199 --> 02:14:24,880
parent class and i place them on the

3334
02:14:24,880 --> 02:14:27,040
child class once we have a width

3335
02:14:27,040 --> 02:14:29,280
property here i offset x position by

3336
02:14:29,280 --> 02:14:31,280
half of its width moving its center

3337
02:14:31,280 --> 02:14:32,480
point to the middle of the image

3338
02:14:32,480 --> 02:14:34,560
horizontally i will also move the

3339
02:14:34,560 --> 02:14:36,800
vertical y position into the middle of

3340
02:14:36,800 --> 02:14:38,400
the image vertically

3341
02:14:38,400 --> 02:14:40,639
like this

3342
02:14:40,639 --> 02:14:42,719
down here inside game class constructor

3343
02:14:42,719 --> 02:14:44,800
i create an array that will hold all

3344
02:14:44,800 --> 02:14:48,880
currently active explosion objects

3345
02:14:50,880 --> 02:14:53,119
inside update method same as we do for

3346
02:14:53,119 --> 02:14:56,960
particles i will call for each

3347
02:14:58,320 --> 02:15:00,320
and for each explosion object in

3348
02:15:00,320 --> 02:15:02,320
explosions array i call its update

3349
02:15:02,320 --> 02:15:05,040
method we will also use filter method to

3350
02:15:05,040 --> 02:15:07,360
remove all explosion objects that have

3351
02:15:07,360 --> 02:15:09,119
marked for deletion properties set to

3352
02:15:09,119 --> 02:15:11,440
true

3353
02:15:12,880 --> 02:15:14,880
inside the draw method i call for each

3354
02:15:14,880 --> 02:15:17,360
on each explosion object again and i

3355
02:15:17,360 --> 02:15:20,079
draw them passing it context notice i

3356
02:15:20,079 --> 02:15:22,320
draw explosions after i draw enemies so

3357
02:15:22,320 --> 02:15:24,480
they will be drawn on top of enemies the

3358
02:15:24,480 --> 02:15:26,239
order in which we call draw methods here

3359
02:15:26,239 --> 02:15:28,400
matters we will have two different

3360
02:15:28,400 --> 02:15:30,639
explosion types so same as we did with

3361
02:15:30,639 --> 02:15:32,560
adding different types of enemies to the

3362
02:15:32,560 --> 02:15:34,800
game on the main game class i define a

3363
02:15:34,800 --> 02:15:37,920
custom method i call add explosion we

3364
02:15:37,920 --> 02:15:39,840
will have a variable that will randomize

3365
02:15:39,840 --> 02:15:42,960
a number between 0 and 1 like this if

3366
02:15:42,960 --> 02:15:45,199
that random number is less than 1 for

3367
02:15:45,199 --> 02:15:47,440
now

3368
02:15:49,040 --> 02:15:51,199
take this explosions array and push new

3369
02:15:51,199 --> 02:15:54,560
smoke explosion inside i pass it game so

3370
02:15:54,560 --> 02:15:56,880
this keyword it will also need a

3371
02:15:56,880 --> 02:15:58,719
position so we will take it from the

3372
02:15:58,719 --> 02:16:01,119
anime we just collided with we will add

3373
02:16:01,119 --> 02:16:03,119
a reference pointing to that entire

3374
02:16:03,119 --> 02:16:05,440
enemy object here as an argument

3375
02:16:05,440 --> 02:16:07,679
x and y of this explosion will be x and

3376
02:16:07,679 --> 02:16:10,159
y properties from that enemy object that

3377
02:16:10,159 --> 02:16:12,639
is passed here let's try to add it into

3378
02:16:12,639 --> 02:16:16,000
the game and see what we've got so far

3379
02:16:16,000 --> 02:16:19,040
up here on line 419 we check if player

3380
02:16:19,040 --> 02:16:21,440
collided with an enemy that enemy will

3381
02:16:21,440 --> 02:16:23,840
be destroyed and we want to animate an

3382
02:16:23,840 --> 02:16:26,159
explosion at that position so i will

3383
02:16:26,159 --> 02:16:29,199
call this dot at explosion like this i

3384
02:16:29,199 --> 02:16:31,440
pass it the enemy player just collided

3385
02:16:31,440 --> 02:16:34,559
with and destroyed as an argument

3386
02:16:34,559 --> 02:16:36,479
i also want the explosion animation to

3387
02:16:36,479 --> 02:16:38,080
play when we destroy enemy with

3388
02:16:38,080 --> 02:16:39,920
projectiles so here we check if

3389
02:16:39,920 --> 02:16:42,240
projectile collided with an enemy if

3390
02:16:42,240 --> 02:16:44,240
that enemy's lives are less or equal to

3391
02:16:44,240 --> 02:16:46,639
zero it will be destroyed and we animate

3392
02:16:46,639 --> 02:16:49,280
a splash of spare parts we set marked

3393
02:16:49,280 --> 02:16:51,200
for deletion on that animator true and

3394
02:16:51,200 --> 02:16:53,679
we will add explosion here as well like

3395
02:16:53,679 --> 02:16:55,920
this

3396
02:16:55,920 --> 02:16:57,519
i test it and we are getting no

3397
02:16:57,519 --> 02:16:59,439
explosion animations i don't see any

3398
02:16:59,439 --> 02:17:01,120
console errors

3399
02:17:01,120 --> 02:17:02,719
let's debug it by console login

3400
02:17:02,719 --> 02:17:04,559
explosions array from inside add

3401
02:17:04,559 --> 02:17:07,120
explosions method every time we add one

3402
02:17:07,120 --> 02:17:10,000
we consolidate the entire array

3403
02:17:10,000 --> 02:17:12,240
i can see that add explosion method runs

3404
02:17:12,240 --> 02:17:14,240
and creates the console log for us but

3405
02:17:14,240 --> 02:17:16,399
the array remains empty let's see what i

3406
02:17:16,399 --> 02:17:18,399
did wrong probably i made a typo

3407
02:17:18,399 --> 02:17:20,880
somewhere

3408
02:17:22,319 --> 02:17:24,800
oh i see this if statement never runs

3409
02:17:24,800 --> 02:17:26,960
because there is no this.randomized

3410
02:17:26,960 --> 02:17:29,679
property easy fix we need to refer to

3411
02:17:29,679 --> 02:17:34,000
this temporary helper variable like this

3412
02:17:36,960 --> 02:17:38,719
now i'm getting a console error which is

3413
02:17:38,719 --> 02:17:40,559
better because this error will guide us

3414
02:17:40,559 --> 02:17:43,040
to where the problem is the error says

3415
02:17:43,040 --> 02:17:44,960
we must call constructor in derived

3416
02:17:44,960 --> 02:17:47,760
class before accessing this now i know

3417
02:17:47,760 --> 02:17:49,840
the problem is inside smoke explosion

3418
02:17:49,840 --> 02:17:52,000
class constructor this is a so-called

3419
02:17:52,000 --> 02:17:54,240
derived class when i create a new smoke

3420
02:17:54,240 --> 02:17:56,399
explosion object i want the parent class

3421
02:17:56,399 --> 02:17:58,319
constructor to run first creating

3422
02:17:58,319 --> 02:18:00,800
properties and values shared for all

3423
02:18:00,800 --> 02:18:03,200
child classes and then i want to add

3424
02:18:03,200 --> 02:18:05,040
this little bit of code that's specific

3425
02:18:05,040 --> 02:18:07,679
only for smoke explosion class to do

3426
02:18:07,679 --> 02:18:09,359
that i have to call the parent class

3427
02:18:09,359 --> 02:18:10,399
constructor

3428
02:18:10,399 --> 02:18:13,200
using a special super keyword i know

3429
02:18:13,200 --> 02:18:15,679
that parent class constructor expects

3430
02:18:15,679 --> 02:18:18,319
game x and y so i pass these arguments

3431
02:18:18,319 --> 02:18:19,519
along

3432
02:18:19,519 --> 02:18:21,519
it's a good lesson for me to remember on

3433
02:18:21,519 --> 02:18:23,920
a child class we must always call super

3434
02:18:23,920 --> 02:18:26,080
class constructor before using this

3435
02:18:26,080 --> 02:18:27,840
keyword otherwise we will get a

3436
02:18:27,840 --> 02:18:29,359
reference error

3437
02:18:29,359 --> 02:18:31,439
now when i create a new smoke explosion

3438
02:18:31,439 --> 02:18:33,920
we create one new blank object this

3439
02:18:33,920 --> 02:18:35,840
constructor will run first creating

3440
02:18:35,840 --> 02:18:37,439
these properties and then these

3441
02:18:37,439 --> 02:18:40,240
properties will be added on top of that

3442
02:18:40,240 --> 02:18:42,399
smoke explosion will also have access to

3443
02:18:42,399 --> 02:18:44,319
update and draw methods because of the

3444
02:18:44,319 --> 02:18:46,160
inheritance that was set up behind the

3445
02:18:46,160 --> 02:18:48,719
scenes by the special extents keyword we

3446
02:18:48,719 --> 02:18:51,760
used we fixed all the bugs and typos

3447
02:18:51,760 --> 02:18:53,679
when i test it i can see that everything

3448
02:18:53,679 --> 02:18:56,000
works and we are adding smoke explosion

3449
02:18:56,000 --> 02:18:58,240
into the explosions array and we are

3450
02:18:58,240 --> 02:19:00,160
drawing the entire sprite sheet at that

3451
02:19:00,160 --> 02:19:02,800
position perfect let's clean it up and

3452
02:19:02,800 --> 02:19:04,719
make it into a proper sprite animation

3453
02:19:04,719 --> 02:19:07,200
now this dust cloud is a sprite sheet we

3454
02:19:07,200 --> 02:19:09,200
are drawing it using built-in draw image

3455
02:19:09,200 --> 02:19:12,399
method on line 312. as we already did

3456
02:19:12,399 --> 02:19:14,399
multiple times in this class we know

3457
02:19:14,399 --> 02:19:16,479
that to animate a sprite sheet we need

3458
02:19:16,479 --> 02:19:19,040
to crop out individual frames and swap

3459
02:19:19,040 --> 02:19:21,359
through them one by one we do it by

3460
02:19:21,359 --> 02:19:24,000
passing draw image method nine arguments

3461
02:19:24,000 --> 02:19:27,120
image we want to draw source x source y

3462
02:19:27,120 --> 02:19:29,040
source width and source height to

3463
02:19:29,040 --> 02:19:32,080
specify area we want to crop out we want

3464
02:19:32,080 --> 02:19:34,080
to crop out one sprite sheet frame at a

3465
02:19:34,080 --> 02:19:37,200
time and destination x destination y

3466
02:19:37,200 --> 02:19:39,439
destination with and destination height

3467
02:19:39,439 --> 02:19:41,840
to tell javascript where we want to draw

3468
02:19:41,840 --> 02:19:44,160
that cropped out image on destination

3469
02:19:44,160 --> 02:19:45,599
canvas

3470
02:19:45,599 --> 02:19:47,120
we already have the values for

3471
02:19:47,120 --> 02:19:49,280
destination we just need to specify the

3472
02:19:49,280 --> 02:19:50,640
crop area

3473
02:19:50,640 --> 02:19:53,520
source x will be frame x from line 300

3474
02:19:53,520 --> 02:19:57,359
times sprite width from line 320. source

3475
02:19:57,359 --> 02:19:59,439
y will always be 0 because this sprite

3476
02:19:59,439 --> 02:20:01,920
sheet has only one row of frames width

3477
02:20:01,920 --> 02:20:04,319
of the cropped area will be sprite width

3478
02:20:04,319 --> 02:20:07,280
height will be sprite height

3479
02:20:07,280 --> 02:20:09,760
so now because frame x times sprite

3480
02:20:09,760 --> 02:20:11,600
width determines horizontal cropping

3481
02:20:11,600 --> 02:20:14,319
coordinate as we increase frame x inside

3482
02:20:14,319 --> 02:20:16,800
update method the frames will cycle and

3483
02:20:16,800 --> 02:20:19,280
animate now it works but the animation

3484
02:20:19,280 --> 02:20:20,960
is coming from the top left corner of

3485
02:20:20,960 --> 02:20:23,600
each enemy and it plays very fast also

3486
02:20:23,600 --> 02:20:25,359
we are not removing all the explosion

3487
02:20:25,359 --> 02:20:27,520
objects that already animated and we

3488
02:20:27,520 --> 02:20:30,000
have an ever increasing array i will

3489
02:20:30,000 --> 02:20:34,640
check if frame x is more than max frame

3490
02:20:34,640 --> 02:20:36,479
and if it is i know that entire

3491
02:20:36,479 --> 02:20:39,200
animation played at that point it's safe

3492
02:20:39,200 --> 02:20:41,120
to set marked for deletion property to

3493
02:20:41,120 --> 02:20:43,520
true and that explosion object will be

3494
02:20:43,520 --> 02:20:45,359
removed by filter method we already

3495
02:20:45,359 --> 02:20:48,080
defined earlier

3496
02:20:48,080 --> 02:20:49,840
in the browser console i can see that

3497
02:20:49,840 --> 02:20:51,600
the old explosion objects are being

3498
02:20:51,600 --> 02:20:54,399
correctly removed nice

3499
02:20:54,399 --> 02:20:56,880
i want the animation to run at 15 frames

3500
02:20:56,880 --> 02:20:58,800
per second i do it by creating a

3501
02:20:58,800 --> 02:21:00,720
periodic event again

3502
02:21:00,720 --> 02:21:02,800
timer will be counting from 0 to the

3503
02:21:02,800 --> 02:21:04,720
value of milliseconds defined in

3504
02:21:04,720 --> 02:21:06,960
interval whenever it reaches that value

3505
02:21:06,960 --> 02:21:08,960
it will trigger next frame in the sprite

3506
02:21:08,960 --> 02:21:11,280
sheet and resets back to 0 so that it

3507
02:21:11,280 --> 02:21:13,120
can count again

3508
02:21:13,120 --> 02:21:16,319
so if this dot timer from line 303 is

3509
02:21:16,319 --> 02:21:18,240
more than this slot interval from line

3510
02:21:18,240 --> 02:21:22,240
304 increase frame x by one else keep

3511
02:21:22,240 --> 02:21:24,080
increasing timer by delta time

3512
02:21:24,080 --> 02:21:26,000
accumulating milliseconds until it

3513
02:21:26,000 --> 02:21:29,040
reaches the interval

3514
02:21:30,240 --> 02:21:32,319
this will serve only the first frame is

3515
02:21:32,319 --> 02:21:34,319
because after timer reaches interval it

3516
02:21:34,319 --> 02:21:36,319
needs to be reset back to zero so that

3517
02:21:36,319 --> 02:21:38,080
it can count again for the next

3518
02:21:38,080 --> 02:21:41,200
animation frame

3519
02:21:41,200 --> 02:21:43,359
it still doesn't work i can see that

3520
02:21:43,359 --> 02:21:45,439
update method expects delta time as an

3521
02:21:45,439 --> 02:21:47,680
argument to be used to increase timer

3522
02:21:47,680 --> 02:21:51,040
value online 313. i have a feeling i'm

3523
02:21:51,040 --> 02:21:54,720
not passing it that value when i call it

3524
02:21:54,720 --> 02:21:58,920
i go down to line 422

3525
02:22:00,240 --> 02:22:02,399
and i pass update method on explosion

3526
02:22:02,399 --> 02:22:05,600
object delta time

3527
02:22:05,840 --> 02:22:08,000
now we are animating the explosions at

3528
02:22:08,000 --> 02:22:10,319
15 frames per second structuring your

3529
02:22:10,319 --> 02:22:11,920
code like this will allow you to set

3530
02:22:11,920 --> 02:22:13,920
different fps for different objects in

3531
02:22:13,920 --> 02:22:14,960
your game

3532
02:22:14,960 --> 02:22:16,880
in this case we did it because player

3533
02:22:16,880 --> 02:22:19,120
and enemy sprite sheets are optimized

3534
02:22:19,120 --> 02:22:21,439
for high frame rate but explosion

3535
02:22:21,439 --> 02:22:23,840
animation has only 8 frames so it looks

3536
02:22:23,840 --> 02:22:26,399
better if we stagger the animation speed

3537
02:22:26,399 --> 02:22:28,319
if you want to turn this into a mobile

3538
02:22:28,319 --> 02:22:30,000
game you would have to do this for all

3539
02:22:30,000 --> 02:22:31,760
objects player and enemies you would

3540
02:22:31,760 --> 02:22:33,840
have to delete some frames and stagger

3541
02:22:33,840 --> 02:22:35,680
their animation because current mobile

3542
02:22:35,680 --> 02:22:37,439
phones will struggle to surf sprite

3543
02:22:37,439 --> 02:22:39,359
sheets with so many frames we are using

3544
02:22:39,359 --> 02:22:41,359
for our characters if you want lower

3545
02:22:41,359 --> 02:22:42,880
frame rate spreadsheets for these

3546
02:22:42,880 --> 02:22:44,960
characters let me know i can easily make

3547
02:22:44,960 --> 02:22:46,319
them for you

3548
02:22:46,319 --> 02:22:48,399
the explosions are animated in the top

3549
02:22:48,399 --> 02:22:50,479
left corner of each enemy i want them to

3550
02:22:50,479 --> 02:22:52,880
be in the middle so i adjust the initial

3551
02:22:52,880 --> 02:22:55,760
x coordinate we pass it by half of enemy

3552
02:22:55,760 --> 02:22:58,080
wave

3553
02:23:00,160 --> 02:23:01,760
and the vertical coordinate will be

3554
02:23:01,760 --> 02:23:04,640
adjusted by a half of enemy height

3555
02:23:04,640 --> 02:23:07,040
like this

3556
02:23:07,040 --> 02:23:08,640
this looks good

3557
02:23:08,640 --> 02:23:10,399
i'm noticing that we are not showing the

3558
02:23:10,399 --> 02:23:12,240
first animation frame of our smoke

3559
02:23:12,240 --> 02:23:14,560
explosion sprite sheet it's because we

3560
02:23:14,560 --> 02:23:16,399
first call the update method that

3561
02:23:16,399 --> 02:23:19,280
increases frame x by 1 and then we draw

3562
02:23:19,280 --> 02:23:21,680
it i can fix it by calling draw first

3563
02:23:21,680 --> 02:23:25,120
and then i call update

3564
02:23:25,359 --> 02:23:27,840
like this

3565
02:23:29,760 --> 02:23:31,840
now we can see the first sprite frame as

3566
02:23:31,840 --> 02:23:33,680
well and it stays long enough so we can

3567
02:23:33,680 --> 02:23:37,280
actually notice it nice

3568
02:23:38,800 --> 02:23:40,399
let's delete this console log we don't

3569
02:23:40,399 --> 02:23:41,840
need it anymore

3570
02:23:41,840 --> 02:23:43,760
i can change the animation speed of dust

3571
02:23:43,760 --> 02:23:46,319
clouds by changing the value here in fps

3572
02:23:46,319 --> 02:23:47,680
property

3573
02:23:47,680 --> 02:23:50,240
when i set it to a very low value like 5

3574
02:23:50,240 --> 02:23:52,560
frames per second it becomes obvious

3575
02:23:52,560 --> 02:23:54,399
that they are not being correctly placed

3576
02:23:54,399 --> 02:23:56,640
within the game world they are static

3577
02:23:56,640 --> 02:23:58,160
but they should be scrolling along with

3578
02:23:58,160 --> 02:24:00,000
the game world for the positioning to

3579
02:24:00,000 --> 02:24:02,560
look right

3580
02:24:02,640 --> 02:24:04,720
i fix it by accounting for the current

3581
02:24:04,720 --> 02:24:06,479
game speed in their horizontal

3582
02:24:06,479 --> 02:24:09,200
coordinate calculation like this

3583
02:24:09,200 --> 02:24:10,960
now they scroll with the game world and

3584
02:24:10,960 --> 02:24:14,840
it looks as it should

3585
02:24:18,640 --> 02:24:20,880
i think a good fps for the sprite sheet

3586
02:24:20,880 --> 02:24:25,040
is around 30 frames per second

3587
02:24:27,200 --> 02:24:30,720
yes i'm happy with this for now

3588
02:24:40,720 --> 02:24:43,040
let's create a fire explosion this time

3589
02:24:43,040 --> 02:24:45,200
it will be very simple i copy all the

3590
02:24:45,200 --> 02:24:47,200
code inside the constructor into the

3591
02:24:47,200 --> 02:24:49,200
other child class

3592
02:24:49,200 --> 02:24:51,439
image will have id of fire explosion

3593
02:24:51,439 --> 02:24:54,240
like this i actually decided to refactor

3594
02:24:54,240 --> 02:24:56,720
the fire sprite sheet and now both smoke

3595
02:24:56,720 --> 02:24:59,439
and fire sprite sheets have frames 200

3596
02:24:59,439 --> 02:25:02,319
times 200 pixels in that case i can

3597
02:25:02,319 --> 02:25:04,479
remove sprite with on child class and i

3598
02:25:04,479 --> 02:25:06,319
can place it on the parent explosion

3599
02:25:06,319 --> 02:25:08,160
class because now it's shared for both

3600
02:25:08,160 --> 02:25:11,120
explosion types

3601
02:25:11,120 --> 02:25:12,720
in that case i can actually take all

3602
02:25:12,720 --> 02:25:14,479
these properties and add them on the

3603
02:25:14,479 --> 02:25:17,520
parent class as well

3604
02:25:21,120 --> 02:25:22,720
i remove them here since they will be

3605
02:25:22,720 --> 02:25:24,399
automatically inherited

3606
02:25:24,399 --> 02:25:26,720
nice that's cleaner so only the images

3607
02:25:26,720 --> 02:25:28,880
are specific for each class all other

3608
02:25:28,880 --> 02:25:30,800
properties and methods will be shared

3609
02:25:30,800 --> 02:25:34,720
and inherited from the parent class

3610
02:25:36,960 --> 02:25:39,280
down here inside add explosion method i

3611
02:25:39,280 --> 02:25:42,880
say if randomize is less than 0.5 create

3612
02:25:42,880 --> 02:25:45,439
smoke explosion else

3613
02:25:45,439 --> 02:25:47,359
careful about the brackets and syntax

3614
02:25:47,359 --> 02:25:49,680
here

3615
02:25:50,240 --> 02:25:53,840
else create fire explosion

3616
02:25:54,640 --> 02:25:56,960
nice work now sometimes we get a fire

3617
02:25:56,960 --> 02:26:01,800
effect sometimes we get a smoke effect

3618
02:26:04,430 --> 02:26:10,560
[Music]

3619
02:26:10,560 --> 02:26:12,960
inside game class constructor i adjust

3620
02:26:12,960 --> 02:26:15,520
time limit to 30 seconds

3621
02:26:15,520 --> 02:26:18,240
winning score will be 100 so the player

3622
02:26:18,240 --> 02:26:20,240
needs to get at least 100 score points

3623
02:26:20,240 --> 02:26:23,520
in 30 seconds to see the winning message

3624
02:26:23,520 --> 02:26:26,720
i set ammo interval to 350 milliseconds

3625
02:26:26,720 --> 02:26:30,000
so that ammo recharges a bit faster

3626
02:26:30,000 --> 02:26:33,359
and i set enemy interval to 2 seconds

3627
02:26:33,359 --> 02:26:36,240
let's test it

3628
02:26:39,840 --> 02:26:42,000
we have a bug i got a winning message

3629
02:26:42,000 --> 02:26:44,160
and there were some leftover enemies and

3630
02:26:44,160 --> 02:26:46,319
colliding with them reduced my score

3631
02:26:46,319 --> 02:26:48,560
below 100 and losing message was

3632
02:26:48,560 --> 02:26:50,720
displayed instead i need to make sure

3633
02:26:50,720 --> 02:26:52,560
that after the winning or losing message

3634
02:26:52,560 --> 02:26:54,720
appears colliding with enemies doesn't

3635
02:26:54,720 --> 02:26:57,600
affect the score

3636
02:26:59,920 --> 02:27:03,359
i do it here online 437 only decrease

3637
02:27:03,359 --> 02:27:05,600
score when we collide with an enemy if

3638
02:27:05,600 --> 02:27:08,800
game over is false

3639
02:27:12,720 --> 02:27:14,800
let's tune the game into a more playable

3640
02:27:14,800 --> 02:27:16,399
and challenging state

3641
02:27:16,399 --> 02:27:18,800
i make heath whale less likely to appear

3642
02:27:18,800 --> 02:27:22,160
in our game and luckyfish more likely

3643
02:27:22,160 --> 02:27:24,720
like this

3644
02:27:25,200 --> 02:27:29,720
i give hive whale 20 lives

3645
02:27:30,479 --> 02:27:32,960
luckyfish will have five lives

3646
02:27:32,960 --> 02:27:35,520
angler two will have six lives angular

3647
02:27:35,520 --> 02:27:38,640
one will have five lives for example

3648
02:27:38,640 --> 02:27:41,600
i said game with 2000 pixels this will

3649
02:27:41,600 --> 02:27:43,280
make the game easier as we can see

3650
02:27:43,280 --> 02:27:45,520
enemies coming sooner and we can plan

3651
02:27:45,520 --> 02:27:48,880
and manage our moves and ammo better

3652
02:27:48,880 --> 02:27:50,960
i try to play to get a better idea of

3653
02:27:50,960 --> 02:27:54,560
how much score i can get in 30 seconds

3654
02:27:54,560 --> 02:27:56,479
okay the game ended because we reached

3655
02:27:56,479 --> 02:28:01,120
winning score 100 in 25.1 seconds

3656
02:28:01,120 --> 02:28:04,800
let's set winning score to 80.

3657
02:28:05,520 --> 02:28:07,680
i can strategize now i can see there is

3658
02:28:07,680 --> 02:28:09,520
a lucky fish come in that will replenish

3659
02:28:09,520 --> 02:28:11,680
my ammo so i will use as much as my ammo

3660
02:28:11,680 --> 02:28:14,399
as possible before i get the refill now

3661
02:28:14,399 --> 02:28:16,560
i get a refill and i can go crazy with

3662
02:28:16,560 --> 02:28:19,040
my lasers i will be careful not to hit

3663
02:28:19,040 --> 02:28:20,880
the lucky fish coming at the bottom so

3664
02:28:20,880 --> 02:28:22,800
that i can collect it and make my power

3665
02:28:22,800 --> 02:28:26,280
up state longer

3666
02:28:28,240 --> 02:28:30,560
okay it took 24 seconds to get the score

3667
02:28:30,560 --> 02:28:33,600
over 80. game has a time limit of 30 000

3668
02:28:33,600 --> 02:28:36,080
milliseconds 30 seconds if the game runs

3669
02:28:36,080 --> 02:28:38,399
for that amount of time it will end we

3670
02:28:38,399 --> 02:28:40,319
need to get enough score points in that

3671
02:28:40,319 --> 02:28:41,760
time period

3672
02:28:41,760 --> 02:28:43,280
this is just my choice you don't have to

3673
02:28:43,280 --> 02:28:45,120
do this but i want the game to always

3674
02:28:45,120 --> 02:28:47,439
run for 30 seconds i don't want it to

3675
02:28:47,439 --> 02:28:49,280
end as soon as we get over the winning

3676
02:28:49,280 --> 02:28:52,560
score so i will comment out line 456

3677
02:28:52,560 --> 02:28:54,720
game will only end when time limit is

3678
02:28:54,720 --> 02:28:56,319
over 30 seconds

3679
02:28:56,319 --> 02:28:58,080
and based on how much score we managed

3680
02:28:58,080 --> 02:29:00,160
to get we will see a winning or losing

3681
02:29:00,160 --> 02:29:01,200
message

3682
02:29:01,200 --> 02:29:02,960
there is an element of luck in the game

3683
02:29:02,960 --> 02:29:04,880
we designed because it is very dependent

3684
02:29:04,880 --> 02:29:07,439
on which type of enemy spawns if we get

3685
02:29:07,439 --> 02:29:09,280
just lucky fish and hive wales we will

3686
02:29:09,280 --> 02:29:11,680
get a lot of score points fast if we get

3687
02:29:11,680 --> 02:29:13,760
only anglers it will be very hard to win

3688
02:29:13,760 --> 02:29:15,760
the game i gave you all the tools and

3689
02:29:15,760 --> 02:29:17,439
techniques you need to understand you

3690
02:29:17,439 --> 02:29:19,680
can now adjust the game time enemy

3691
02:29:19,680 --> 02:29:21,439
health and winning score yourself to

3692
02:29:21,439 --> 02:29:23,680
make the game as easy or as difficult as

3693
02:29:23,680 --> 02:29:26,479
you want it to be

3694
02:29:30,560 --> 02:29:32,880
the game runs well on my gaming pc but

3695
02:29:32,880 --> 02:29:34,640
if you have a chromebook or some very

3696
02:29:34,640 --> 02:29:36,479
old laptop you might be experiencing

3697
02:29:36,479 --> 02:29:38,800
performance issues i focused this class

3698
02:29:38,800 --> 02:29:40,479
mostly on handling graphics and

3699
02:29:40,479 --> 02:29:42,800
animation there is a whole other set of

3700
02:29:42,800 --> 02:29:45,120
optimizations we can do to make this run

3701
02:29:45,120 --> 02:29:47,120
even on the oldest machines but that's

3702
02:29:47,120 --> 02:29:49,439
beyond the scope of this class notable

3703
02:29:49,439 --> 02:29:51,200
optimizations would be for example to

3704
02:29:51,200 --> 02:29:53,200
draw on multiple canvas elements and

3705
02:29:53,200 --> 02:29:55,520
only clear parts of canvas that actually

3706
02:29:55,520 --> 02:29:56,800
update it

3707
02:29:56,800 --> 02:29:58,640
object pooling technique would also have

3708
02:29:58,640 --> 02:30:00,160
a massive positive effect on the

3709
02:30:00,160 --> 02:30:02,240
performance it means that we create a

3710
02:30:02,240 --> 02:30:04,800
pool of particle and projectile objects

3711
02:30:04,800 --> 02:30:07,120
and we just reuse them over and over

3712
02:30:07,120 --> 02:30:08,800
rather than creating new ones and

3713
02:30:08,800 --> 02:30:11,280
discarding them after one use for this

3714
02:30:11,280 --> 02:30:13,120
project the quick changes you can make

3715
02:30:13,120 --> 02:30:14,720
to improve performance would be to

3716
02:30:14,720 --> 02:30:16,880
increase enemy interval property to make

3717
02:30:16,880 --> 02:30:19,280
enemies spawn slower if your computer is

3718
02:30:19,280 --> 02:30:21,600
not keeping up you can also remove all

3719
02:30:21,600 --> 02:30:24,319
shadow properties inside ui class canvas

3720
02:30:24,319 --> 02:30:26,560
shadows are still not well supported and

3721
02:30:26,560 --> 02:30:28,800
optimized in some browsers especially in

3722
02:30:28,800 --> 02:30:30,960
firefox we can reduce the number of

3723
02:30:30,960 --> 02:30:32,800
particle spare parts that fall from

3724
02:30:32,800 --> 02:30:34,880
enemies when damaged and we can also

3725
02:30:34,880 --> 02:30:36,880
make sure they only bounce off the floor

3726
02:30:36,880 --> 02:30:39,680
once or that they don't bounce at all if

3727
02:30:39,680 --> 02:30:41,359
you are still getting performance issues

3728
02:30:41,359 --> 02:30:43,520
you can also merge all background layers

3729
02:30:43,520 --> 02:30:46,160
into one image and just animate that one

3730
02:30:46,160 --> 02:30:47,840
layer that will increase performance

3731
02:30:47,840 --> 02:30:50,000
massively same goes for our sprite

3732
02:30:50,000 --> 02:30:52,319
sheets i gave you sprite sheets with 37

3733
02:30:52,319 --> 02:30:54,160
animation frames which looks really good

3734
02:30:54,160 --> 02:30:56,399
and smooth in motion but if you struggle

3735
02:30:56,399 --> 02:30:58,880
to get 60 fps reducing the number of

3736
02:30:58,880 --> 02:31:00,800
frames and have each animation to be

3737
02:31:00,800 --> 02:31:03,280
just around 15 frames let's say and

3738
02:31:03,280 --> 02:31:05,200
staggering animation speed with delta

3739
02:31:05,200 --> 02:31:06,800
time like we did with animated

3740
02:31:06,800 --> 02:31:08,479
explosions would make the performance

3741
02:31:08,479 --> 02:31:10,640
better as well i will probably release a

3742
02:31:10,640 --> 02:31:12,080
version of sprite sheets with lower

3743
02:31:12,080 --> 02:31:13,760
frame rate for each character so you

3744
02:31:13,760 --> 02:31:15,680
don't have to do it manually yourself

3745
02:31:15,680 --> 02:31:17,680
bonus extended lesson where i add more

3746
02:31:17,680 --> 02:31:20,399
enemy types animated projectiles shield

3747
02:31:20,399 --> 02:31:22,319
and simple sound design is linked in the

3748
02:31:22,319 --> 02:31:24,160
video description but feel free to play

3749
02:31:24,160 --> 02:31:26,319
with the code and add your own features

3750
02:31:26,319 --> 02:31:28,319
with the techniques we learned today let

3751
02:31:28,319 --> 02:31:30,080
me know if you finish this project by

3752
02:31:30,080 --> 02:31:32,319
typing i did it in the comments if you

3753
02:31:32,319 --> 02:31:34,319
want more vanilla javascript game dev

3754
02:31:34,319 --> 02:31:36,080
come and build this game with me i will

3755
02:31:36,080 --> 02:31:38,160
show you how to use state design pattern

3756
02:31:38,160 --> 02:31:40,240
for more complex player controls and

3757
02:31:40,240 --> 02:31:42,560
movement and how to split our code into

3758
02:31:42,560 --> 02:31:44,560
individual modules click like please

3759
02:31:44,560 --> 02:31:47,359
i'll see you there
